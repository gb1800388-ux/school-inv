<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è - –ì–ö–û–£ –°–ö–û–®–ò ‚Ññ102</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Nunito', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        school: {
                            blue: '#4F46E5',
                            purple: '#7C3AED',
                            pink: '#EC4899',
                            orange: '#F97316',
                            yellow: '#EAB308',
                            green: '#22C55E',
                            cyan: '#06B6D4',
                            red: '#EF4444',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html { font-size: 18px; }
        body { font-family: 'Nunito', sans-serif; font-weight: 500; touch-action: manipulation; }
        
        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ - –≤—ã—à–µ —Å–µ—Ä–µ–¥–∏–Ω—ã –¥–ª—è iPad */
        .modal-overlay {
            display: flex;
            align-items: flex-start;
            padding-top: 8vh;
        }
        
        .modal-enter { animation: modalIn 0.3s ease-out; }
        @keyframes modalIn { 
            from { opacity: 0; transform: scale(0.9) translateY(-20px); } 
            to { opacity: 1; transform: scale(1) translateY(0); } 
        }
        
        .toast-enter { animation: toastIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes toastIn {
            from { opacity: 0; transform: translateY(30px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        /* –ú—è–≥–∫–∏–µ —Ç–µ–Ω–∏ */
        .card-shadow { 
            box-shadow: 0 4px 20px rgba(0,0,0,0.08), 
                        0 8px 32px rgba(0,0,0,0.06); 
        }
        .card-shadow-hover { 
            box-shadow: 0 8px 30px rgba(0,0,0,0.12),
                        0 16px 48px rgba(0,0,0,0.1); 
        }
        
        /* –°—Ç–∞—Ç—É—Å-—Å—Ç—Ä–æ–∫–∞ */
        .status-line {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
            color: #64748b;
        }
        .status-line .sep { 
            width: 5px; 
            height: 5px; 
            background: #cbd5e1; 
            border-radius: 50%; 
            flex-shrink: 0;
        }
        
        /* –°—Ç–∞—Ç—É—Å –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ - —è—Ä–∫–∏–π */
        .status-checked {
            background: linear-gradient(135deg, #22C55E 0%, #16A34A 100%);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
        }
        .status-pending {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
        }
        .status-writeoff {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }
        
        /* –¶–≤–µ—Ç–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
        .category-divider {
            background: linear-gradient(135deg, var(--cat-color-1) 0%, var(--cat-color-2) 100%);
            color: white;
            padding: 16px 24px;
            border-radius: 20px;
            margin: 24px 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 6px 20px var(--cat-shadow);
        }
        .category-divider:first-child { margin-top: 0; }
        
        /* iPad touch-friendly */
        .touch-btn {
            min-height: 56px;
            min-width: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* –í–µ—Å—ë–ª—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */
        .progress-gradient {
            background: conic-gradient(from 0deg, #22C55E, #06B6D4, #4F46E5, #7C3AED, #EC4899, #F97316, #22C55E);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-100 via-indigo-50 to-purple-50">
    <div id="root"></div>
    <input type="file" id="fileInput" accept=".json" style="display:none">

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // ==================== ICONS ====================
        const Icons = {
            Home: () => <svg className="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>,
            Building: () => <svg className="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>,
            Users: () => <svg className="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>,
            Plus: () => <svg className="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.5} d="M12 4v16m8-8H4" /></svg>,
            Search: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>,
            Save: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" /></svg>,
            Download: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>,
            Upload: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>,
            Trash: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>,
            X: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>,
            Check: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>,
            Monitor: () => <svg className="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>,
            Speaker: () => <svg className="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>,
            Printer: () => <svg className="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" /></svg>,
            Tv: () => <svg className="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>,
            Box: () => <svg className="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" /></svg>,
            Layers: () => <svg className="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>,
            CheckCircle: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
            AlertCircle: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
            FileText: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>,
        };

        // ==================== INITIAL DATA ====================
        const initialEquipment = [
            {id:"item_0",name:"–ú–§–£ –≥—Ä—É–ø–ø–æ–≤–æ–µ, —Ü–≤–µ—Ç–Ω–æ–µ OKI MC563dn",invNumber:"1101340057",date:"29.12.2017",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–ü—Ä–∏–Ω—Ç–µ—Ä—ã –∏ –ú–§–£",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_1",name:"–ü—Ä–∏–Ω—Ç–µ—Ä –≥—Ä—É–ø–ø–æ–≤–æ–π, –º–æ–Ω–æ—Ö—Ä–æ–º–Ω—ã–π, Epson WorkForce Pro WF-M5190DW",invNumber:"1101340077",date:"22.03.2018",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–ü—Ä–∏–Ω—Ç–µ—Ä—ã –∏ –ú–§–£",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_2",name:"–ê–∫—É—Å—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞—É–¥–∏—Ç–æ—Ä–∏–∏",invNumber:"1101340084",date:"30.03.2018",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–ê—É–¥–∏–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_3",name:"–ê–∫—É—Å—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞—É–¥–∏—Ç–æ—Ä–∏–∏",invNumber:"1101340095",date:"30.03.2018",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–ê—É–¥–∏–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_4",name:"–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ IRBIS",invNumber:"0101340042",date:"23.12.2020",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_5",name:"–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ IRBIS",invNumber:"0101340043",date:"23.12.2020",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_415",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º OPS, 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-50",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_416",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º OPS, 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-51",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_417",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º OPS, 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-52",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_418",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º OPS, 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-53",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_419",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º OPS, 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-54",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_420",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º OPS, 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-55",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_421",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º OPS, 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-56",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_422",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å ICL InfoRay IR38604 —Å OPS ThinRay T106G1",invNumber:"–ë–î-57",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
        ];

        // –¶–≤–µ—Ç–∞ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π - —è—Ä–∫–∏–µ —à–∫–æ–ª—å–Ω—ã–µ
        const categoryColors = {
            "–ê—É–¥–∏–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ": { c1: '#EC4899', c2: '#F97316', shadow: 'rgba(236, 72, 153, 0.3)', icon: Icons.Speaker },
            "–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ": { c1: '#7C3AED', c2: '#4F46E5', shadow: 'rgba(124, 58, 237, 0.3)', icon: Icons.Monitor },
            "–ü—Ä–∏–Ω—Ç–µ—Ä—ã –∏ –ú–§–£": { c1: '#06B6D4', c2: '#0891B2', shadow: 'rgba(6, 182, 212, 0.3)', icon: Icons.Printer },
            "–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã": { c1: '#22C55E', c2: '#16A34A', shadow: 'rgba(34, 197, 94, 0.3)', icon: Icons.Tv },
        };

        const defaultCategoryColor = { c1: '#6366F1', c2: '#4F46E5', shadow: 'rgba(99, 102, 241, 0.3)', icon: Icons.Box };

        // ==================== COMPONENTS ====================

        // Progress Ring - –†–∞–¥—É–∂–Ω—ã–π
        const ProgressRing = ({ percent, size = 90, strokeWidth = 8 }) => {
            const radius = (size - strokeWidth) / 2;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (percent / 100) * circumference;
            
            return (
                <div className="relative" style={{ width: size, height: size }}>
                    <svg className="transform -rotate-90" width={size} height={size}>
                        <defs>
                            <linearGradient id="rainbow" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stopColor="#22C55E" />
                                <stop offset="25%" stopColor="#06B6D4" />
                                <stop offset="50%" stopColor="#7C3AED" />
                                <stop offset="75%" stopColor="#EC4899" />
                                <stop offset="100%" stopColor="#F97316" />
                            </linearGradient>
                        </defs>
                        <circle className="text-slate-200" strokeWidth={strokeWidth} stroke="currentColor" fill="transparent" r={radius} cx={size / 2} cy={size / 2} />
                        <circle stroke="url(#rainbow)" strokeWidth={strokeWidth} strokeDasharray={circumference} strokeDashoffset={offset} strokeLinecap="round" fill="transparent" r={radius} cx={size / 2} cy={size / 2} style={{ transition: 'stroke-dashoffset 0.5s ease' }} />
                    </svg>
                    <div className="absolute inset-0 flex items-center justify-center">
                        <span className="text-2xl font-black bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">{percent}%</span>
                    </div>
                </div>
            );
        };

        // Navigation Rail - –®–∫–æ–ª—å–Ω—ã–π —Å—Ç–∏–ª—å
        const NavRail = ({ activeNav, setActiveNav, onOpenRooms, onOpenPeople, onAddEquipment, onShowInfo }) => {
            const navItems = [
                { id: 'home', icon: Icons.Home, label: '–ì–ª–∞–≤–Ω–∞—è', action: () => setActiveNav('home'), color: 'from-blue-500 to-indigo-600' },
                { id: 'rooms', icon: Icons.Building, label: '–ö–∞–±–∏–Ω–µ—Ç—ã', action: onOpenRooms, color: 'from-cyan-500 to-blue-600' },
                { id: 'people', icon: Icons.Users, label: '–õ—é–¥–∏', action: onOpenPeople, color: 'from-pink-500 to-rose-600' },
                { id: 'add', icon: Icons.Plus, label: '–î–æ–±–∞–≤–∏—Ç—å', action: onAddEquipment, isAdd: true, color: 'from-green-500 to-emerald-600' },
            ];

            return (
                <div className="w-24 bg-gradient-to-b from-slate-800 via-slate-900 to-indigo-900 flex flex-col items-center py-6 flex-shrink-0">
                    {/* Logo */}
                    <button 
                        onClick={onShowInfo}
                        className="w-16 h-16 bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 rounded-2xl flex items-center justify-center mb-8 shadow-lg shadow-purple-500/30 hover:scale-105 transition-transform cursor-pointer"
                        title="–û –ø—Ä–æ–≥—Ä–∞–º–º–µ"
                    >
                        <span className="text-white font-black text-xl">üìö</span>
                    </button>
                    
                    <div className="flex-1 flex flex-col items-center gap-4">
                        {navItems.map(item => {
                            const Icon = item.icon;
                            const isActive = activeNav === item.id;
                            return (
                                <button
                                    key={item.id}
                                    onClick={item.action}
                                    className={`touch-btn w-16 h-16 rounded-2xl flex flex-col items-center justify-center gap-1 transition-all duration-300
                                        ${item.isAdd 
                                            ? `bg-gradient-to-br ${item.color} text-white shadow-lg shadow-green-500/30 hover:scale-105` 
                                            : isActive 
                                                ? `bg-gradient-to-br ${item.color} text-white shadow-lg` 
                                                : 'text-slate-400 hover:bg-white/10 hover:text-white'}`}
                                    title={item.label}
                                >
                                    <Icon />
                                    <span className="text-[10px] font-bold leading-none">{item.label}</span>
                                </button>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // Filter Panel - –Ø—Ä–∫–∏–π
        const FilterPanel = ({ stats, categories, activeCategory, setActiveCategory, activeFilter, setActiveFilter }) => {
            const quickStats = [
                { id: 'writeoff', label: '–°–ø–∏—Å–∞–Ω–∏–µ', count: stats.writeOff, emoji: 'üìù', bgColor: 'bg-gradient-to-br from-red-100 to-red-50', textColor: 'text-red-600', borderColor: 'border-red-200' },
                { id: 'nolabel', label: '–ë–µ–∑ –±–∏—Ä–∫–∏', count: stats.noLabel, emoji: 'üè∑Ô∏è', bgColor: 'bg-gradient-to-br from-orange-100 to-amber-50', textColor: 'text-orange-600', borderColor: 'border-orange-200' },
                { id: 'serial', label: '–° —Å–µ—Ä–∏–π–Ω–∏–∫–æ–º', count: stats.withSerial, emoji: 'üî¢', bgColor: 'bg-gradient-to-br from-emerald-100 to-green-50', textColor: 'text-emerald-600', borderColor: 'border-emerald-200' },
                { id: 'new', label: '–ù–æ–≤—ã–µ', count: stats.new, emoji: '‚ú®', bgColor: 'bg-gradient-to-br from-violet-100 to-purple-50', textColor: 'text-violet-600', borderColor: 'border-violet-200' },
            ];

            const percent = stats.total > 0 ? Math.round((stats.checked / stats.total) * 100) : 0;

            return (
                <div className="w-80 bg-white/90 backdrop-blur-xl border-r border-slate-200/50 flex flex-col flex-shrink-0 shadow-xl">
                    {/* Header */}
                    <div className="px-6 py-5 border-b border-slate-100 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500">
                        <h1 className="text-2xl font-black text-white tracking-tight">üìã –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è</h1>
                        <p className="text-base text-white/80 mt-1 font-semibold">–ì–ö–û–£ –°–ö–û–®–ò ‚Ññ102</p>
                    </div>

                    {/* Progress */}
                    <div className="px-6 py-5 border-b border-slate-100 bg-gradient-to-br from-slate-50 to-indigo-50/50">
                        <div className="flex items-center gap-5">
                            <ProgressRing percent={percent} size={90} strokeWidth={8} />
                            <div className="flex-1 min-w-0">
                                <p className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">–ü—Ä–æ–≥—Ä–µ—Å—Å</p>
                                <div className="space-y-2">
                                    <div className="flex justify-between text-base">
                                        <span className="text-slate-600 font-medium">‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</span>
                                        <span className="font-black text-emerald-600">{stats.checked}</span>
                                    </div>
                                    <div className="flex justify-between text-base">
                                        <span className="text-slate-600 font-medium">‚è≥ –û—Å—Ç–∞–ª–æ—Å—å</span>
                                        <span className="font-black text-amber-600">{stats.pending}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Quick Stats Grid */}
                    <div className="p-4 border-b border-slate-100">
                        <div className="grid grid-cols-2 gap-3">
                            {quickStats.map(stat => (
                                <button
                                    key={stat.id}
                                    onClick={() => setActiveFilter(activeFilter === stat.id ? 'all' : stat.id)}
                                    className={`touch-btn p-4 rounded-2xl border-2 text-center transition-all ${stat.bgColor} ${stat.borderColor} ${stat.textColor}
                                        ${activeFilter === stat.id ? 'ring-4 ring-indigo-300 scale-95' : 'hover:scale-[1.02] active:scale-95'}`}
                                >
                                    <div className="text-2xl mb-1">{stat.emoji}</div>
                                    <div className="text-3xl font-black leading-none">{stat.count}</div>
                                    <div className="text-xs font-bold mt-1 opacity-80 uppercase">{stat.label}</div>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Status Filters */}
                    <div className="px-5 py-4 border-b border-slate-100">
                        <h3 className="text-xs font-black text-slate-400 uppercase tracking-wider mb-3">üìä –°—Ç–∞—Ç—É—Å</h3>
                        <div className="space-y-2">
                            {[
                                { id: 'all', label: 'üìã –í—Å–µ', count: stats.total, color: 'indigo' },
                                { id: 'unchecked', label: '‚è≥ –û–∂–∏–¥–∞—é—Ç', count: stats.pending, color: 'amber' },
                                { id: 'checked', label: '‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ', count: stats.checked, color: 'emerald' },
                            ].map(f => (
                                <button
                                    key={f.id}
                                    onClick={() => setActiveFilter(f.id)}
                                    className={`touch-btn w-full flex items-center justify-between px-4 py-3 rounded-xl transition-all duration-200
                                        ${activeFilter === f.id 
                                            ? 'bg-gradient-to-r from-indigo-500 to-purple-500 text-white shadow-lg shadow-indigo-200' 
                                            : 'text-slate-600 hover:bg-slate-100 active:bg-slate-200'}`}
                                >
                                    <span className="text-base font-bold">{f.label}</span>
                                    <span className={`text-sm font-black px-3 py-1 rounded-full
                                        ${activeFilter === f.id ? 'bg-white/20 text-white' : 'bg-slate-100 text-slate-600'}`}>
                                        {f.count}
                                    </span>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Categories */}
                    <div className="flex-1 overflow-y-auto px-5 py-4 custom-scrollbar">
                        <h3 className="text-xs font-black text-slate-400 uppercase tracking-wider mb-3">üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
                        <div className="space-y-2">
                            {categories.map(cat => {
                                const catColor = categoryColors[cat] || defaultCategoryColor;
                                const Icon = catColor.icon;
                                const count = cat === '–í—Å–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ' ? stats.total : stats.byCategory[cat] || 0;
                                return (
                                    <button
                                        key={cat}
                                        onClick={() => setActiveCategory(cat)}
                                        className={`touch-btn w-full flex items-center gap-4 px-4 py-4 rounded-xl transition-all duration-200
                                            ${activeCategory === cat 
                                                ? 'text-white shadow-lg' 
                                                : 'text-slate-600 hover:bg-slate-100 active:bg-slate-200'}`}
                                        style={activeCategory === cat ? { background: `linear-gradient(135deg, ${catColor.c1}, ${catColor.c2})`, boxShadow: `0 8px 20px ${catColor.shadow}` } : {}}
                                    >
                                        <Icon />
                                        <span className="flex-1 text-left text-base font-bold truncate">{cat}</span>
                                        <span className={`text-sm font-black px-3 py-1 rounded-full
                                            ${activeCategory === cat ? 'bg-white/20 text-white' : 'bg-slate-100 text-slate-600'}`}>
                                            {count}
                                        </span>
                                    </button>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        // Equipment Card - iPad-friendly
        const EquipmentCard = ({ item, onView, onCheck }) => {
            const catColor = categoryColors[item.category] || defaultCategoryColor;
            const Icon = catColor.icon;
            const isProcessed = item.checked || item.writeOff;
            
            // Status badge
            const getStatusBadge = () => {
                if (item.writeOff) return <span className="status-writeoff">üìù –°–ø–∏—Å–∞–Ω–∏–µ</span>;
                if (item.checked) return <span className="status-checked">‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</span>;
                return <span className="status-pending">‚è≥ –û–∂–∏–¥–∞–µ—Ç</span>;
            };

            // Build info line
            const infoItems = [];
            if (item.location) infoItems.push(<span key="loc">üìç {item.location}</span>);
            if (item.responsible) infoItems.push(<span key="resp">üë§ {item.responsible}</span>);
            if (item.serialNumber?.trim()) infoItems.push(<span key="sn" className="font-mono">üî¢ {item.serialNumber}</span>);

            // Badges
            const badges = [];
            if (item.isUserAdded) badges.push({ emoji: '‚ú®', title: '–ù–æ–≤–æ–µ' });
            if (item.hasLabel === false) badges.push({ emoji: '‚ö†Ô∏è', title: '–ë–µ–∑ –±–∏—Ä–∫–∏' });
            if (item.inventoryNote?.trim()) badges.push({ emoji: 'üí¨', title: '–ó–∞–º–µ—Ç–∫–∞' });

            return (
                <div className={`bg-white rounded-3xl p-6 card-shadow hover:card-shadow-hover transition-all duration-300 flex flex-col border-2
                    ${item.writeOff ? 'border-red-300 bg-gradient-to-br from-red-50 to-white' : 
                      item.checked ? 'border-emerald-300 bg-gradient-to-br from-emerald-50 to-white' : 
                      'border-slate-200 hover:border-indigo-300'}`}>
                    
                    {/* Header */}
                    <div className="flex items-start gap-4 mb-4">
                        <div className={`w-16 h-16 rounded-2xl flex items-center justify-center flex-shrink-0 shadow-lg`}
                             style={{ background: `linear-gradient(135deg, ${catColor.c1}, ${catColor.c2})`, boxShadow: `0 6px 16px ${catColor.shadow}` }}>
                            <span className="text-white"><Icon /></span>
                        </div>
                        <div className="flex-1 min-w-0">
                            <div className="flex items-center gap-2 flex-wrap mb-2">
                                <span className="px-3 py-1.5 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl text-sm font-black font-mono shadow-md">
                                    {item.invNumber}
                                </span>
                                {badges.map((badge, idx) => (
                                    <span key={idx} className="text-lg" title={badge.title}>{badge.emoji}</span>
                                ))}
                            </div>
                            <h3 className="font-bold text-slate-800 text-lg leading-snug line-clamp-2">{item.name}</h3>
                        </div>
                    </div>

                    {/* Status & Info */}
                    <div className="mb-4">
                        <div className="mb-3">{getStatusBadge()}</div>
                        {infoItems.length > 0 && (
                            <div className="status-line">
                                {infoItems.map((item, idx) => (
                                    <React.Fragment key={idx}>
                                        {idx > 0 && <span className="sep" />}
                                        {item}
                                    </React.Fragment>
                                ))}
                            </div>
                        )}
                    </div>

                    {/* Actions - Touch-friendly */}
                    <div className="flex gap-3 pt-4 mt-auto border-t-2 border-slate-100">
                        <button
                            onClick={() => onView(item)}
                            className="touch-btn flex-1 py-4 bg-gradient-to-r from-slate-100 to-slate-200 hover:from-slate-200 hover:to-slate-300 text-slate-700 rounded-2xl text-base font-bold transition-all active:scale-95"
                        >
                            üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä
                        </button>
                        
                        {!isProcessed ? (
                            <button
                                onClick={() => onCheck(item)}
                                className="touch-btn flex-1 py-4 bg-gradient-to-r from-emerald-500 to-green-500 hover:from-emerald-600 hover:to-green-600 text-white rounded-2xl text-base font-bold transition-all shadow-lg shadow-emerald-200 active:scale-95"
                            >
                                ‚úì –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                            </button>
                        ) : (
                            <button
                                onClick={() => onCheck(item, true)}
                                className="touch-btn flex-1 py-4 bg-gradient-to-r from-slate-400 to-slate-500 hover:from-slate-500 hover:to-slate-600 text-white rounded-2xl text-base font-bold transition-all active:scale-95"
                            >
                                ‚Ü©Ô∏è –û—Ç–º–µ–Ω–∏—Ç—å
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        // Modal - –í—ã—à–µ —Å–µ—Ä–µ–¥–∏–Ω—ã –¥–ª—è iPad
        const Modal = ({ isOpen, onClose, title, children, size = 'md' }) => {
            if (!isOpen) return null;
            const sizeClasses = { sm: 'max-w-md', md: 'max-w-lg', lg: 'max-w-2xl', xl: 'max-w-4xl' };
            
            return (
                <div className="fixed inset-0 z-50 modal-overlay justify-center bg-black/40 backdrop-blur-sm" onClick={onClose}>
                    <div className={`modal-enter bg-white rounded-3xl shadow-2xl w-full ${sizeClasses[size]} max-h-[80vh] overflow-hidden flex flex-col mx-4`} onClick={e => e.stopPropagation()}>
                        <div className="flex items-center justify-between px-6 py-5 border-b-2 border-slate-100 bg-gradient-to-r from-slate-50 to-indigo-50 flex-shrink-0">
                            <h2 className="text-xl font-black text-slate-800">{title}</h2>
                            <button onClick={onClose} className="touch-btn w-12 h-12 rounded-xl bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-slate-500 hover:text-slate-700 transition-colors">
                                <Icons.X />
                            </button>
                        </div>
                        <div className="p-6 overflow-y-auto flex-1 custom-scrollbar">{children}</div>
                    </div>
                </div>
            );
        };

        // Confirm Modal
        const ConfirmModal = ({ isOpen, onClose, onConfirm, title, message, icon = '‚ö†Ô∏è', confirmText = '–î–∞', confirmColor = 'indigo' }) => {
            if (!isOpen) return null;
            const colors = { 
                indigo: 'from-indigo-500 to-purple-500 shadow-indigo-200', 
                red: 'from-red-500 to-rose-500 shadow-red-200', 
                green: 'from-emerald-500 to-green-500 shadow-emerald-200' 
            };
            
            return (
                <div className="fixed inset-0 z-[60] modal-overlay justify-center bg-black/40 backdrop-blur-sm">
                    <div className="modal-enter bg-white rounded-3xl shadow-2xl w-full max-w-sm p-8 text-center mx-4">
                        <div className="text-6xl mb-5">{icon}</div>
                        <h3 className="text-xl font-black text-slate-800 mb-3">{title}</h3>
                        <p className="text-lg text-slate-500 mb-8 font-medium">{message}</p>
                        <div className="flex gap-4">
                            <button onClick={onClose} className="touch-btn flex-1 py-4 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-2xl text-lg font-bold transition-colors active:scale-95">
                                –û—Ç–º–µ–Ω–∞
                            </button>
                            <button onClick={onConfirm} className={`touch-btn flex-1 py-4 bg-gradient-to-r ${colors[confirmColor]} text-white rounded-2xl text-lg font-bold transition-all shadow-lg active:scale-95`}>
                                {confirmText}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Toast
        const Toast = ({ message, type = 'success', isVisible, onClose }) => {
            useEffect(() => { if (isVisible) { const t = setTimeout(onClose, 2500); return () => clearTimeout(t); } }, [isVisible, onClose]);
            if (!isVisible) return null;
            
            return (
                <div className={`toast-enter fixed bottom-8 left-1/2 -translate-x-1/2 px-8 py-5 rounded-2xl shadow-xl flex items-center gap-4 z-[70]
                    ${type === 'success' ? 'bg-gradient-to-r from-emerald-500 to-green-500' : 'bg-gradient-to-r from-red-500 to-rose-500'} text-white text-lg font-bold`}>
                    {type === 'success' ? '‚úÖ' : '‚ùå'}
                    <span>{message}</span>
                </div>
            );
        };

        // Autocomplete Input
        const AutocompleteInput = ({ value, onChange, suggestions, placeholder, label, icon }) => {
            const [showDropdown, setShowDropdown] = useState(false);
            const [filtered, setFiltered] = useState([]);

            useEffect(() => {
                if (suggestions.length > 0) {
                    const f = value 
                        ? suggestions.filter(s => s.toLowerCase().includes(value.toLowerCase())).slice(0, 5)
                        : suggestions.slice(0, 5);
                    setFiltered(f);
                } else {
                    setFiltered([]);
                }
            }, [value, suggestions]);

            return (
                <div className="relative">
                    {label && <label className="block text-base font-bold text-slate-700 mb-2">{icon} {label}</label>}
                    <input
                        type="text"
                        value={value}
                        onChange={(e) => onChange(e.target.value)}
                        onFocus={() => setShowDropdown(true)}
                        onBlur={() => setTimeout(() => setShowDropdown(false), 200)}
                        placeholder={placeholder}
                        className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl text-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-400 transition-all"
                    />
                    {showDropdown && filtered.length > 0 && (
                        <div className="absolute top-full left-0 right-0 mt-2 bg-white border-2 border-slate-200 rounded-2xl shadow-xl z-20 overflow-hidden">
                            {filtered.map((item, idx) => (
                                <button key={idx} type="button" onClick={() => { onChange(item); setShowDropdown(false); }}
                                    className="touch-btn w-full text-left px-5 py-4 hover:bg-indigo-50 text-lg text-slate-700 border-b border-slate-100 last:border-0 font-medium">
                                    {item}
                                </button>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // ==================== MAIN APP ====================
        const App = () => {
            // Data
            const [equipment, setEquipment] = useState(() => {
                try {
                    const saved = localStorage.getItem('inv_102_data_v6');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        return initialEquipment.map(item => {
                            const savedItem = parsed.find(p => p.id === item.id);
                            return savedItem ? { ...item, ...savedItem } : item;
                        }).concat(parsed.filter(p => p.isUserAdded && !initialEquipment.find(i => i.id === p.id)));
                    }
                } catch (e) { console.error(e); }
                return initialEquipment;
            });

            const [directories, setDirectories] = useState(() => {
                try {
                    const saved = localStorage.getItem('inv_102_dirs_v6');
                    return saved ? JSON.parse(saved) : { rooms: [], people: [] };
                } catch (e) { return { rooms: [], people: [] }; }
            });

            // UI State
            const [activeNav, setActiveNav] = useState('home');
            const [activeCategory, setActiveCategory] = useState('–í—Å–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ');
            const [activeFilter, setActiveFilter] = useState('all');
            const [searchQuery, setSearchQuery] = useState('');

            // Modals
            const [toast, setToast] = useState({ visible: false, message: '', type: 'success' });
            const [confirmModal, setConfirmModal] = useState({ open: false, title: '', message: '', icon: '‚ö†Ô∏è', onConfirm: null, confirmText: '–î–∞', confirmColor: 'indigo' });
            const [detailsModal, setDetailsModal] = useState({ open: false, item: null });
            const [editModal, setEditModal] = useState({ open: false, item: null, isNew: false });
            const [labelModal, setLabelModal] = useState({ open: false, item: null });
            const [serialModal, setSerialModal] = useState({ open: false, item: null, serial: '' });
            const [quickSearchModal, setQuickSearchModal] = useState({ open: false, query: '' });
            const [roomsModal, setRoomsModal] = useState({ open: false, newRoom: '' });
            const [peopleModal, setPeopleModal] = useState({ open: false, newPerson: '' });
            const [infoModal, setInfoModal] = useState({ open: false });

            // Form states
            const [detailsForm, setDetailsForm] = useState({ serialNumber: '', location: '', responsible: '', inventoryNote: '', hasLabel: null });
            const [editForm, setEditForm] = useState({ name: '', invNumber: '', date: '', category: '', newCategory: '', note: '' });

            // Save to localStorage
            useEffect(() => { localStorage.setItem('inv_102_data_v6', JSON.stringify(equipment)); }, [equipment]);
            useEffect(() => { localStorage.setItem('inv_102_dirs_v6', JSON.stringify(directories)); }, [directories]);

            // Stats
            const stats = {
                total: equipment.length,
                checked: equipment.filter(i => i.checked || i.writeOff).length,
                pending: equipment.filter(i => !i.checked && !i.writeOff).length,
                writeOff: equipment.filter(i => i.writeOff).length,
                noLabel: equipment.filter(i => i.hasLabel === false).length,
                withSerial: equipment.filter(i => i.serialNumber?.trim()).length,
                new: equipment.filter(i => i.isUserAdded).length,
                byCategory: equipment.reduce((acc, i) => { acc[i.category] = (acc[i.category] || 0) + 1; return acc; }, {}),
            };

            // Categories
            const otherCategories = [...new Set(equipment.map(i => i.category).filter(Boolean))].sort((a, b) => a.localeCompare(b, 'ru'));
            const categories = ['–í—Å–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ', ...otherCategories];

            // Filtered equipment
            const filteredEquipment = equipment.filter(item => {
                if (activeCategory !== '–í—Å–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ' && item.category !== activeCategory) return false;
                
                switch (activeFilter) {
                    case 'checked': if (!item.checked && !item.writeOff) return false; break;
                    case 'unchecked': if (item.checked || item.writeOff) return false; break;
                    case 'writeoff': if (!item.writeOff) return false; break;
                    case 'nolabel': if (item.hasLabel !== false) return false; break;
                    case 'serial': if (!item.serialNumber?.trim()) return false; break;
                    case 'new': if (!item.isUserAdded) return false; break;
                }
                
                if (searchQuery) {
                    const q = searchQuery.toLowerCase();
                    const searchable = [item.invNumber, item.name, item.serialNumber, item.location, item.responsible].join(' ').toLowerCase();
                    if (!searchable.includes(q)) return false;
                }
                
                return true;
            });

            // Group by category
            const groupedEquipment = filteredEquipment.reduce((acc, item) => {
                const cat = item.category || '–ü—Ä–æ—á–µ–µ';
                if (!acc[cat]) acc[cat] = [];
                acc[cat].push(item);
                return acc;
            }, {});

            // Helpers
            const showToast = (message, type = 'success') => setToast({ visible: true, message, type });
            const showConfirm = (title, message, onConfirm, icon = '‚ö†Ô∏è', confirmText = '–î–∞', confirmColor = 'indigo') => {
                setConfirmModal({ open: true, title, message, icon, onConfirm, confirmText, confirmColor });
            };

            // Check process
            const startCheckProcess = (item) => {
                if (item.hasLabel === null) {
                    setLabelModal({ open: true, item });
                } else if (!item.serialNumber?.trim()) {
                    setSerialModal({ open: true, item, serial: '' });
                } else {
                    finishCheck(item);
                }
            };

            const handleLabelAnswer = (hasLabel) => {
                const item = labelModal.item;
                setEquipment(prev => prev.map(i => i.id === item.id ? { ...i, hasLabel } : i));
                setLabelModal({ open: false, item: null });
                
                const updatedItem = { ...item, hasLabel };
                if (!updatedItem.serialNumber?.trim()) {
                    setSerialModal({ open: true, item: updatedItem, serial: '' });
                } else {
                    finishCheck(updatedItem);
                }
            };

            const handleSerialSave = () => {
                const item = serialModal.item;
                const serial = serialModal.serial.trim();
                setEquipment(prev => prev.map(i => i.id === item.id ? { ...i, serialNumber: serial, checked: true, writeOff: false, checkedAt: new Date().toISOString() } : i));
                setSerialModal({ open: false, item: null, serial: '' });
                showToast('‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ!');
            };

            const handleSerialSkip = () => {
                finishCheck(serialModal.item);
                setSerialModal({ open: false, item: null, serial: '' });
            };

            const finishCheck = (item) => {
                setEquipment(prev => prev.map(i => i.id === item.id ? { ...i, checked: true, writeOff: false, checkedAt: new Date().toISOString() } : i));
                showToast('‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ!');
            };

            const handleCheck = (item, undo = false) => {
                if (undo) {
                    showConfirm('–û—Ç–º–µ–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É?', '–í–µ—Ä–Ω—É—Ç—å –≤ —Å—Ç–∞—Ç—É—Å "–û–∂–∏–¥–∞–µ—Ç"?', () => {
                        setEquipment(prev => prev.map(i => i.id === item.id ? { ...i, checked: false, writeOff: false, checkedAt: null } : i));
                        setConfirmModal({ ...confirmModal, open: false });
                        showToast('‚Ü©Ô∏è –û—Ç–º–µ–Ω–µ–Ω–æ');
                    }, '‚Ü©Ô∏è');
                } else {
                    startCheckProcess(item);
                }
            };

            const handleWriteOff = (item) => {
                showConfirm('–°–ø–∏—Å–∞—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ?', `"${item.name}"`, () => {
                    setEquipment(prev => prev.map(i => i.id === item.id ? { ...i, writeOff: true, checked: false, checkedAt: new Date().toISOString(), hasLabel: i.hasLabel === null ? true : i.hasLabel } : i));
                    setConfirmModal({ ...confirmModal, open: false });
                    setDetailsModal({ open: false, item: null });
                    showToast('üìù –ù–∞ —Å–ø–∏—Å–∞–Ω–∏–µ');
                }, 'üìù', '–°–ø–∏—Å–∞—Ç—å', 'red');
            };

            // Details modal
            const openDetails = (item) => {
                setDetailsForm({
                    serialNumber: item.serialNumber || '',
                    location: item.location || '',
                    responsible: item.responsible || '',
                    inventoryNote: item.inventoryNote || '',
                    hasLabel: item.hasLabel
                });
                setDetailsModal({ open: true, item });
            };

            const saveDetails = () => {
                const item = detailsModal.item;
                setEquipment(prev => prev.map(i => i.id === item.id ? { ...i, ...detailsForm } : i));
                
                if (detailsForm.location && !directories.rooms.includes(detailsForm.location)) {
                    setDirectories(prev => ({ ...prev, rooms: [...prev.rooms, detailsForm.location].sort((a, b) => a.localeCompare(b, 'ru')) }));
                }
                if (detailsForm.responsible && !directories.people.includes(detailsForm.responsible)) {
                    setDirectories(prev => ({ ...prev, people: [...prev.people, detailsForm.responsible].sort((a, b) => a.localeCompare(b, 'ru')) }));
                }
                
                setDetailsModal({ open: false, item: null });
                showToast('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
            };

            // Edit modal
            const openEditModal = (item = null) => {
                if (item) {
                    setEditForm({ name: item.name, invNumber: item.invNumber, date: item.date || '', category: item.category, newCategory: '', note: item.note || '' });
                    setEditModal({ open: true, item, isNew: false });
                } else {
                    setEditForm({ name: '', invNumber: '', date: new Date().toLocaleDateString('ru-RU'), category: '', newCategory: '', note: '' });
                    setEditModal({ open: true, item: null, isNew: true });
                }
            };

            const saveEdit = () => {
                const { name, invNumber, date, category, newCategory, note } = editForm;
                if (!name.trim()) { showToast('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ', 'error'); return; }
                if (!invNumber.trim()) { showToast('–í–≤–µ–¥–∏—Ç–µ –∏–Ω–≤. –Ω–æ–º–µ—Ä', 'error'); return; }
                const finalCategory = newCategory.trim() || category;
                if (!finalCategory) { showToast('–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é', 'error'); return; }
                
                const duplicate = equipment.find(i => i.invNumber === invNumber && i.id !== editModal.item?.id);
                if (duplicate) { showToast('–¢–∞–∫–æ–π –Ω–æ–º–µ—Ä —É–∂–µ –µ—Å—Ç—å', 'error'); return; }

                if (editModal.isNew) {
                    const newItem = {
                        id: 'item_' + Date.now(),
                        name: name.trim(),
                        invNumber: invNumber.trim(),
                        date: date.trim(),
                        category: finalCategory,
                        note: note.trim(),
                        checked: false,
                        writeOff: false,
                        hasLabel: null,
                        serialNumber: '',
                        location: '',
                        responsible: '',
                        inventoryNote: '',
                        isUserAdded: true
                    };
                    setEquipment(prev => [...prev, newItem]);
                    showToast('‚ú® –î–æ–±–∞–≤–ª–µ–Ω–æ!');
                } else {
                    setEquipment(prev => prev.map(i => i.id === editModal.item.id ? { ...i, name: name.trim(), invNumber: invNumber.trim(), date: date.trim(), category: finalCategory, note: note.trim() } : i));
                    showToast('‚úèÔ∏è –ò–∑–º–µ–Ω–µ–Ω–æ!');
                }
                setEditModal({ open: false, item: null, isNew: false });
            };

            // Directory management
            const addToDirectory = (type, value) => {
                if (!value.trim()) return;
                const key = type === 'rooms' ? 'rooms' : 'people';
                if (directories[key].includes(value.trim())) { showToast('–£–∂–µ –µ—Å—Ç—å', 'error'); return; }
                setDirectories(prev => ({ ...prev, [key]: [...prev[key], value.trim()].sort((a, b) => a.localeCompare(b, 'ru')) }));
                if (type === 'rooms') setRoomsModal(prev => ({ ...prev, newRoom: '' }));
                else setPeopleModal(prev => ({ ...prev, newPerson: '' }));
                showToast('‚ûï –î–æ–±–∞–≤–ª–µ–Ω–æ!');
            };

            const removeFromDirectory = (type, idx) => {
                const key = type === 'rooms' ? 'rooms' : 'people';
                const item = directories[key][idx];
                showConfirm('–£–¥–∞–ª–∏—Ç—å?', `"${item}"`, () => {
                    setDirectories(prev => ({ ...prev, [key]: prev[key].filter((_, i) => i !== idx) }));
                    setConfirmModal({ ...confirmModal, open: false });
                    showToast('üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ');
                }, 'üóëÔ∏è', '–£–¥–∞–ª–∏—Ç—å', 'red');
            };

            // Export/Import
            const handleSave = () => {
                showConfirm('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å?', '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ', () => {
                    localStorage.setItem('inv_102_data_v6', JSON.stringify(equipment));
                    setConfirmModal({ ...confirmModal, open: false });
                    showToast('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
                }, 'üíæ', '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å', 'green');
            };

            const handleExportExcel = () => {
                showConfirm('–≠–∫—Å–ø–æ—Ä—Ç Excel?', '–°–∫–∞—á–∞—Ç—å CSV —Ñ–∞–π–ª', () => {
                    const BOM = '\uFEFF';
                    const headers = ['–ò–Ω–≤.‚Ññ', 'S/N', '–ù–∞–∑–≤–∞–Ω–∏–µ', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è', '–õ–æ–∫–∞—Ü–∏—è', '–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π', '–°—Ç–∞—Ç—É—Å', '–ë–∏—Ä–∫–∞', '–ó–∞–º–µ—Ç–∫–∞'];
                    let csv = BOM + headers.join(';') + '\n';
                    equipment.forEach(item => {
                        const status = item.writeOff ? '–°–ø–∏—Å–∞–Ω–∏–µ' : item.checked ? '–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ' : '–û–∂–∏–¥–∞–µ—Ç';
                        const label = item.hasLabel === true ? '–ï—Å—Ç—å' : item.hasLabel === false ? '–ù–ï–¢' : '-';
                        const row = [item.invNumber, item.serialNumber || '', item.name, item.category, item.location || '', item.responsible || '', status, label, item.inventoryNote || '']
                            .map(f => `"${String(f).replace(/"/g, '""')}"`).join(';');
                        csv += row + '\n';
                    });
                    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è_${new Date().toISOString().slice(0, 10)}.csv`;
                    link.click();
                    setConfirmModal({ ...confirmModal, open: false });
                    showToast('üìä –°–∫–∞—á–∞–Ω–æ!');
                }, 'üìä', '–°–∫–∞—á–∞—Ç—å', 'green');
            };

            const handleExportJSON = () => {
                showConfirm('–≠–∫—Å–ø–æ—Ä—Ç JSON?', '–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è', () => {
                    const data = JSON.stringify({ equipment, directories }, null, 2);
                    const blob = new Blob([data], { type: 'application/json' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `backup_${new Date().toISOString().slice(0, 10)}.json`;
                    link.click();
                    setConfirmModal({ ...confirmModal, open: false });
                    showToast('üì§ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ!');
                }, 'üì§', '–≠–∫—Å–ø–æ—Ä—Ç', 'indigo');
            };

            const handleImportClick = () => {
                showConfirm('–ò–º–ø–æ—Ä—Ç?', '–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ JSON', () => {
                    setConfirmModal({ ...confirmModal, open: false });
                    document.getElementById('fileInput').click();
                }, 'üì•', '–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª', 'indigo');
            };

            const handleImportJSON = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const json = JSON.parse(event.target.result);
                        const imp = json.equipment || (Array.isArray(json) ? json : null);
                        if (!imp) throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç');
                        let count = 0;
                        imp.forEach(impItem => {
                            const existing = equipment.find(e => e.id === impItem.id);
                            if (existing) {
                                setEquipment(prev => prev.map(i => i.id === impItem.id ? { ...i, ...impItem } : i));
                                count++;
                            } else if (impItem.isUserAdded) {
                                setEquipment(prev => [...prev, impItem]);
                                count++;
                            }
                        });
                        if (json.directories) {
                            setDirectories(prev => ({
                                rooms: [...new Set([...prev.rooms, ...(json.directories.rooms || [])])].sort((a, b) => a.localeCompare(b, 'ru')),
                                people: [...new Set([...prev.people, ...(json.directories.people || [])])].sort((a, b) => a.localeCompare(b, 'ru'))
                            }));
                        }
                        showToast(`üì• –ò–º–ø–æ—Ä—Ç: ${count} –∑–∞–ø–∏—Å–µ–π`);
                    } catch (err) {
                        showToast('–û—à–∏–±–∫–∞: ' + err.message, 'error');
                    }
                };
                reader.readAsText(file);
                e.target.value = '';
            };

            const handleClearAll = () => {
                showConfirm('–°–±—Ä–æ—Å–∏—Ç—å –í–°–ï?', '–í—Å–µ –æ—Ç–º–µ—Ç–∫–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!', () => {
                    setEquipment(prev => prev.map(i => ({ ...i, checked: false, writeOff: false, hasLabel: null, serialNumber: '', location: '', responsible: '', inventoryNote: '', checkedAt: null })));
                    setConfirmModal({ ...confirmModal, open: false });
                    showToast('üóëÔ∏è –°–±—Ä–æ—à–µ–Ω–æ');
                }, 'üóëÔ∏è', '–°–±—Ä–æ—Å–∏—Ç—å', 'red');
            };

            // Quick search results
            const quickSearchResults = quickSearchModal.query ? equipment.filter(item => {
                const q = quickSearchModal.query.toLowerCase();
                return [item.invNumber, item.name, item.serialNumber].join(' ').toLowerCase().includes(q);
            }).slice(0, 30) : [];

            return (
                <div className="flex h-screen overflow-hidden">
                    {/* Navigation Rail */}
                    <NavRail 
                        activeNav={activeNav} 
                        setActiveNav={setActiveNav}
                        onOpenRooms={() => setRoomsModal({ ...roomsModal, open: true })}
                        onOpenPeople={() => setPeopleModal({ ...peopleModal, open: true })}
                        onAddEquipment={() => openEditModal()}
                        onShowInfo={() => setInfoModal({ open: true })}
                    />

                    {/* Filter Panel */}
                    <FilterPanel
                        stats={stats}
                        categories={categories}
                        activeCategory={activeCategory}
                        setActiveCategory={setActiveCategory}
                        activeFilter={activeFilter}
                        setActiveFilter={setActiveFilter}
                    />

                    {/* Main Content */}
                    <main className="flex-1 flex flex-col min-w-0 overflow-hidden">
                        {/* Header */}
                        <header className="bg-white/80 backdrop-blur-xl border-b-2 border-slate-200/50 px-8 py-5 flex-shrink-0 shadow-sm">
                            <div className="flex items-center gap-5">
                                {/* Search */}
                                <div className="flex-1 relative max-w-xl">
                                    <div className="absolute left-5 top-1/2 -translate-y-1/2 text-slate-400">
                                        <Icons.Search />
                                    </div>
                                    <input
                                        type="text"
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                        placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É, –Ω–∞–∑–≤–∞–Ω–∏—é..."
                                        className="w-full pl-14 pr-5 py-4 bg-slate-100 border-2 border-slate-200 rounded-2xl text-lg placeholder-slate-400 focus:ring-4 focus:ring-indigo-100 focus:border-indigo-400 transition-all font-medium"
                                    />
                                </div>

                                {/* Actions */}
                                <div className="flex items-center gap-3">
                                    <button onClick={handleSave} className="touch-btn p-4 bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white rounded-2xl transition-all shadow-lg shadow-indigo-200" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å">
                                        <Icons.Save />
                                    </button>
                                    <button onClick={handleExportExcel} className="touch-btn p-4 bg-gradient-to-r from-emerald-500 to-green-500 hover:from-emerald-600 hover:to-green-600 text-white rounded-2xl transition-all shadow-lg shadow-emerald-200" title="Excel">
                                        <Icons.FileText />
                                    </button>
                                    <button onClick={handleExportJSON} className="touch-btn p-4 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-2xl transition-colors" title="–≠–∫—Å–ø–æ—Ä—Ç">
                                        <Icons.Download />
                                    </button>
                                    <button onClick={handleImportClick} className="touch-btn p-4 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-2xl transition-colors" title="–ò–º–ø–æ—Ä—Ç">
                                        <Icons.Upload />
                                    </button>
                                    <button onClick={handleClearAll} className="touch-btn p-4 bg-slate-200 hover:bg-red-100 text-slate-700 hover:text-red-600 rounded-2xl transition-colors" title="–°–±—Ä–æ—Å">
                                        <Icons.Trash />
                                    </button>
                                </div>
                            </div>
                        </header>

                        {/* Content */}
                        <div className="flex-1 overflow-y-auto p-8 custom-scrollbar">
                            {Object.keys(groupedEquipment).length === 0 ? (
                                <div className="flex flex-col items-center justify-center h-full text-slate-400">
                                    <div className="text-8xl mb-6">üì≠</div>
                                    <p className="text-2xl font-bold">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
                                </div>
                            ) : (
                                Object.entries(groupedEquipment).sort((a, b) => a[0].localeCompare(b[0], 'ru')).map(([category, items]) => {
                                    const catColor = categoryColors[category] || defaultCategoryColor;
                                    const Icon = catColor.icon;
                                    const checkedCount = items.filter(i => i.checked || i.writeOff).length;
                                    return (
                                        <div key={category} className="mb-8">
                                            {/* Category Divider - –¶–≤–µ—Ç–Ω–æ–π */}
                                            <div className="category-divider" style={{ '--cat-color-1': catColor.c1, '--cat-color-2': catColor.c2, '--cat-shadow': catColor.shadow }}>
                                                <div className="flex items-center gap-4">
                                                    <Icon />
                                                    <h2 className="text-xl font-black">{category}</h2>
                                                </div>
                                                <span className="px-5 py-2 bg-white/20 rounded-full text-lg font-black">
                                                    {checkedCount} / {items.length}
                                                </span>
                                            </div>
                                            <div className="grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-6">
                                                {items.map(item => (
                                                    <EquipmentCard
                                                        key={item.id}
                                                        item={item}
                                                        onView={openDetails}
                                                        onCheck={handleCheck}
                                                    />
                                                ))}
                                            </div>
                                        </div>
                                    );
                                })
                            )}
                        </div>
                    </main>

                    {/* FAB */}
                    <button
                        onClick={() => setQuickSearchModal({ open: true, query: '' })}
                        className="fixed bottom-8 right-8 w-16 h-16 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white rounded-full shadow-xl flex items-center justify-center text-3xl z-40 transition-transform hover:scale-110 active:scale-95"
                    >
                        üîç
                    </button>

                    {/* ===== MODALS ===== */}

                    {/* Info Modal */}
                    <Modal isOpen={infoModal.open} onClose={() => setInfoModal({ open: false })} title="üìö –û –ø—Ä–æ–≥—Ä–∞–º–º–µ" size="sm">
                        <div className="text-center">
                            <div className="w-24 h-24 bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 rounded-3xl flex items-center justify-center mx-auto mb-5 shadow-xl">
                                <span className="text-4xl">üìö</span>
                            </div>
                            <h3 className="text-2xl font-black text-slate-800 mb-2">–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è</h3>
                            <p className="text-lg text-slate-500 mb-6 font-bold">–ì–ö–û–£ –°–ö–û–®–ò ‚Ññ102</p>
                            <div className="text-lg text-slate-600 space-y-3 text-left bg-gradient-to-br from-slate-50 to-indigo-50 rounded-2xl p-5">
                                <p>üè† <strong>–ì–ª–∞–≤–Ω–∞—è</strong> ‚Äî —Å–ø–∏—Å–æ–∫ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</p>
                                <p>üè¢ <strong>–ö–∞–±–∏–Ω–µ—Ç—ã</strong> ‚Äî —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ–º–µ—â–µ–Ω–∏–π</p>
                                <p>üë• <strong>–õ—é–¥–∏</strong> ‚Äî —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö</p>
                                <p>‚ûï <strong>–î–æ–±–∞–≤–∏—Ç—å</strong> ‚Äî –Ω–æ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</p>
                            </div>
                            <p className="text-base text-slate-400 mt-6 font-bold">–í–µ—Ä—Å–∏—è 3.0 üéâ</p>
                        </div>
                    </Modal>

                    {/* Label Modal */}
                    <Modal isOpen={labelModal.open} onClose={() => setLabelModal({ open: false, item: null })} title="üè∑Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏—Ä–∫–∏" size="sm">
                        <p className="text-center text-slate-600 mb-8 text-xl font-medium">–ò–Ω–≤–µ–Ω—Ç–∞—Ä–Ω–∞—è –±–∏—Ä–∫–∞ –µ—Å—Ç—å?</p>
                        <div className="space-y-4">
                            <button onClick={() => handleLabelAnswer(true)} className="touch-btn w-full py-5 bg-gradient-to-r from-emerald-500 to-green-500 text-white rounded-2xl font-black transition-all text-xl shadow-lg shadow-emerald-200 active:scale-95">
                                ‚úÖ –î–∞, –µ—Å—Ç—å –±–∏—Ä–∫–∞
                            </button>
                            <button onClick={() => handleLabelAnswer(false)} className="touch-btn w-full py-5 bg-gradient-to-r from-red-500 to-rose-500 text-white rounded-2xl font-black transition-all text-xl shadow-lg shadow-red-200 active:scale-95">
                                ‚ùå –ù–µ—Ç –±–∏—Ä–∫–∏
                            </button>
                            <button onClick={() => setLabelModal({ open: false, item: null })} className="touch-btn w-full py-4 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-2xl font-bold text-lg active:scale-95">
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </Modal>

                    {/* Serial Modal */}
                    <Modal isOpen={serialModal.open} onClose={() => setSerialModal({ open: false, item: null, serial: '' })} title="üî¢ –°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä" size="sm">
                        <p className="text-center text-slate-600 mb-5 text-lg font-medium">–í–≤–µ–¥–∏—Ç–µ —Å–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä (–µ—Å–ª–∏ –µ—Å—Ç—å)</p>
                        <input
                            type="text"
                            value={serialModal.serial}
                            onChange={(e) => setSerialModal(prev => ({ ...prev, serial: e.target.value }))}
                            placeholder="S/N"
                            className="w-full px-6 py-5 border-2 border-slate-200 rounded-2xl text-center font-mono text-2xl mb-6 focus:ring-4 focus:ring-indigo-100 focus:border-indigo-400"
                            autoFocus
                        />
                        <div className="space-y-4">
                            <button onClick={handleSerialSave} className="touch-btn w-full py-5 bg-gradient-to-r from-emerald-500 to-green-500 text-white rounded-2xl font-black text-xl shadow-lg shadow-emerald-200 active:scale-95">
                                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                            </button>
                            <button onClick={handleSerialSkip} className="touch-btn w-full py-4 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-2xl font-bold text-lg active:scale-95">
                                –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å ‚Üí
                            </button>
                            <button onClick={() => setSerialModal({ open: false, item: null, serial: '' })} className="touch-btn w-full py-4 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-2xl font-bold text-lg active:scale-95">
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </Modal>

                    {/* Details Modal */}
                    <Modal isOpen={detailsModal.open} onClose={() => setDetailsModal({ open: false, item: null })} title="üìã –ö–∞—Ä—Ç–æ—á–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è" size="md">
                        {detailsModal.item && (
                            <div className="space-y-6">
                                <div className="p-5 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-2xl text-white shadow-lg">
                                    <div className="flex items-center gap-3 mb-2">
                                        <span className="px-4 py-2 bg-white/20 rounded-xl font-mono font-black text-lg">{detailsModal.item.invNumber}</span>
                                        {detailsModal.item.isUserAdded && <span className="text-xl">‚ú®</span>}
                                    </div>
                                    <h3 className="font-bold text-xl">{detailsModal.item.name}</h3>
                                    <p className="text-white/80 mt-1 font-medium">{detailsModal.item.category}</p>
                                </div>

                                <div>
                                    <label className="block text-base font-bold text-slate-700 mb-3">üè∑Ô∏è –ù–∞–ª–∏—á–∏–µ –±–∏—Ä–∫–∏</label>
                                    <div className="grid grid-cols-2 gap-4">
                                        <button onClick={() => setDetailsForm(prev => ({ ...prev, hasLabel: true }))} 
                                            className={`touch-btn py-4 rounded-2xl font-bold text-lg transition-all ${detailsForm.hasLabel === true ? 'bg-gradient-to-r from-emerald-500 to-green-500 text-white shadow-lg' : 'bg-slate-100 text-slate-700 hover:bg-slate-200'}`}>
                                            ‚úÖ –ï—Å—Ç—å
                                        </button>
                                        <button onClick={() => setDetailsForm(prev => ({ ...prev, hasLabel: false }))} 
                                            className={`touch-btn py-4 rounded-2xl font-bold text-lg transition-all ${detailsForm.hasLabel === false ? 'bg-gradient-to-r from-red-500 to-rose-500 text-white shadow-lg' : 'bg-slate-100 text-slate-700 hover:bg-slate-200'}`}>
                                            ‚ùå –ù–µ—Ç
                                        </button>
                                    </div>
                                </div>

                                <AutocompleteInput label="–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä" icon="üî¢" value={detailsForm.serialNumber} onChange={(v) => setDetailsForm(prev => ({ ...prev, serialNumber: v }))} suggestions={[]} placeholder="–í–≤–µ–¥–∏—Ç–µ S/N" />
                                <AutocompleteInput label="–ö–∞–±–∏–Ω–µ—Ç" icon="üìç" value={detailsForm.location} onChange={(v) => setDetailsForm(prev => ({ ...prev, location: v }))} suggestions={directories.rooms} placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–±–∏–Ω–µ—Ç" />
                                <AutocompleteInput label="–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π" icon="üë§" value={detailsForm.responsible} onChange={(v) => setDetailsForm(prev => ({ ...prev, responsible: v }))} suggestions={directories.people} placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –§–ò–û" />

                                <div>
                                    <label className="block text-base font-bold text-slate-700 mb-2">üí¨ –ó–∞–º–µ—Ç–∫–∏</label>
                                    <textarea
                                        value={detailsForm.inventoryNote}
                                        onChange={(e) => setDetailsForm(prev => ({ ...prev, inventoryNote: e.target.value }))}
                                        placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏—è..."
                                        rows={3}
                                        className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl text-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-400 resize-none"
                                    />
                                </div>

                                <div className="grid grid-cols-2 gap-4 pt-4 border-t-2 border-slate-100">
                                    <button onClick={() => { setDetailsModal({ open: false, item: null }); openEditModal(detailsModal.item); }} className="touch-btn py-4 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-2xl font-bold text-lg active:scale-95">
                                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </button>
                                    <button onClick={() => handleWriteOff(detailsModal.item)} className="touch-btn py-4 bg-gradient-to-r from-red-500 to-rose-500 text-white rounded-2xl font-bold text-lg shadow-lg shadow-red-200 active:scale-95">
                                        üìù –°–ø–∏—Å–∞—Ç—å
                                    </button>
                                </div>

                                <button onClick={saveDetails} className="touch-btn w-full py-5 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-2xl font-black text-xl shadow-lg shadow-indigo-200 active:scale-95">
                                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                </button>
                            </div>
                        )}
                    </Modal>

                    {/* Edit Modal */}
                    <Modal isOpen={editModal.open} onClose={() => setEditModal({ open: false, item: null, isNew: false })} title={editModal.isNew ? '‚ú® –ù–æ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ' : '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å'}>
                        <div className="space-y-5">
                            <div>
                                <label className="block text-base font-bold text-slate-700 mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                                <input type="text" value={editForm.name} onChange={(e) => setEditForm(prev => ({ ...prev, name: e.target.value }))} placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è" className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl text-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-400" />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-base font-bold text-slate-700 mb-2">–ò–Ω–≤. –Ω–æ–º–µ—Ä *</label>
                                    <input type="text" value={editForm.invNumber} onChange={(e) => setEditForm(prev => ({ ...prev, invNumber: e.target.value }))} placeholder="–ò–Ω–≤. ‚Ññ" className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl text-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-400" />
                                </div>
                                <div>
                                    <label className="block text-base font-bold text-slate-700 mb-2">–î–∞—Ç–∞</label>
                                    <input type="text" value={editForm.date} onChange={(e) => setEditForm(prev => ({ ...prev, date: e.target.value }))} placeholder="–î–î.–ú–ú.–ì–ì–ì–ì" className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl text-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-400" />
                                </div>
                            </div>
                            <div>
                                <label className="block text-base font-bold text-slate-700 mb-2">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                                <select value={editForm.category} onChange={(e) => setEditForm(prev => ({ ...prev, category: e.target.value }))} className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl text-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-400">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
                                    {categories.filter(c => c !== '–í—Å–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ').map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                </select>
                            </div>
                            <div>
                                <label className="block text-base font-bold text-slate-700 mb-2">–ò–ª–∏ –Ω–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                                <input type="text" value={editForm.newCategory} onChange={(e) => setEditForm(prev => ({ ...prev, newCategory: e.target.value }))} placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π" className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl text-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-400" />
                            </div>
                            <div>
                                <label className="block text-base font-bold text-slate-700 mb-2">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
                                <textarea value={editForm.note} onChange={(e) => setEditForm(prev => ({ ...prev, note: e.target.value }))} placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ" rows={3} className="w-full px-5 py-4 border-2 border-slate-200 rounded-2xl text-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-400 resize-none" />
                            </div>
                            <div className="flex gap-4 pt-4">
                                <button onClick={() => setEditModal({ open: false, item: null, isNew: false })} className="touch-btn flex-1 py-4 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-2xl font-bold text-lg active:scale-95">–û—Ç–º–µ–Ω–∞</button>
                                <button onClick={saveEdit} className="touch-btn flex-1 py-4 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-2xl font-black text-lg shadow-lg active:scale-95">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            </div>
                        </div>
                    </Modal>

                    {/* Quick Search Modal */}
                    <Modal isOpen={quickSearchModal.open} onClose={() => setQuickSearchModal({ open: false, query: '' })} title="üîç –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫">
                        <input
                            type="text"
                            value={quickSearchModal.query}
                            onChange={(e) => setQuickSearchModal(prev => ({ ...prev, query: e.target.value }))}
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ..."
                            className="w-full px-6 py-5 border-2 border-slate-200 rounded-2xl font-mono text-xl mb-5 focus:ring-4 focus:ring-indigo-100 focus:border-indigo-400"
                            autoFocus
                        />
                        <div className="max-h-80 overflow-y-auto border-2 border-slate-200 rounded-2xl">
                            {quickSearchResults.length === 0 ? (
                                <div className="p-10 text-center text-slate-400 text-lg font-medium">–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å...</div>
                            ) : (
                                quickSearchResults.map(item => (
                                    <button
                                        key={item.id}
                                        onClick={() => { setQuickSearchModal({ open: false, query: '' }); openDetails(item); }}
                                        className={`touch-btn w-full text-left p-5 border-b border-slate-100 hover:bg-slate-50 flex items-center gap-4 last:border-0 ${item.checked ? 'bg-emerald-50' : item.writeOff ? 'bg-red-50' : ''}`}
                                    >
                                        <div className={`w-12 h-12 rounded-xl flex items-center justify-center text-xl ${item.writeOff ? 'bg-red-500 text-white' : item.checked ? 'bg-emerald-500 text-white' : 'bg-amber-100 text-amber-600'}`}>
                                            {item.writeOff ? 'üìù' : item.checked ? '‚úÖ' : '‚è≥'}
                                        </div>
                                        <div className="flex-1 min-w-0">
                                            <div className="font-mono font-black text-indigo-600 text-lg">{item.invNumber}</div>
                                            <div className="text-base text-slate-500 truncate font-medium">{item.name}</div>
                                        </div>
                                    </button>
                                ))
                            )}
                        </div>
                        {quickSearchResults.length > 0 && <div className="mt-4 text-center text-base text-slate-400 font-bold">–ù–∞–π–¥–µ–Ω–æ: {quickSearchResults.length}</div>}
                    </Modal>

                    {/* Rooms Modal */}
                    <Modal isOpen={roomsModal.open} onClose={() => setRoomsModal({ open: false, newRoom: '' })} title="üè¢ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–∞–±–∏–Ω–µ—Ç–æ–≤">
                        <div className="flex gap-4 mb-5">
                            <input type="text" value={roomsModal.newRoom} onChange={(e) => setRoomsModal(prev => ({ ...prev, newRoom: e.target.value }))} onKeyDown={(e) => e.key === 'Enter' && addToDirectory('rooms', roomsModal.newRoom)} placeholder="–ù–æ–≤—ã–π –∫–∞–±–∏–Ω–µ—Ç..." className="flex-1 px-5 py-4 border-2 border-slate-200 rounded-2xl text-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-400" />
                            <button onClick={() => addToDirectory('rooms', roomsModal.newRoom)} className="touch-btn px-6 py-4 bg-gradient-to-r from-emerald-500 to-green-500 text-white rounded-2xl font-black text-2xl shadow-lg">+</button>
                        </div>
                        <div className="max-h-72 overflow-y-auto border-2 border-slate-200 rounded-2xl">
                            {directories.rooms.length === 0 ? (
                                <div className="p-10 text-center text-slate-400 text-lg">–ü—É—Å—Ç–æ</div>
                            ) : (
                                directories.rooms.map((room, idx) => (
                                    <div key={idx} className="flex items-center gap-4 p-4 border-b border-slate-100 last:border-0">
                                        <span className="flex-1 text-lg font-bold">üö™ {room}</span>
                                        <button onClick={() => removeFromDirectory('rooms', idx)} className="touch-btn p-3 bg-red-100 hover:bg-red-200 text-red-600 rounded-xl text-lg">üóëÔ∏è</button>
                                    </div>
                                ))
                            )}
                        </div>
                    </Modal>

                    {/* People Modal */}
                    <Modal isOpen={peopleModal.open} onClose={() => setPeopleModal({ open: false, newPerson: '' })} title="üë• –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –§–ò–û">
                        <div className="flex gap-4 mb-5">
                            <input type="text" value={peopleModal.newPerson} onChange={(e) => setPeopleModal(prev => ({ ...prev, newPerson: e.target.value }))} onKeyDown={(e) => e.key === 'Enter' && addToDirectory('people', peopleModal.newPerson)} placeholder="–ù–æ–≤–æ–µ –§–ò–û..." className="flex-1 px-5 py-4 border-2 border-slate-200 rounded-2xl text-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-400" />
                            <button onClick={() => addToDirectory('people', peopleModal.newPerson)} className="touch-btn px-6 py-4 bg-gradient-to-r from-emerald-500 to-green-500 text-white rounded-2xl font-black text-2xl shadow-lg">+</button>
                        </div>
                        <div className="max-h-72 overflow-y-auto border-2 border-slate-200 rounded-2xl">
                            {directories.people.length === 0 ? (
                                <div className="p-10 text-center text-slate-400 text-lg">–ü—É—Å—Ç–æ</div>
                            ) : (
                                directories.people.map((person, idx) => (
                                    <div key={idx} className="flex items-center gap-4 p-4 border-b border-slate-100 last:border-0">
                                        <span className="flex-1 text-lg font-bold">üë§ {person}</span>
                                        <button onClick={() => removeFromDirectory('people', idx)} className="touch-btn p-3 bg-red-100 hover:bg-red-200 text-red-600 rounded-xl text-lg">üóëÔ∏è</button>
                                    </div>
                                ))
                            )}
                        </div>
                    </Modal>

                    {/* Confirm Modal */}
                    <ConfirmModal
                        isOpen={confirmModal.open}
                        onClose={() => setConfirmModal({ ...confirmModal, open: false })}
                        onConfirm={confirmModal.onConfirm}
                        title={confirmModal.title}
                        message={confirmModal.message}
                        icon={confirmModal.icon}
                        confirmText={confirmModal.confirmText}
                        confirmColor={confirmModal.confirmColor}
                    />

                    {/* Toast */}
                    <Toast message={toast.message} type={toast.type} isVisible={toast.visible} onClose={() => setToast(prev => ({ ...prev, visible: false }))} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
