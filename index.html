<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ffffff">
    <title>–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        
        html { 
            font-size: 16px; 
            -webkit-font-smoothing: antialiased;
        }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
            background: #F2F2F7;
            color: #1C1C1E;
            line-height: 1.4;
            overflow: hidden;
            height: 100dvh;
            position: fixed;
            width: 100%;
        }
        
        /* iOS-style scrollbar */
        ::-webkit-scrollbar { width: 0; height: 0; }
        
        /* Safe areas */
        .safe-top { padding-top: env(safe-area-inset-top, 20px); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom, 20px); }
        
        /* iOS Card Style */
        .ios-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        }
        
        /* iOS List Group */
        .ios-list {
            background: white;
            border-radius: 12px;
            overflow: hidden;
        }
        .ios-list-item {
            padding: 14px 16px;
            border-bottom: 0.5px solid rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            min-height: 52px;
        }
        .ios-list-item:last-child { border-bottom: none; }
        .ios-list-item:active { background: #F2F2F7; }
        
        /* Touch targets */
        .touch-target {
            min-height: 48px;
            min-width: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* iOS Button */
        .ios-btn {
            min-height: 50px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 17px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: transform 0.1s, opacity 0.1s;
        }
        .ios-btn:active { transform: scale(0.98); opacity: 0.8; }
        
        .ios-btn-primary { background: #007AFF; color: white; }
        .ios-btn-success { background: #34C759; color: white; }
        .ios-btn-danger { background: #FF3B30; color: white; }
        .ios-btn-secondary { background: #E5E5EA; color: #1C1C1E; }
        .ios-btn-ghost { background: transparent; color: #007AFF; }
        
        /* Status Pills */
        .status-pill {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .status-checked { background: #D1FAE5; color: #059669; }
        .status-pending { background: #FEF3C7; color: #D97706; }
        .status-writeoff { background: #FEE2E2; color: #DC2626; }
        
        /* Bottom Tab Bar */
        .tab-bar {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 0.5px solid rgba(0,0,0,0.1);
        }
        .tab-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 4px;
            gap: 2px;
            color: #8E8E93;
            font-size: 10px;
            font-weight: 500;
            min-height: 50px;
        }
        .tab-item.active { color: #007AFF; }
        .tab-item svg { width: 24px; height: 24px; }
        
        /* Search Bar */
        .search-bar {
            background: rgba(142,142,147,0.12);
            border-radius: 12px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .search-bar input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            font-size: 17px;
            color: #1C1C1E;
        }
        .search-bar input::placeholder { color: #8E8E93; }
        
        /* Modal Sheet */
        .modal-sheet {
            position: fixed;
            inset: 0;
            z-index: 1000;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }
        .modal-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.4);
        }
        .modal-content {
            position: relative;
            background: #F2F2F7;
            border-radius: 20px 20px 0 0;
            width: 100%;
            max-height: 90dvh;
            overflow: hidden;
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        .modal-handle {
            width: 36px;
            height: 5px;
            background: #C7C7CC;
            border-radius: 3px;
            margin: 8px auto;
        }
        
        /* iPad Styles */
        @media (min-width: 768px) {
            .modal-content {
                max-width: 500px;
                margin: auto;
                border-radius: 20px;
                max-height: 80dvh;
            }
            .modal-sheet {
                align-items: center;
                padding: 20px;
            }
        }
        
        /* Large iPad / Desktop */
        @media (min-width: 1024px) {
            body { background: #E5E5EA; }
            .app-container {
                max-width: 1200px;
                margin: 0 auto;
                display: grid;
                grid-template-columns: 320px 1fr;
                gap: 0;
                height: 100dvh;
            }
            .sidebar-panel {
                display: flex !important;
                flex-direction: column;
                background: white;
                border-right: 0.5px solid rgba(0,0,0,0.1);
            }
            .main-content { background: #F2F2F7; }
            .tab-bar { display: none !important; }
            .mobile-header { display: none !important; }
        }
        
        @media (max-width: 1023px) {
            .sidebar-panel { display: none !important; }
        }
        
        /* Progress Ring */
        .progress-ring {
            transform: rotate(-90deg);
        }
        .progress-ring-circle {
            transition: stroke-dashoffset 0.5s ease;
        }
        
        /* Segment Control */
        .segment-control {
            background: rgba(142,142,147,0.12);
            border-radius: 10px;
            padding: 2px;
            display: flex;
            gap: 2px;
        }
        .segment-item {
            flex: 1;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            color: #1C1C1E;
            transition: all 0.2s;
        }
        .segment-item.active {
            background: white;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        }
        
        /* Equipment Card - Large Touch Target */
        .equipment-card {
            background: white;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
            transition: transform 0.15s;
        }
        .equipment-card:active {
            transform: scale(0.98);
        }
        
        /* Category Header */
        .category-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 20px 0 12px;
        }
        .category-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        /* Floating Action Button */
        .fab {
            position: fixed;
            width: 60px;
            height: 60px;
            border-radius: 30px;
            background: #007AFF;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(0,122,255,0.4);
            z-index: 100;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .fab:active {
            transform: scale(0.9);
        }
        .fab svg { width: 28px; height: 28px; }
        
        /* Quick Actions */
        .quick-action {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 16px 8px;
            border-radius: 14px;
            background: white;
            gap: 8px;
            min-height: 90px;
        }
        .quick-action-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }
        .quick-action-label {
            font-size: 12px;
            font-weight: 600;
            color: #8E8E93;
        }
        .quick-action-value {
            font-size: 20px;
            font-weight: 700;
            color: #1C1C1E;
        }
        
        /* Input iOS style */
        .ios-input {
            background: white;
            border: none;
            border-radius: 12px;
            padding: 16px;
            font-size: 17px;
            width: 100%;
            outline: none;
        }
        .ios-input:focus {
            box-shadow: 0 0 0 3px rgba(0,122,255,0.3);
        }
        
        /* Toast */
        .toast {
            position: fixed;
            top: calc(env(safe-area-inset-top, 20px) + 60px);
            left: 50%;
            transform: translateX(-50%);
            background: #1C1C1E;
            color: white;
            padding: 14px 24px;
            border-radius: 14px;
            font-weight: 600;
            font-size: 15px;
            z-index: 2000;
            animation: toastIn 0.3s ease-out;
        }
        @keyframes toastIn {
            from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        /* Scroll container */
        .scroll-content {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <input type="file" id="fileInput" accept=".json" style="display:none">

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback, useMemo } = React;

        // Icons
        const Icons = {
            Home: ({ active }) => <svg fill={active ? "currentColor" : "none"} stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={active ? 0 : 1.5} d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" /></svg>,
            Search: ({ active }) => <svg fill={active ? "currentColor" : "none"} stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" /></svg>,
            Settings: ({ active }) => <svg fill={active ? "currentColor" : "none"} stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>,
            Plus: () => <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.5} d="M12 4.5v15m7.5-7.5h-15" /></svg>,
            Check: () => <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.5} d="M4.5 12.75l6 6 9-13.5" /></svg>,
            X: () => <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>,
            ChevronRight: () => <svg className="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.25 4.5l7.5 7.5-7.5 7.5" /></svg>,
            Filter: ({ active }) => <svg fill={active ? "currentColor" : "none"} stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 01-.659 1.591l-5.432 5.432a2.25 2.25 0 00-.659 1.591v2.927a2.25 2.25 0 01-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 00-.659-1.591L3.659 7.409A2.25 2.25 0 013 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0112 3z" /></svg>,
        };

        // Initial Data
        const initialEquipment = [
            {id:"item_0",name:"–ú–§–£ –≥—Ä—É–ø–ø–æ–≤–æ–µ, —Ü–≤–µ—Ç–Ω–æ–µ OKI MC563dn",invNumber:"1101340057",date:"29.12.2017",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–ü—Ä–∏–Ω—Ç–µ—Ä—ã –∏ –ú–§–£",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_1",name:"–ü—Ä–∏–Ω—Ç–µ—Ä –≥—Ä—É–ø–ø–æ–≤–æ–π Epson WorkForce Pro WF-M5190DW",invNumber:"1101340077",date:"22.03.2018",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–ü—Ä–∏–Ω—Ç–µ—Ä—ã –∏ –ú–§–£",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_2",name:"–ê–∫—É—Å—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞—É–¥–∏—Ç–æ—Ä–∏–∏",invNumber:"1101340084",date:"30.03.2018",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–ê—É–¥–∏–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_3",name:"–ê–∫—É—Å—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞—É–¥–∏—Ç–æ—Ä–∏–∏",invNumber:"1101340095",date:"30.03.2018",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–ê—É–¥–∏–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_4",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ IRBIS",invNumber:"0101340042",date:"23.12.2020",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_5",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ IRBIS",invNumber:"0101340043",date:"23.12.2020",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_415",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-50",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_416",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-51",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_417",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-52",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_418",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-53",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_419",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-54",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_420",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-55",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_421",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-56",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_422",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å ICL InfoRay",invNumber:"–ë–î-57",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
        ];

        const categoryConfig = {
            "–ê—É–¥–∏–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ": { icon: "üîä", color: "#8B5CF6", bg: "#EDE9FE" },
            "–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ": { icon: "üì±", color: "#3B82F6", bg: "#DBEAFE" },
            "–ü—Ä–∏–Ω—Ç–µ—Ä—ã –∏ –ú–§–£": { icon: "üñ®Ô∏è", color: "#06B6D4", bg: "#CFFAFE" },
            "–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã": { icon: "üì∫", color: "#10B981", bg: "#D1FAE5" },
        };
        const defaultCat = { icon: "üì¶", color: "#6B7280", bg: "#F3F4F6" };

        // Progress Ring Component
        const ProgressRing = ({ percent, size = 80 }) => {
            const strokeWidth = 8;
            const radius = (size - strokeWidth) / 2;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (percent / 100) * circumference;
            
            return (
                <div className="relative" style={{ width: size, height: size }}>
                    <svg className="progress-ring" width={size} height={size}>
                        <circle stroke="#E5E7EB" strokeWidth={strokeWidth} fill="transparent" r={radius} cx={size/2} cy={size/2} />
                        <circle className="progress-ring-circle" stroke="#34C759" strokeWidth={strokeWidth} fill="transparent" r={radius} cx={size/2} cy={size/2}
                            strokeDasharray={circumference} strokeDashoffset={offset} strokeLinecap="round" />
                    </svg>
                    <div className="absolute inset-0 flex flex-col items-center justify-center">
                        <span className="text-2xl font-bold text-gray-900">{percent}%</span>
                    </div>
                </div>
            );
        };

        // Toast Component
        const Toast = ({ message, visible, onClose }) => {
            useEffect(() => {
                if (visible) {
                    const t = setTimeout(onClose, 2000);
                    return () => clearTimeout(t);
                }
            }, [visible, onClose]);
            
            if (!visible) return null;
            return <div className="toast">{message}</div>;
        };

        // Modal Sheet
        const ModalSheet = ({ open, onClose, title, children }) => {
            if (!open) return null;
            return (
                <div className="modal-sheet">
                    <div className="modal-backdrop" onClick={onClose} />
                    <div className="modal-content safe-bottom">
                        <div className="modal-handle" />
                        {title && (
                            <div className="px-5 pb-4 flex items-center justify-between">
                                <h2 className="text-xl font-bold text-gray-900">{title}</h2>
                                <button onClick={onClose} className="touch-target text-gray-400">
                                    <Icons.X />
                                </button>
                            </div>
                        )}
                        <div className="scroll-content px-5 pb-5 max-h-[70vh]">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        // Equipment Card
        const EquipmentCard = React.memo(({ item, onTap, onQuickCheck }) => {
            const config = categoryConfig[item.category] || defaultCat;
            const status = item.writeOff ? 'writeoff' : item.checked ? 'checked' : 'pending';
            
            return (
                <div className="equipment-card" onClick={() => onTap(item)}>
                    <div className="flex items-start gap-4">
                        <div className="w-12 h-12 rounded-xl flex items-center justify-center text-2xl flex-shrink-0"
                            style={{ background: status === 'writeoff' ? '#FEE2E2' : status === 'checked' ? '#D1FAE5' : config.bg }}>
                            {status === 'writeoff' ? 'üìù' : status === 'checked' ? '‚úì' : config.icon}
                        </div>
                        
                        <div className="flex-1 min-w-0">
                            <div className="flex items-center gap-2 mb-1">
                                <span className="px-2 py-1 bg-blue-100 text-blue-700 rounded-lg text-xs font-bold font-mono">
                                    {item.invNumber}
                                </span>
                                {item.hasLabel === false && (
                                    <span className="px-2 py-1 bg-amber-100 text-amber-700 rounded-lg text-xs font-bold">
                                        –ë–ï–ó –ë–ò–†–ö–ò
                                    </span>
                                )}
                            </div>
                            <h3 className="font-semibold text-gray-900 text-base leading-snug line-clamp-2 mb-2">
                                {item.name}
                            </h3>
                            
                            <div className="flex items-center gap-2 flex-wrap">
                                <span className={`status-pill status-${status}`}>
                                    {status === 'writeoff' ? '–°–ø–∏—Å–∞–Ω–∏–µ' : status === 'checked' ? '‚úì –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ' : '‚è≥ –û–∂–∏–¥–∞–µ—Ç'}
                                </span>
                                {item.location && (
                                    <span className="text-xs text-gray-500">üìç {item.location}</span>
                                )}
                                {item.inventoryNote && (
                                    <span className="text-xs text-blue-500">üí¨</span>
                                )}
                            </div>
                        </div>
                        
                        {!item.checked && !item.writeOff && (
                            <button 
                                onClick={(e) => { e.stopPropagation(); onQuickCheck(item); }}
                                className="w-12 h-12 rounded-full bg-green-500 text-white flex items-center justify-center flex-shrink-0"
                            >
                                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
                                </svg>
                            </button>
                        )}
                    </div>
                </div>
            );
        });

        // Main App
        const App = () => {
            // State
            const [equipment, setEquipment] = useState(() => {
                try {
                    const saved = localStorage.getItem('inv_102_v12');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        return initialEquipment.map(item => {
                            const savedItem = parsed.find(p => p.id === item.id);
                            return savedItem ? { ...item, ...savedItem } : item;
                        }).concat(parsed.filter(p => p.isUserAdded && !initialEquipment.find(i => i.id === p.id)));
                    }
                } catch (e) { console.error(e); }
                return initialEquipment;
            });

            const [directories, setDirectories] = useState(() => {
                try {
                    const saved = localStorage.getItem('inv_102_dirs_v12');
                    return saved ? JSON.parse(saved) : { rooms: [], people: [] };
                } catch { return { rooms: [], people: [] }; }
            });

            const [activeTab, setActiveTab] = useState('home');
            const [searchQuery, setSearchQuery] = useState('');
            const [activeFilter, setActiveFilter] = useState('all');
            const [selectedItem, setSelectedItem] = useState(null);
            const [showItemModal, setShowItemModal] = useState(false);
            const [showLabelModal, setShowLabelModal] = useState(false);
            const [showSerialModal, setShowSerialModal] = useState(false);
            const [showAddModal, setShowAddModal] = useState(false);
            const [showSettingsModal, setShowSettingsModal] = useState(false);
            const [showFilterModal, setShowFilterModal] = useState(false);
            const [serialInput, setSerialInput] = useState('');
            const [toast, setToast] = useState({ visible: false, message: '' });
            
            const [itemForm, setItemForm] = useState({
                serialNumber: '', location: '', responsible: '', inventoryNote: '', hasLabel: null
            });
            
            const [newItem, setNewItem] = useState({
                name: '', invNumber: '', category: '', location: ''
            });

            // Save to localStorage
            useEffect(() => { localStorage.setItem('inv_102_v12', JSON.stringify(equipment)); }, [equipment]);
            useEffect(() => { localStorage.setItem('inv_102_dirs_v12', JSON.stringify(directories)); }, [directories]);

            // Stats
            const stats = useMemo(() => ({
                total: equipment.length,
                checked: equipment.filter(i => i.checked || i.writeOff).length,
                pending: equipment.filter(i => !i.checked && !i.writeOff).length,
                writeOff: equipment.filter(i => i.writeOff).length,
                noLabel: equipment.filter(i => i.hasLabel === false).length,
            }), [equipment]);

            const percent = stats.total > 0 ? Math.round((stats.checked / stats.total) * 100) : 0;

            // Categories
            const categories = useMemo(() => 
                [...new Set(equipment.map(i => i.category).filter(Boolean))].sort((a, b) => a.localeCompare(b, 'ru')),
            [equipment]);

            // Filtered equipment
            const filteredEquipment = useMemo(() => {
                return equipment.filter(item => {
                    // Filter
                    if (activeFilter === 'pending' && (item.checked || item.writeOff)) return false;
                    if (activeFilter === 'checked' && !item.checked && !item.writeOff) return false;
                    if (activeFilter === 'writeoff' && !item.writeOff) return false;
                    if (activeFilter === 'nolabel' && item.hasLabel !== false) return false;
                    
                    // Search
                    if (searchQuery) {
                        const q = searchQuery.toLowerCase();
                        const s = [item.invNumber, item.name, item.serialNumber, item.location].join(' ').toLowerCase();
                        if (!s.includes(q)) return false;
                    }
                    return true;
                });
            }, [equipment, activeFilter, searchQuery]);

            // Group by category
            const groupedEquipment = useMemo(() => {
                return filteredEquipment.reduce((acc, item) => {
                    const cat = item.category || '–ü—Ä–æ—á–µ–µ';
                    if (!acc[cat]) acc[cat] = [];
                    acc[cat].push(item);
                    return acc;
                }, {});
            }, [filteredEquipment]);

            // Handlers
            const showToast = useCallback((msg) => setToast({ visible: true, message: msg }), []);

            const openItemDetails = useCallback((item) => {
                setSelectedItem(item);
                setItemForm({
                    serialNumber: item.serialNumber || '',
                    location: item.location || '',
                    responsible: item.responsible || '',
                    inventoryNote: item.inventoryNote || '',
                    hasLabel: item.hasLabel
                });
                setShowItemModal(true);
            }, []);

            const handleQuickCheck = useCallback((item) => {
                setSelectedItem(item);
                if (item.hasLabel === null) {
                    setShowLabelModal(true);
                } else if (!item.serialNumber?.trim()) {
                    setSerialInput('');
                    setShowSerialModal(true);
                } else {
                    setEquipment(prev => prev.map(i => i.id === item.id ? 
                        { ...i, checked: true, writeOff: false, checkedAt: new Date().toISOString() } : i));
                    showToast('‚úì –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ');
                }
            }, [showToast]);

            const handleLabelAnswer = useCallback((hasLabel) => {
                setEquipment(prev => prev.map(i => i.id === selectedItem.id ? { ...i, hasLabel } : i));
                setShowLabelModal(false);
                
                if (!selectedItem.serialNumber?.trim()) {
                    setSerialInput('');
                    setShowSerialModal(true);
                } else {
                    setEquipment(prev => prev.map(i => i.id === selectedItem.id ? 
                        { ...i, checked: true, checkedAt: new Date().toISOString() } : i));
                    showToast('‚úì –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ');
                }
            }, [selectedItem, showToast]);

            const handleSerialSubmit = useCallback((skip = false) => {
                const serial = skip ? '' : serialInput.trim();
                setEquipment(prev => prev.map(i => i.id === selectedItem.id ? 
                    { ...i, serialNumber: serial, checked: true, writeOff: false, checkedAt: new Date().toISOString() } : i));
                setShowSerialModal(false);
                setSerialInput('');
                showToast('‚úì –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ');
            }, [selectedItem, serialInput, showToast]);

            const saveItemDetails = useCallback(() => {
                setEquipment(prev => prev.map(i => i.id === selectedItem.id ? { ...i, ...itemForm } : i));
                
                // Add to directories
                if (itemForm.location && !directories.rooms.includes(itemForm.location)) {
                    setDirectories(prev => ({ ...prev, rooms: [...prev.rooms, itemForm.location].sort() }));
                }
                if (itemForm.responsible && !directories.people.includes(itemForm.responsible)) {
                    setDirectories(prev => ({ ...prev, people: [...prev.people, itemForm.responsible].sort() }));
                }
                
                setShowItemModal(false);
                showToast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
            }, [selectedItem, itemForm, directories, showToast]);

            const handleWriteOff = useCallback(() => {
                setEquipment(prev => prev.map(i => i.id === selectedItem.id ? 
                    { ...i, writeOff: true, checked: false, checkedAt: new Date().toISOString() } : i));
                setShowItemModal(false);
                showToast('üìù –°–ø–∏—Å–∞–Ω–æ');
            }, [selectedItem, showToast]);

            const handleUncheck = useCallback(() => {
                setEquipment(prev => prev.map(i => i.id === selectedItem.id ? 
                    { ...i, checked: false, writeOff: false, checkedAt: null } : i));
                setShowItemModal(false);
                showToast('‚Ü© –û—Ç–º–µ–Ω–µ–Ω–æ');
            }, [selectedItem, showToast]);

            const handleAddItem = useCallback(() => {
                if (!newItem.name.trim() || !newItem.invNumber.trim()) {
                    showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è');
                    return;
                }
                const item = {
                    id: 'item_' + Date.now(),
                    ...newItem,
                    checked: false,
                    writeOff: false,
                    hasLabel: null,
                    serialNumber: '',
                    responsible: '',
                    inventoryNote: '',
                    isUserAdded: true,
                    date: new Date().toLocaleDateString('ru-RU')
                };
                setEquipment(prev => [...prev, item]);
                setShowAddModal(false);
                setNewItem({ name: '', invNumber: '', category: '', location: '' });
                showToast('–î–æ–±–∞–≤–ª–µ–Ω–æ');
            }, [newItem, showToast]);

            const handleExport = useCallback(() => {
                const BOM = '\uFEFF';
                const headers = ['–ò–Ω–≤.‚Ññ', '–ù–∞–∑–≤–∞–Ω–∏–µ', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è', 'S/N', '–õ–æ–∫–∞—Ü–∏—è', '–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π', '–°—Ç–∞—Ç—É—Å', '–ë–∏—Ä–∫–∞', '–ó–∞–º–µ—Ç–∫–∞'];
                let csv = BOM + headers.join(';') + '\n';
                equipment.forEach(item => {
                    const status = item.writeOff ? '–°–ø–∏—Å–∞–Ω–∏–µ' : item.checked ? '–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ' : '–û–∂–∏–¥–∞–µ—Ç';
                    const label = item.hasLabel === true ? '–ï—Å—Ç—å' : item.hasLabel === false ? '–ù–µ—Ç' : '-';
                    const row = [item.invNumber, item.name, item.category, item.serialNumber || '', 
                        item.location || '', item.responsible || '', status, label, item.inventoryNote || '']
                        .map(f => `"${String(f).replace(/"/g, '""')}"`).join(';');
                    csv += row + '\n';
                });
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `inventory_${new Date().toISOString().slice(0, 10)}.csv`;
                link.click();
                showToast('üìä –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ');
            }, [equipment, showToast]);

            const handleBackup = useCallback(() => {
                const data = JSON.stringify({ equipment, directories }, null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `backup_${new Date().toISOString().slice(0, 10)}.json`;
                link.click();
                showToast('üíæ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞');
            }, [equipment, directories, showToast]);

            const handleRestore = useCallback(() => {
                document.getElementById('fileInput').click();
            }, []);

            const handleFileImport = useCallback((e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const json = JSON.parse(event.target.result);
                        if (json.equipment) {
                            setEquipment(json.equipment);
                        }
                        if (json.directories) {
                            setDirectories(json.directories);
                        }
                        showToast('üì• –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                    } catch {
                        showToast('‚ùå –û—à–∏–±–∫–∞ —Ñ–∞–π–ª–∞');
                    }
                };
                reader.readAsText(file);
                e.target.value = '';
            }, [showToast]);

            const handleReset = useCallback(() => {
                if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?')) {
                    setEquipment(initialEquipment);
                    showToast('üóëÔ∏è –î–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã');
                }
            }, [showToast]);

            // Render
            return (
                <div className="app-container" style={{ height: '100dvh' }}>
                    {/* Sidebar for iPad/Desktop */}
                    <aside className="sidebar-panel">
                        <div className="p-5 border-b border-gray-100">
                            <h1 className="text-2xl font-bold text-gray-900 mb-1">–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è</h1>
                            <p className="text-sm text-gray-500">–ì–ö–û–£ –°–ö–û–®–ò ‚Ññ102</p>
                        </div>
                        
                        <div className="p-5 border-b border-gray-100">
                            <div className="flex items-center gap-5">
                                <ProgressRing percent={percent} />
                                <div className="flex-1">
                                    <div className="flex justify-between mb-2">
                                        <span className="text-sm text-gray-500">–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</span>
                                        <span className="text-sm font-bold text-green-600">{stats.checked}</span>
                                    </div>
                                    <div className="flex justify-between mb-2">
                                        <span className="text-sm text-gray-500">–û–∂–∏–¥–∞—é—Ç</span>
                                        <span className="text-sm font-bold text-amber-600">{stats.pending}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span className="text-sm text-gray-500">–°–ø–∏—Å–∞–Ω–∏–µ</span>
                                        <span className="text-sm font-bold text-red-600">{stats.writeOff}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="p-4">
                            <div className="search-bar mb-4">
                                <svg className="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                                </svg>
                                <input 
                                    type="text" 
                                    value={searchQuery} 
                                    onChange={e => setSearchQuery(e.target.value)}
                                    placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏—é"
                                />
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto p-4 pt-0">
                            <p className="text-xs font-semibold text-gray-400 uppercase mb-3 px-1">–§–∏–ª—å—Ç—Ä—ã</p>
                            <div className="ios-list mb-6">
                                {[
                                    { id: 'all', label: '–í—Å–µ', count: stats.total, icon: 'üìã' },
                                    { id: 'pending', label: '–û–∂–∏–¥–∞—é—Ç', count: stats.pending, icon: '‚è≥' },
                                    { id: 'checked', label: '–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ', count: stats.checked, icon: '‚úì' },
                                    { id: 'writeoff', label: '–°–ø–∏—Å–∞–Ω–∏–µ', count: stats.writeOff, icon: 'üìù' },
                                    { id: 'nolabel', label: '–ë–µ–∑ –±–∏—Ä–∫–∏', count: stats.noLabel, icon: '‚ö†Ô∏è' },
                                ].map(f => (
                                    <button key={f.id} onClick={() => setActiveFilter(f.id)}
                                        className={`ios-list-item w-full ${activeFilter === f.id ? 'bg-blue-50' : ''}`}>
                                        <span className="text-lg">{f.icon}</span>
                                        <span className="flex-1 text-left text-sm font-medium">{f.label}</span>
                                        <span className={`text-sm font-semibold ${activeFilter === f.id ? 'text-blue-600' : 'text-gray-400'}`}>
                                            {f.count}
                                        </span>
                                    </button>
                                ))}
                            </div>

                            <p className="text-xs font-semibold text-gray-400 uppercase mb-3 px-1">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</p>
                            <div className="ios-list">
                                {categories.map(cat => {
                                    const config = categoryConfig[cat] || defaultCat;
                                    const count = equipment.filter(i => i.category === cat).length;
                                    return (
                                        <button key={cat} onClick={() => { setActiveFilter('all'); setSearchQuery(cat); }}
                                            className="ios-list-item w-full">
                                            <span className="text-lg">{config.icon}</span>
                                            <span className="flex-1 text-left text-sm font-medium truncate">{cat}</span>
                                            <span className="text-sm font-semibold text-gray-400">{count}</span>
                                        </button>
                                    );
                                })}
                            </div>
                        </div>

                        <div className="p-4 border-t border-gray-100">
                            <button onClick={() => setShowAddModal(true)} 
                                className="ios-btn ios-btn-primary w-full">
                                <Icons.Plus /> –î–æ–±–∞–≤–∏—Ç—å
                            </button>
                        </div>
                    </aside>

                    {/* Main Content */}
                    <main className="main-content flex flex-col" style={{ height: '100dvh' }}>
                        {/* Mobile Header */}
                        <header className="mobile-header safe-top bg-white/90 backdrop-blur-lg border-b border-gray-100 px-4 py-3 flex-shrink-0 lg:hidden">
                            <div className="flex items-center justify-between mb-3">
                                <div>
                                    <h1 className="text-xl font-bold text-gray-900">–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è</h1>
                                    <p className="text-xs text-gray-500">{stats.checked} –∏–∑ {stats.total} –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ</p>
                                </div>
                                <ProgressRing percent={percent} size={50} />
                            </div>
                            <div className="search-bar">
                                <svg className="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                                </svg>
                                <input 
                                    type="text" 
                                    value={searchQuery} 
                                    onChange={e => setSearchQuery(e.target.value)}
                                    placeholder="–ü–æ–∏—Å–∫..."
                                />
                                <button onClick={() => setShowFilterModal(true)} 
                                    className={`touch-target rounded-lg ${activeFilter !== 'all' ? 'text-blue-600' : 'text-gray-400'}`}>
                                    <Icons.Filter active={activeFilter !== 'all'} />
                                </button>
                            </div>
                        </header>

                        {/* Quick Stats for Mobile */}
                        <div className="lg:hidden px-4 py-3 flex gap-3 overflow-x-auto flex-shrink-0" style={{ scrollbarWidth: 'none' }}>
                            {[
                                { id: 'pending', label: '–û–∂–∏–¥–∞—é—Ç', value: stats.pending, color: '#F59E0B', bg: '#FEF3C7' },
                                { id: 'checked', label: '–ì–æ—Ç–æ–≤–æ', value: stats.checked, color: '#10B981', bg: '#D1FAE5' },
                                { id: 'writeoff', label: '–°–ø–∏—Å–∞–Ω–æ', value: stats.writeOff, color: '#EF4444', bg: '#FEE2E2' },
                                { id: 'nolabel', label: '–ë–µ–∑ –±–∏—Ä–∫–∏', value: stats.noLabel, color: '#8B5CF6', bg: '#EDE9FE' },
                            ].map(s => (
                                <button key={s.id} onClick={() => setActiveFilter(activeFilter === s.id ? 'all' : s.id)}
                                    className={`quick-action flex-shrink-0 min-w-[90px] ${activeFilter === s.id ? 'ring-2 ring-blue-500' : ''}`}>
                                    <div className="quick-action-icon" style={{ background: s.bg }}>
                                        <span style={{ color: s.color, fontWeight: 700 }}>{s.value}</span>
                                    </div>
                                    <span className="quick-action-label">{s.label}</span>
                                </button>
                            ))}
                        </div>

                        {/* Equipment List */}
                        <div className="scroll-content px-4 pb-24 lg:pb-8 lg:pt-4">
                            {Object.keys(groupedEquipment).length === 0 ? (
                                <div className="flex flex-col items-center justify-center h-64 text-gray-400">
                                    <span className="text-5xl mb-4">üì≠</span>
                                    <p className="text-lg font-medium">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
                                    <p className="text-sm">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä</p>
                                </div>
                            ) : (
                                Object.entries(groupedEquipment)
                                    .sort((a, b) => a[0].localeCompare(b[0], 'ru'))
                                    .map(([category, items]) => {
                                        const config = categoryConfig[category] || defaultCat;
                                        const checkedCount = items.filter(i => i.checked || i.writeOff).length;
                                        return (
                                            <div key={category}>
                                                <div className="category-header">
                                                    <div className="category-icon" style={{ background: config.bg }}>
                                                        {config.icon}
                                                    </div>
                                                    <div className="flex-1">
                                                        <h2 className="font-bold text-gray-900">{category}</h2>
                                                        <p className="text-xs text-gray-500">{checkedCount} / {items.length} –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ</p>
                                                    </div>
                                                </div>
                                                {items.map(item => (
                                                    <EquipmentCard 
                                                        key={item.id} 
                                                        item={item} 
                                                        onTap={openItemDetails}
                                                        onQuickCheck={handleQuickCheck}
                                                    />
                                                ))}
                                            </div>
                                        );
                                    })
                            )}
                        </div>

                        {/* FAB for Mobile */}
                        <button onClick={() => setShowAddModal(true)}
                            className="fab lg:hidden"
                            style={{ bottom: 'calc(env(safe-area-inset-bottom, 20px) + 70px)', right: 20 }}>
                            <Icons.Plus />
                        </button>

                        {/* Bottom Tab Bar - Mobile */}
                        <nav className="tab-bar safe-bottom fixed bottom-0 left-0 right-0 flex lg:hidden">
                            <button onClick={() => { setActiveFilter('all'); setSearchQuery(''); }} 
                                className={`tab-item ${activeTab === 'home' ? 'active' : ''}`}>
                                <Icons.Home active={activeTab === 'home'} />
                                <span>–ì–ª–∞–≤–Ω–∞—è</span>
                            </button>
                            <button onClick={() => setShowFilterModal(true)} className="tab-item">
                                <Icons.Filter active={false} />
                                <span>–§–∏–ª—å—Ç—Ä—ã</span>
                            </button>
                            <button onClick={() => setShowSettingsModal(true)} className="tab-item">
                                <Icons.Settings active={false} />
                                <span>–ï—â—ë</span>
                            </button>
                        </nav>
                    </main>

                    {/* Modals */}
                    
                    {/* Item Details Modal */}
                    <ModalSheet open={showItemModal} onClose={() => setShowItemModal(false)} title="–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ">
                        {selectedItem && (
                            <div className="space-y-5">
                                <div className="ios-card p-4">
                                    <div className="flex items-center gap-2 mb-2">
                                        <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-sm font-bold font-mono">
                                            {selectedItem.invNumber}
                                        </span>
                                        {selectedItem.isUserAdded && (
                                            <span className="px-2 py-1 bg-purple-100 text-purple-700 rounded-lg text-xs font-bold">–ù–û–í–û–ï</span>
                                        )}
                                    </div>
                                    <h3 className="font-semibold text-gray-900 text-lg mb-1">{selectedItem.name}</h3>
                                    <p className="text-sm text-gray-500">{selectedItem.category}</p>
                                </div>

                                <div>
                                    <p className="text-sm font-semibold text-gray-500 mb-2 px-1">–ë–∏—Ä–∫–∞ –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏</p>
                                    <div className="grid grid-cols-2 gap-3">
                                        <button onClick={() => setItemForm(f => ({ ...f, hasLabel: true }))}
                                            className={`ios-btn ${itemForm.hasLabel === true ? 'ios-btn-success' : 'ios-btn-secondary'}`}>
                                            ‚úì –ï—Å—Ç—å
                                        </button>
                                        <button onClick={() => setItemForm(f => ({ ...f, hasLabel: false }))}
                                            className={`ios-btn ${itemForm.hasLabel === false ? 'ios-btn-danger' : 'ios-btn-secondary'}`}>
                                            ‚úó –ù–µ—Ç
                                        </button>
                                    </div>
                                </div>

                                <div>
                                    <p className="text-sm font-semibold text-gray-500 mb-2 px-1">–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä</p>
                                    <input type="text" value={itemForm.serialNumber} 
                                        onChange={e => setItemForm(f => ({ ...f, serialNumber: e.target.value }))}
                                        placeholder="S/N" className="ios-input font-mono" />
                                </div>

                                <div>
                                    <p className="text-sm font-semibold text-gray-500 mb-2 px-1">–ö–∞–±–∏–Ω–µ—Ç / –õ–æ–∫–∞—Ü–∏—è</p>
                                    <input type="text" value={itemForm.location}
                                        onChange={e => setItemForm(f => ({ ...f, location: e.target.value }))}
                                        placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–∞–±–∏–Ω–µ—Ç 101" className="ios-input" 
                                        list="rooms-list" />
                                    <datalist id="rooms-list">
                                        {directories.rooms.map((r, i) => <option key={i} value={r} />)}
                                    </datalist>
                                </div>

                                <div>
                                    <p className="text-sm font-semibold text-gray-500 mb-2 px-1">–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</p>
                                    <input type="text" value={itemForm.responsible}
                                        onChange={e => setItemForm(f => ({ ...f, responsible: e.target.value }))}
                                        placeholder="–§–ò–û" className="ios-input"
                                        list="people-list" />
                                    <datalist id="people-list">
                                        {directories.people.map((p, i) => <option key={i} value={p} />)}
                                    </datalist>
                                </div>

                                <div>
                                    <p className="text-sm font-semibold text-gray-500 mb-2 px-1">–ó–∞–º–µ—Ç–∫–∞</p>
                                    <textarea value={itemForm.inventoryNote}
                                        onChange={e => setItemForm(f => ({ ...f, inventoryNote: e.target.value }))}
                                        placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –∫ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏..."
                                        rows={3} className="ios-input resize-none" />
                                </div>

                                <div className="grid grid-cols-2 gap-3">
                                    {(selectedItem.checked || selectedItem.writeOff) ? (
                                        <button onClick={handleUncheck} className="ios-btn ios-btn-secondary">
                                            ‚Ü© –û—Ç–º–µ–Ω–∏—Ç—å
                                        </button>
                                    ) : (
                                        <button onClick={handleWriteOff} className="ios-btn ios-btn-danger">
                                            üìù –°–ø–∏—Å–∞—Ç—å
                                        </button>
                                    )}
                                    <button onClick={saveItemDetails} className="ios-btn ios-btn-primary">
                                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                        )}
                    </ModalSheet>

                    {/* Label Check Modal */}
                    <ModalSheet open={showLabelModal} onClose={() => setShowLabelModal(false)} title="–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏—Ä–∫–∏">
                        <div className="text-center py-6">
                            <div className="text-6xl mb-6">üè∑Ô∏è</div>
                            <h3 className="text-xl font-bold text-gray-900 mb-2">–ë–∏—Ä–∫–∞ –µ—Å—Ç—å?</h3>
                            <p className="text-gray-500 mb-8">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–Ω–æ–π –±–∏—Ä–∫–∏ –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏</p>
                            <div className="space-y-3">
                                <button onClick={() => handleLabelAnswer(true)} className="ios-btn ios-btn-success w-full">
                                    ‚úì –î–∞, –±–∏—Ä–∫–∞ –µ—Å—Ç—å
                                </button>
                                <button onClick={() => handleLabelAnswer(false)} className="ios-btn ios-btn-danger w-full">
                                    ‚úó –ù–µ—Ç –±–∏—Ä–∫–∏
                                </button>
                                <button onClick={() => setShowLabelModal(false)} className="ios-btn ios-btn-ghost w-full">
                                    –û—Ç–º–µ–Ω–∞
                                </button>
                            </div>
                        </div>
                    </ModalSheet>

                    {/* Serial Number Modal */}
                    <ModalSheet open={showSerialModal} onClose={() => setShowSerialModal(false)} title="–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä">
                        <div className="text-center py-4">
                            <div className="text-5xl mb-4">üî¢</div>
                            <h3 className="text-xl font-bold text-gray-900 mb-2">–í–≤–µ–¥–∏—Ç–µ S/N</h3>
                            <p className="text-gray-500 mb-6">–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)</p>
                            <input type="text" value={serialInput} onChange={e => setSerialInput(e.target.value)}
                                placeholder="–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä" className="ios-input text-center font-mono text-lg mb-6" autoFocus />
                            <div className="space-y-3">
                                <button onClick={() => handleSerialSubmit(false)} className="ios-btn ios-btn-success w-full">
                                    ‚úì –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                </button>
                                <button onClick={() => handleSerialSubmit(true)} className="ios-btn ios-btn-secondary w-full">
                                    –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    </ModalSheet>

                    {/* Add Item Modal */}
                    <ModalSheet open={showAddModal} onClose={() => setShowAddModal(false)} title="–ù–æ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ">
                        <div className="space-y-4">
                            <div>
                                <p className="text-sm font-semibold text-gray-500 mb-2 px-1">–ù–∞–∑–≤–∞–Ω–∏–µ *</p>
                                <input type="text" value={newItem.name}
                                    onChange={e => setNewItem(n => ({ ...n, name: e.target.value }))}
                                    placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è" className="ios-input" />
                            </div>
                            <div>
                                <p className="text-sm font-semibold text-gray-500 mb-2 px-1">–ò–Ω–≤. –Ω–æ–º–µ—Ä *</p>
                                <input type="text" value={newItem.invNumber}
                                    onChange={e => setNewItem(n => ({ ...n, invNumber: e.target.value }))}
                                    placeholder="–ò–Ω–≤–µ–Ω—Ç–∞—Ä–Ω—ã–π –Ω–æ–º–µ—Ä" className="ios-input font-mono" />
                            </div>
                            <div>
                                <p className="text-sm font-semibold text-gray-500 mb-2 px-1">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</p>
                                <select value={newItem.category}
                                    onChange={e => setNewItem(n => ({ ...n, category: e.target.value }))}
                                    className="ios-input">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                    {categories.map(c => <option key={c} value={c}>{c}</option>)}
                                </select>
                            </div>
                            <div>
                                <p className="text-sm font-semibold text-gray-500 mb-2 px-1">–ö–∞–±–∏–Ω–µ—Ç</p>
                                <input type="text" value={newItem.location}
                                    onChange={e => setNewItem(n => ({ ...n, location: e.target.value }))}
                                    placeholder="–ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è" className="ios-input" list="rooms-list" />
                            </div>
                            <button onClick={handleAddItem} className="ios-btn ios-btn-primary w-full mt-4">
                                <Icons.Plus /> –î–æ–±–∞–≤–∏—Ç—å
                            </button>
                        </div>
                    </ModalSheet>

                    {/* Filter Modal */}
                    <ModalSheet open={showFilterModal} onClose={() => setShowFilterModal(false)} title="–§–∏–ª—å—Ç—Ä—ã">
                        <div className="ios-list">
                            {[
                                { id: 'all', label: '–í—Å–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ', count: stats.total, icon: 'üìã' },
                                { id: 'pending', label: '–û–∂–∏–¥–∞—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏', count: stats.pending, icon: '‚è≥' },
                                { id: 'checked', label: '–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ', count: stats.checked, icon: '‚úì' },
                                { id: 'writeoff', label: '–ù–∞ —Å–ø–∏—Å–∞–Ω–∏–µ', count: stats.writeOff, icon: 'üìù' },
                                { id: 'nolabel', label: '–ë–µ–∑ –±–∏—Ä–∫–∏', count: stats.noLabel, icon: '‚ö†Ô∏è' },
                            ].map(f => (
                                <button key={f.id} onClick={() => { setActiveFilter(f.id); setShowFilterModal(false); }}
                                    className={`ios-list-item w-full ${activeFilter === f.id ? 'bg-blue-50' : ''}`}>
                                    <span className="text-xl">{f.icon}</span>
                                    <span className="flex-1 text-left font-medium">{f.label}</span>
                                    <span className={`font-bold ${activeFilter === f.id ? 'text-blue-600' : 'text-gray-400'}`}>{f.count}</span>
                                    {activeFilter === f.id && <span className="text-blue-600">‚úì</span>}
                                </button>
                            ))}
                        </div>
                    </ModalSheet>

                    {/* Settings Modal */}
                    <ModalSheet open={showSettingsModal} onClose={() => setShowSettingsModal(false)} title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
                        <div className="space-y-4">
                            <div className="ios-list">
                                <button onClick={() => { handleExport(); setShowSettingsModal(false); }} className="ios-list-item w-full">
                                    <span className="text-xl">üìä</span>
                                    <span className="flex-1 text-left font-medium">–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</span>
                                    <Icons.ChevronRight />
                                </button>
                                <button onClick={() => { handleBackup(); setShowSettingsModal(false); }} className="ios-list-item w-full">
                                    <span className="text-xl">üíæ</span>
                                    <span className="flex-1 text-left font-medium">–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è</span>
                                    <Icons.ChevronRight />
                                </button>
                                <button onClick={() => { handleRestore(); setShowSettingsModal(false); }} className="ios-list-item w-full">
                                    <span className="text-xl">üì•</span>
                                    <span className="flex-1 text-left font-medium">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</span>
                                    <Icons.ChevronRight />
                                </button>
                            </div>

                            <div className="ios-list">
                                <button onClick={() => { handleReset(); setShowSettingsModal(false); }} className="ios-list-item w-full">
                                    <span className="text-xl">üóëÔ∏è</span>
                                    <span className="flex-1 text-left font-medium text-red-600">–°–±—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</span>
                                    <Icons.ChevronRight />
                                </button>
                            </div>

                            <div className="text-center pt-4 text-gray-400 text-sm">
                                <p>–í–µ—Ä—Å–∏—è 5.0</p>
                                <p>–ì–ö–û–£ –°–ö–û–®–ò ‚Ññ102</p>
                            </div>
                        </div>
                    </ModalSheet>

                    <Toast message={toast.message} visible={toast.visible} onClose={() => setToast(t => ({ ...t, visible: false }))} />
                    
                    <input type="file" id="fileInput" accept=".json" style={{ display: 'none' }} onChange={handleFileImport} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
