<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è - –ì–ö–û–£ –°–ö–û–®–ò ‚Ññ102</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script>
tailwind.config = {
theme: {
extend: {
fontFamily: {
sans: ['Nunito', 'system-ui', 'sans-serif'],
},
colors: {
bank: {
primary: '#1a365d',
secondary: '#2c5282',
accent: '#3182ce',
success: '#38a169',
warning: '#d69e2e',
danger: '#e53e3e',
light: '#f7fafc',
dark: '#1a202c',
}
}
}
}
}
</script>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
-webkit-tap-highlight-color: transparent;
}

html { 
font-size: 15px; 
-webkit-font-smoothing: antialiased;
}

body { 
font-family: 'Nunito', system-ui, sans-serif; 
background: #f7fafc; 
color: #1a202c;
line-height: 1.5;
overflow: hidden;
height: 100dvh;
}

.app-container {
padding-top: env(safe-area-inset-top, 0px);
height: 100dvh;
}

.custom-scroll::-webkit-scrollbar { width: 4px; }
.custom-scroll::-webkit-scrollbar-track { background: transparent; }
.custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 2px; }

.content-scroll {
flex: 1;
overflow-y: auto;
overflow-x: hidden;
-webkit-overflow-scrolling: touch;
overscroll-behavior: contain;
}

.touch-btn {
min-height: 44px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: all 0.15s ease;
}
.touch-btn:active { transform: scale(0.98); }

.status-badge {
padding: 6px 12px;
border-radius: 6px;
font-weight: 700;
font-size: 0.75rem;
display: inline-flex;
align-items: center;
gap: 4px;
text-transform: uppercase;
letter-spacing: 0.025em;
}
.status-checked { background: #c6f6d5; color: #276749; }
.status-pending { background: #feebc8; color: #975a16; }
.status-writeoff { background: #fed7d7; color: #c53030; }

.building-nansen { border-left-color: #3182ce !important; }
.building-botanica { border-left-color: #38a169 !important; }
.building-unknown { border-left-color: #a0aec0 !important; }

.building-badge {
padding: 2px 8px;
border-radius: 4px;
font-size: 0.7rem;
font-weight: 700;
text-transform: uppercase;
letter-spacing: 0.03em;
}
.building-badge-nansen { background: #ebf8ff; color: #2b6cb0; }
.building-badge-botanica { background: #f0fff4; color: #276749; }

.cat-audio { border-left-color: #805ad5; }
.cat-interactive { border-left-color: #3182ce; }
.cat-printers { border-left-color: #00b5d8; }
.cat-tv { border-left-color: #38a169; }
.cat-default { border-left-color: #718096; }

.category-divider {
background: #1a365d;
color: white;
padding: 12px 16px;
border-radius: 8px;
margin: 20px 0 12px;
display: flex;
justify-content: space-between;
align-items: center;
font-weight: 700;
font-size: 0.875rem;
}
.category-divider:first-child { margin-top: 0; }

.card-shadow {
box-shadow: 0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.06);
}
.card-shadow:hover {
box-shadow: 0 4px 6px rgba(0,0,0,0.07), 0 2px 4px rgba(0,0,0,0.05);
}

.note-indicator {
position: absolute;
top: 8px;
right: 8px;
width: 8px;
height: 8px;
background: #3182ce;
border-radius: 50%;
}

.equipment-card {
position: relative;
isolation: isolate;
}

.modal-base {
position: fixed;
inset: 0;
display: flex;
align-items: flex-start;
justify-content: center;
padding: 3vh 16px 16px;
background: rgba(0, 0, 0, 0.5);
}
.modal-z-500 { z-index: 500; }
.modal-z-600 { z-index: 600; }
.modal-z-700 { z-index: 700; }
.modal-z-800 { z-index: 800; }

.modal-animate {
animation: modalIn 0.2s ease-out;
}
@keyframes modalIn {
from { opacity: 0; transform: translateY(-10px); }
to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 768px) {
.nav-rail { display: none !important; }
.filter-panel { 
position: fixed;
left: 0;
top: 0;
bottom: 0;
width: 300px;
z-index: 500;
transform: translateX(-100%);
transition: transform 0.3s ease;
box-shadow: 4px 0 20px rgba(0,0,0,0.15);
}
.filter-panel.open { transform: translateX(0); }
.mobile-header { display: flex !important; }
.desktop-header { display: none !important; }
.main-area { margin-left: 0 !important; }
}

@media (min-width: 769px) {
.mobile-header { display: none !important; }
.mobile-overlay { display: none !important; }
.desktop-header { display: flex !important; }
}

@media (min-width: 769px) and (max-width: 1024px) {
.nav-rail { width: 56px; }
.nav-rail button { width: 40px; height: 40px; }
.filter-panel { width: 220px; }
.quick-stat-card { padding: 8px 4px; }
.quick-stat-value { font-size: 1.25rem; }
}

.quick-stat-card {
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
text-align: center;
padding: 12px 8px;
border-radius: 8px;
cursor: pointer;
border: 2px solid transparent;
transition: all 0.15s ease;
}
.quick-stat-card:hover { border-color: #e2e8f0; }
.quick-stat-card.active { border-color: #3182ce; background: #ebf8ff; }
.quick-stat-value {
font-size: 1.5rem;
font-weight: 800;
line-height: 1;
margin-bottom: 4px;
}
.quick-stat-label {
font-size: 0.625rem;
font-weight: 700;
text-transform: uppercase;
letter-spacing: 0.05em;
color: #718096;
}

.filter-panel { will-change: transform; }

.dropdown-btn {
display: flex;
align-items: center;
gap: 8px;
padding: 8px 12px;
background: #f7fafc;
border: 1px solid #e2e8f0;
border-radius: 8px;
font-size: 0.875rem;
font-weight: 600;
color: #2d3748;
cursor: pointer;
transition: all 0.15s ease;
min-width: 140px;
}
.dropdown-btn:hover { background: #edf2f7; border-color: #cbd5e0; }
.dropdown-btn.open { border-color: #3182ce; box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1); }
.dropdown-menu {
position: absolute;
top: 100%;
left: 0;
margin-top: 4px;
background: white;
border: 1px solid #e2e8f0;
border-radius: 8px;
box-shadow: 0 10px 25px rgba(0,0,0,0.15);
z-index: 200;
max-height: 320px;
overflow-y: auto;
animation: dropdownIn 0.15s ease-out;
min-width: 200px;
}
@keyframes dropdownIn {
from { opacity: 0; transform: translateY(-8px); }
to { opacity: 1; transform: translateY(0); }
}
.dropdown-item {
display: flex;
align-items: center;
gap: 10px;
padding: 10px 12px;
font-size: 0.875rem;
color: #4a5568;
cursor: pointer;
border-bottom: 1px solid #f7fafc;
transition: background 0.1s ease;
}
.dropdown-item:last-child { border-bottom: none; }
.dropdown-item:hover { background: #f7fafc; }
.dropdown-item.active { background: #ebf8ff; color: #2b6cb0; font-weight: 700; }
.dropdown-item .item-icon { font-size: 1.125rem; }
.dropdown-item .item-count {
margin-left: auto;
padding: 2px 8px;
background: #e2e8f0;
border-radius: 4px;
font-size: 0.75rem;
font-weight: 600;
}
.dropdown-item.active .item-count { background: #bee3f8; }

.building-selector {
display: flex;
gap: 4px;
padding: 2px;
background: #edf2f7;
border-radius: 8px;
}
.building-selector-btn {
flex: 1;
padding: 8px 4px;
border-radius: 6px;
font-size: 0.75rem;
font-weight: 700;
text-align: center;
cursor: pointer;
transition: all 0.15s ease;
border: none;
background: transparent;
color: #718096;
}
.building-selector-btn:hover { color: #4a5568; }
.building-selector-btn.active { background: white; color: #2d3748; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
.building-selector-btn.nansen.active { background: #3182ce; color: white; }
.building-selector-btn.botanica.active { background: #38a169; color: white; }

@media (max-width: 768px) {
.dropdown-btn { min-width: unset; padding: 8px 10px; }
.dropdown-btn .btn-name { max-width: 80px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.dropdown-menu { min-width: 220px; }
}

.step-indicator {
display: flex;
justify-content: center;
gap: 6px;
margin-bottom: 16px;
}
.step-dot {
width: 8px;
height: 8px;
border-radius: 50%;
background: #e2e8f0;
transition: all 0.2s ease;
}
.step-dot.active { background: #3182ce; transform: scale(1.2); }
.step-dot.completed { background: #38a169; }

.nav-btn {
position: relative;
width: 40px;
height: 40px;
border-radius: 10px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: all 0.15s ease;
border: none;
font-size: 1.1rem;
}
.nav-btn:hover { background: rgba(255,255,255,0.1); }
.nav-btn.active { background: rgba(255,255,255,0.2); }
.nav-btn-badge {
position: absolute;
top: 2px;
right: 2px;
min-width: 16px;
height: 16px;
background: #e53e3e;
color: white;
font-size: 0.65rem;
font-weight: 700;
border-radius: 8px;
display: flex;
align-items: center;
justify-content: center;
padding: 0 4px;
}

.floor-section {
margin-bottom: 8px;
}
.floor-header {
display: flex;
align-items: center;
gap: 8px;
padding: 8px 12px;
background: #f7fafc;
border-radius: 8px;
cursor: pointer;
transition: background 0.15s ease;
}
.floor-header:hover { background: #edf2f7; }
.floor-rooms {
display: flex;
flex-wrap: wrap;
gap: 4px;
padding: 8px 12px;
}
.room-chip {
padding: 4px 10px;
background: #e2e8f0;
border-radius: 6px;
font-size: 0.75rem;
font-weight: 600;
cursor: pointer;
transition: all 0.15s ease;
}
.room-chip:hover { background: #cbd5e0; }
.room-chip.active { background: #3182ce; color: white; }

.recent-item {
display: flex;
align-items: center;
gap: 10px;
padding: 8px 12px;
border-radius: 8px;
cursor: pointer;
transition: background 0.15s ease;
}
.recent-item:hover { background: #f7fafc; }

.problem-item {
display: flex;
align-items: center;
gap: 8px;
padding: 8px 10px;
background: #fef3c7;
border-radius: 8px;
margin-bottom: 6px;
cursor: pointer;
transition: all 0.15s ease;
}
.problem-item:hover { background: #fde68a; }
.problem-item.critical { background: #fee2e2; }
.problem-item.critical:hover { background: #fecaca; }

.sidebar-section {
padding: 12px;
border-bottom: 1px solid #e2e8f0;
}
.sidebar-section-title {
font-size: 0.65rem;
font-weight: 700;
text-transform: uppercase;
letter-spacing: 0.05em;
color: #a0aec0;
margin-bottom: 8px;
}

.stat-card {
background: white;
border-radius: 12px;
padding: 16px;
border: 1px solid #e2e8f0;
}
</style>
</head>
<body>
<div class="app-container" id="appContainer">
<div id="root" style="height: 100%; display: flex; flex-direction: column;"></div>
</div>
<input type="file" id="fileInput" accept=".json" style="display:none">

<script type="text/babel">
const { useState, useEffect, useRef, useCallback, useMemo } = React;

const Icons = {
Home: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>,
Building: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>,
Users: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>,
Plus: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>,
Save: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" /></svg>,
Download: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>,
Upload: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>,
Trash: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>,
X: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>,
Menu: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" /></svg>,
ChevronDown: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /></svg>,
};

const buildingsConfig = {
"–ù–∞–Ω—Å–µ–Ω–∞": { icon: "üè´", color: "#3182ce", colorClass: "nansen", floors: ['1', '2', '3'] },
"–ë–æ—Ç–∞–Ω–∏—á–∫–∞": { icon: "üè¢", color: "#38a169", colorClass: "botanica", floors: ['1', '2'] },
};

const initialEquipment = [
{id:"item_0",name:"–ú–§–£ –≥—Ä—É–ø–ø–æ–≤–æ–µ, —Ü–≤–µ—Ç–Ω–æ–µ OKI MC563dn",invNumber:"1101340057",date:"29.12.2017",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–ü—Ä–∏–Ω—Ç–µ—Ä—ã –∏ –ú–§–£",building:"",floor:"",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
{id:"item_1",name:"–ü—Ä–∏–Ω—Ç–µ—Ä –≥—Ä—É–ø–ø–æ–≤–æ–π Epson WorkForce Pro WF-M5190DW",invNumber:"1101340077",date:"22.03.2018",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–ü—Ä–∏–Ω—Ç–µ—Ä—ã –∏ –ú–§–£",building:"",floor:"",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
{id:"item_2",name:"–ê–∫—É—Å—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞—É–¥–∏—Ç–æ—Ä–∏–∏",invNumber:"1101340084",date:"30.03.2018",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–ê—É–¥–∏–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",building:"",floor:"",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
{id:"item_3",name:"–ê–∫—É—Å—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞—É–¥–∏—Ç–æ—Ä–∏–∏",invNumber:"1101340095",date:"30.03.2018",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–ê—É–¥–∏–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",building:"",floor:"",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
{id:"item_4",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ IRBIS",invNumber:"0101340042",date:"23.12.2020",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã",building:"",floor:"",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
{id:"item_5",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ IRBIS",invNumber:"0101340043",date:"23.12.2020",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã",building:"",floor:"",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
{id:"item_415",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-50",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",building:"",floor:"",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
{id:"item_416",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-51",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",building:"",floor:"",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
{id:"item_417",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-52",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",building:"",floor:"",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
{id:"item_418",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-53",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",building:"",floor:"",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
{id:"item_419",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-54",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",building:"",floor:"",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
{id:"item_420",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-55",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",building:"",floor:"",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
{id:"item_421",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-56",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",building:"",floor:"",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
{id:"item_422",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å ICL InfoRay",invNumber:"–ë–î-57",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",building:"",floor:"",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
];

const categoryConfig = {
"–ê—É–¥–∏–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ": { icon: "üîä", colorClass: "cat-audio", color: "#805ad5" },
"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ": { icon: "üì±", colorClass: "cat-interactive", color: "#3182ce" },
"–ü—Ä–∏–Ω—Ç–µ—Ä—ã –∏ –ú–§–£": { icon: "üñ®Ô∏è", colorClass: "cat-printers", color: "#00b5d8" },
"–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã": { icon: "üì∫", colorClass: "cat-tv", color: "#38a169" },
};
const defaultCatConfig = { icon: "üì¶", colorClass: "cat-default", color: "#718096" };

const ProgressRing = ({ percent, size = 64 }) => {
const strokeWidth = 6;
const radius = (size - strokeWidth) / 2;
const circumference = 2 * Math.PI * radius;
const offset = circumference - (percent / 100) * circumference;

return (
<div className="relative" style={{ width: size, height: size }}>
<svg className="transform -rotate-90" width={size} height={size}>
<circle stroke="#e2e8f0" strokeWidth={strokeWidth} fill="transparent" r={radius} cx={size/2} cy={size/2} />
<circle stroke="#3182ce" strokeWidth={strokeWidth} fill="transparent" r={radius} cx={size/2} cy={size/2}
strokeDasharray={circumference} strokeDashoffset={offset} strokeLinecap="round" style={{ transition: 'stroke-dashoffset 0.5s ease' }} />
</svg>
<div className="absolute inset-0 flex items-center justify-center">
<span className="text-lg font-bold text-gray-800">{percent}%</span>
</div>
</div>
);
};

const NavRail = ({ onOpenRooms, onOpenPeople, onAddEquipment, onShowInfo, onGoHome, onOpenStats, onOpenExport, onOpenSettings, onOpenHistory, problemCount }) => (
<div className="nav-rail w-16 bg-gray-900 flex flex-col items-center py-4 flex-shrink-0">
<button onClick={onShowInfo} className="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center mb-6" title="–û –ø—Ä–æ–≥—Ä–∞–º–º–µ">
<span className="text-white font-bold text-sm">102</span>
</button>
<div className="flex-1 flex flex-col items-center gap-2">
<button onClick={onGoHome} className="nav-btn bg-gray-800 text-white" title="–ì–ª–∞–≤–Ω–∞—è">
üè†
</button>
<button onClick={onOpenStats} className="nav-btn text-gray-400 hover:text-white" title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞">
üìä
</button>
<button onClick={onOpenHistory} className="nav-btn text-gray-400 hover:text-white" title="–ò—Å—Ç–æ—Ä–∏—è">
üìú
</button>

<div className="w-8 h-px bg-gray-700 my-2"></div>

<button onClick={onOpenRooms} className="nav-btn text-gray-400 hover:text-white" title="–ö–∞–±–∏–Ω–µ—Ç—ã">
üö™
</button>
<button onClick={onOpenPeople} className="nav-btn text-gray-400 hover:text-white" title="–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏">
üë•
</button>

<div className="w-8 h-px bg-gray-700 my-2"></div>

<button onClick={onOpenExport} className="nav-btn text-gray-400 hover:text-white" title="–≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç">
üì§
</button>
<button onClick={onOpenSettings} className="nav-btn text-gray-400 hover:text-white relative" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
‚öôÔ∏è
{problemCount > 0 && <span className="nav-btn-badge">{problemCount}</span>}
</button>
</div>
<button onClick={onAddEquipment} className="nav-btn bg-green-600 text-white" title="–î–æ–±–∞–≤–∏—Ç—å">
‚ûï
</button>
</div>
);

const FilterPanel = ({ isOpen, onClose, stats, activeFilter, setActiveFilter, activeBuilding, setActiveBuilding, equipment, onViewItem, recentItems, problemItems, onRoomClick }) => {
const percent = stats.total > 0 ? Math.round((stats.checked / stats.total) * 100) : 0;
const [expandedFloors, setExpandedFloors] = useState({});

const locationsByFloor = useMemo(() => {
const result = { '–ù–∞–Ω—Å–µ–Ω–∞': {}, '–ë–æ—Ç–∞–Ω–∏—á–∫–∞': {} };
equipment.forEach(item => {
if (item.building && item.floor && item.location) {
if (!result[item.building][item.floor]) {
result[item.building][item.floor] = new Set();
}
result[item.building][item.floor].add(item.location);
}
});
return result;
}, [equipment]);

const toggleFloor = (building, floor) => {
setExpandedFloors(prev => ({
...prev,
[`${building}-${floor}`]: !prev[`${building}-${floor}`]
}));
};

return (
<>
<div className={`mobile-overlay fixed inset-0 bg-black/40 z-400 ${isOpen ? 'block' : 'hidden'}`} onClick={onClose} />
<div className={`filter-panel w-72 bg-white border-r border-gray-200 flex flex-col flex-shrink-0 ${isOpen ? 'open' : ''}`}>
<button onClick={onClose} className="absolute top-3 right-3 w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center lg:hidden">
<Icons.X />
</button>

<div className="p-4 border-b border-gray-100">
<h1 className="text-base font-bold text-gray-900">–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è</h1>
<p className="text-xs text-gray-500">–ì–ö–û–£ –°–ö–û–®–ò ‚Ññ102</p>
</div>

<div className="sidebar-section">
<div className="sidebar-section-title">–ó–¥–∞–Ω–∏–µ</div>
<div className="building-selector">
<button onClick={() => { setActiveBuilding('–í—Å–µ –∑–¥–∞–Ω–∏—è'); onClose(); }}
className={`building-selector-btn ${activeBuilding === '–í—Å–µ –∑–¥–∞–Ω–∏—è' ? 'active' : ''}`}>
–í—Å–µ
</button>
<button onClick={() => { setActiveBuilding('–ù–∞–Ω—Å–µ–Ω–∞'); onClose(); }}
className={`building-selector-btn nansen ${activeBuilding === '–ù–∞–Ω—Å–µ–Ω–∞' ? 'active' : ''}`}>
üè´ –ù–∞–Ω—Å–µ–Ω–∞
</button>
<button onClick={() => { setActiveBuilding('–ë–æ—Ç–∞–Ω–∏—á–∫–∞'); onClose(); }}
className={`building-selector-btn botanica ${activeBuilding === '–ë–æ—Ç–∞–Ω–∏—á–∫–∞' ? 'active' : ''}`}>
üè¢ –ë–æ—Ç–∞–Ω–∏—á–∫–∞
</button>
</div>
<button onClick={() => { setActiveBuilding('–ù–µ —É–∫–∞–∑–∞–Ω–æ'); onClose(); }}
className={`w-full mt-2 py-2 text-xs rounded-lg transition-all ${activeBuilding === '–ù–µ —É–∫–∞–∑–∞–Ω–æ' ? 'bg-gray-200 text-gray-700 font-bold' : 'bg-gray-50 text-gray-500 hover:bg-gray-100'}`}>
‚ùì –ù–µ —É–∫–∞–∑–∞–Ω–æ ({stats.noBuilding})
</button>
</div>

<div className="sidebar-section">
<div className="flex items-center gap-4">
<ProgressRing percent={percent} size={56} />
<div className="flex-1">
<div className="text-xs text-gray-500 uppercase font-semibold mb-1">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
<div className="flex justify-between text-sm">
<span className="text-gray-600">–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</span>
<span className="font-semibold text-green-600">{stats.checked}</span>
</div>
<div className="flex justify-between text-sm">
<span className="text-gray-600">–û—Å—Ç–∞–ª–æ—Å—å</span>
<span className="font-semibold text-amber-600">{stats.pending}</span>
</div>
</div>
</div>
</div>

<div className="grid grid-cols-2 gap-2 p-3 border-b border-gray-100">
<div onClick={() => setActiveFilter(activeFilter === 'writeoff' ? 'all' : 'writeoff')}
className={`quick-stat-card bg-red-50 ${activeFilter === 'writeoff' ? 'active' : ''}`}>
<div className="quick-stat-value text-red-600">{stats.writeOff}</div>
<div className="quick-stat-label">–°–ø–∏—Å–∞–Ω–∏–µ</div>
</div>
<div onClick={() => setActiveFilter(activeFilter === 'nolabel' ? 'all' : 'nolabel')}
className={`quick-stat-card bg-amber-50 ${activeFilter === 'nolabel' ? 'active' : ''}`}>
<div className="quick-stat-value text-amber-600">{stats.noLabel}</div>
<div className="quick-stat-label">–ë–µ–∑ –±–∏—Ä–∫–∏</div>
</div>
</div>

<div className="flex-1 overflow-y-auto custom-scroll">
{/* –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ */}
{problemItems.length > 0 && (
<div className="sidebar-section">
<div className="sidebar-section-title">‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è</div>
<div className="space-y-1">
{problemItems.slice(0, 5).map(item => (
<div key={item.id} onClick={() => { onViewItem(item); onClose(); }}
className={`problem-item ${item.hasLabel === false ? 'critical' : ''}`}>
<span className="text-sm">{item.hasLabel === false ? 'üè∑Ô∏è' : 'üì¶'}</span>
<div className="flex-1 min-w-0">
<div className="font-mono text-xs font-bold text-gray-700">{item.invNumber}</div>
<div className="text-xs text-gray-500 truncate">{item.name}</div>
</div>
</div>
))}
{problemItems.length > 5 && (
<div className="text-xs text-center text-gray-400 py-1">
–∏ –µ—â—ë {problemItems.length - 5}...
</div>
)}
</div>
</div>
)}

{/* –õ–æ–∫–∞—Ü–∏–∏ –ø–æ —ç—Ç–∞–∂–∞–º */}
<div className="sidebar-section">
<div className="sidebar-section-title">üìç –õ–æ–∫–∞—Ü–∏–∏ –ø–æ —ç—Ç–∞–∂–∞–º</div>
{['–ù–∞–Ω—Å–µ–Ω–∞', '–ë–æ—Ç–∞–Ω–∏—á–∫–∞'].map(building => {
const floors = buildingsConfig[building]?.floors || [];
const hasLocations = floors.some(f => locationsByFloor[building][f]?.size > 0);
if (!hasLocations) return null;

return (
<div key={building} className="mb-3">
<div className={`text-xs font-bold mb-1 ${building === '–ù–∞–Ω—Å–µ–Ω–∞' ? 'text-blue-600' : 'text-green-600'}`}>
{building === '–ù–∞–Ω—Å–µ–Ω–∞' ? 'üè´' : 'üè¢'} {building}
</div>
{floors.map(floor => {
const rooms = locationsByFloor[building][floor];
if (!rooms || rooms.size === 0) return null;
const isExpanded = expandedFloors[`${building}-${floor}`];

return (
<div key={floor} className="floor-section">
<div className="floor-header" onClick={() => toggleFloor(building, floor)}>
<span className="text-sm">üî¢</span>
<span className="text-sm font-semibold">{floor} —ç—Ç–∞–∂</span>
<span className="text-xs text-gray-400 ml-auto">{rooms.size} –∫–∞–±.</span>
<span className={`text-xs transition-transform ${isExpanded ? 'rotate-180' : ''}`}>‚ñº</span>
</div>
{isExpanded && (
<div className="floor-rooms">
{[...rooms].sort().map(room => (
<span key={room} className="room-chip" onClick={() => onRoomClick && onRoomClick(building, floor, room)}>{room}</span>
))}
</div>
)}
</div>
);
})}
</div>
);
})}
{!['–ù–∞–Ω—Å–µ–Ω–∞', '–ë–æ—Ç–∞–Ω–∏—á–∫–∞'].some(b => 
(buildingsConfig[b]?.floors || []).some(f => locationsByFloor[b][f]?.size > 0)
) && (
<div className="text-xs text-gray-400 text-center py-4">
–õ–æ–∫–∞—Ü–∏–∏ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
</div>
)}
</div>

{/* –ù–µ–¥–∞–≤–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ */}
<div className="sidebar-section">
<div className="sidebar-section-title">üïê –ù–µ–¥–∞–≤–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏</div>
{recentItems.length === 0 ? (
<div className="text-xs text-gray-400 text-center py-4">
–ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
</div>
) : (
<div className="space-y-1">
{recentItems.map(item => (
<div key={item.id} onClick={() => { onViewItem(item); onClose(); }} className="recent-item">
<div className={`w-6 h-6 rounded flex items-center justify-center text-xs ${item.writeOff ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600'}`}>
{item.writeOff ? 'üìù' : '‚úì'}
</div>
<div className="flex-1 min-w-0">
<div className="font-mono text-xs font-bold text-gray-700">{item.invNumber}</div>
<div className="text-xs text-gray-400 truncate">{item.location || '–ë–µ–∑ –ª–æ–∫–∞—Ü–∏–∏'}</div>
</div>
{item.building && (
<span className={`text-xs ${item.building === '–ù–∞–Ω—Å–µ–Ω–∞' ? 'text-blue-500' : 'text-green-500'}`}>
{item.building === '–ù–∞–Ω—Å–µ–Ω–∞' ? 'üè´' : 'üè¢'}
</span>
)}
</div>
))}
</div>
)}
</div>
</div>
</div>
</>
);
};

const EquipmentCard = React.memo(({ item, onView, onCheck }) => {
const isProcessed = item.checked || item.writeOff;
const hasNote = !!item.inventoryNote?.trim();
const config = categoryConfig[item.category] || defaultCatConfig;

const getBuildingBorderClass = () => {
if (item.writeOff) return 'border-l-red-500';
if (item.checked) return 'border-l-green-500';
if (item.building === '–ù–∞–Ω—Å–µ–Ω–∞') return 'building-nansen';
if (item.building === '–ë–æ—Ç–∞–Ω–∏—á–∫–∞') return 'building-botanica';
return 'building-unknown';
};

return (
<div className={`equipment-card bg-white rounded-xl p-4 card-shadow border-l-4 transition-all ${getBuildingBorderClass()}`}>
{hasNote && <div className="note-indicator" title="–ï—Å—Ç—å –∑–∞–º–µ—Ç–∫–∞" />}

<div className="flex items-start gap-3 mb-3">
<div className={`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 text-lg
                           ${item.writeOff ? 'bg-red-100' : item.checked ? 'bg-green-100' : 'bg-gray-100'}`}>
{item.writeOff ? 'üìù' : item.checked ? '‚úì' : config.icon}
</div>
<div className="flex-1 min-w-0">
<div className="flex items-center gap-2 flex-wrap mb-1">
<span className="px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs font-mono font-bold">{item.invNumber}</span>
{item.building && (
<span className={`building-badge ${item.building === '–ù–∞–Ω—Å–µ–Ω–∞' ? 'building-badge-nansen' : 'building-badge-botanica'}`}>
{item.building === '–ù–∞–Ω—Å–µ–Ω–∞' ? 'üè´' : 'üè¢'} {item.building}
</span>
)}
{item.isUserAdded && <span title="–ù–æ–≤–æ–µ" className="w-2 h-2 bg-blue-500 rounded-full" />}
{item.hasLabel === false && <span title="–ë–µ–∑ –±–∏—Ä–∫–∏" className="w-2 h-2 bg-amber-500 rounded-full" />}
</div>
<h3 className="font-semibold text-gray-800 text-sm leading-snug line-clamp-2">{item.name}</h3>
</div>
</div>

<div className="flex items-center gap-2 text-xs text-gray-500 mb-3 flex-wrap">
<span className={`status-badge ${item.writeOff ? 'status-writeoff' : item.checked ? 'status-checked' : 'status-pending'}`}>
{item.writeOff ? '–°–ø–∏—Å–∞–Ω–∏–µ' : item.checked ? '–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ' : '–û–∂–∏–¥–∞–µ—Ç'}
</span>
{(item.floor || item.location) && (
<>
<span className="text-gray-400">‚Ä¢</span>
{item.floor && <span>üî¢ {item.floor} —ç—Ç.</span>}
{item.location && <span>üìç {item.location}</span>}
</>
)}
</div>

<div className="flex gap-2 pt-3 border-t border-gray-100">
<button onClick={() => onView(item)} className="touch-btn flex-1 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-xs font-semibold">
–ü—Ä–æ—Å–º–æ—Ç—Ä
</button>
{!isProcessed ? (
<button onClick={() => onCheck(item)} className="touch-btn flex-1 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-xs font-semibold">
‚úì –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
</button>
) : (
<button onClick={() => onCheck(item, true)} className="touch-btn flex-1 py-2 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg text-xs font-semibold">
‚Ü© –û—Ç–º–µ–Ω–∏—Ç—å
</button>
)}
</div>
</div>
);
});

const Dropdown = ({ value, options, onChange }) => {
const [isOpen, setIsOpen] = useState(false);
const dropdownRef = useRef(null);

useEffect(() => {
const handleClickOutside = (e) => {
if (dropdownRef.current && !dropdownRef.current.contains(e.target)) {
setIsOpen(false);
}
};
if (isOpen) {
document.addEventListener('mousedown', handleClickOutside);
document.addEventListener('touchstart', handleClickOutside);
}
return () => {
document.removeEventListener('mousedown', handleClickOutside);
document.removeEventListener('touchstart', handleClickOutside);
};
}, [isOpen]);

const currentOption = options.find(o => o.value === value) || options[0];
const isAllOption = value === '–í—Å–µ –∑–¥–∞–Ω–∏—è' || value === '–í—Å–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ';

return (
<div className="relative" ref={dropdownRef}>
<button className={`dropdown-btn ${isOpen ? 'open' : ''}`} onClick={() => setIsOpen(!isOpen)}>
{currentOption?.icon && <span className="item-icon">{currentOption.icon}</span>}
<span className="btn-name flex-1 text-left truncate">{currentOption?.label || ''}</span>
{!isAllOption && currentOption?.count !== undefined && <span className="item-count">{currentOption.count}</span>}
<Icons.ChevronDown />
</button>

{isOpen && (
<div className="dropdown-menu custom-scroll">
{options.map(opt => (
<div key={opt.value} className={`dropdown-item ${value === opt.value ? 'active' : ''}`}
onClick={() => { onChange(opt.value); setIsOpen(false); }}>
{opt.icon && <span className="item-icon">{opt.icon}</span>}
<span className="flex-1 truncate">{opt.label}</span>
{opt.count !== undefined && <span className="item-count">{opt.count}</span>}
</div>
))}
</div>
)}
</div>
);
};

const Modal = ({ isOpen, onClose, title, children, size = 'md' }) => {
if (!isOpen) return null;
const sizeClass = { sm: 'max-w-sm', md: 'max-w-md', lg: 'max-w-lg', xl: 'max-w-xl' }[size];

return (
<div className="modal-base modal-z-600" onClick={onClose}>
<div className={`modal-animate bg-white rounded-xl shadow-xl w-full ${sizeClass}`} onClick={e => e.stopPropagation()}>
<div className="flex items-center justify-between px-4 py-3 border-b border-gray-100">
<h2 className="text-base font-bold text-gray-800">{title}</h2>
<button onClick={onClose} className="touch-btn w-8 h-8 rounded-lg hover:bg-gray-100 text-gray-400">
<Icons.X />
</button>
</div>
<div className="p-4 max-h-[70vh] overflow-y-auto custom-scroll">{children}</div>
</div>
</div>
);
};

const ConfirmModal = ({ isOpen, onClose, onConfirm, title, message }) => {
if (!isOpen) return null;
return (
<div className="modal-base modal-z-700" onClick={onClose}>
<div className="modal-animate bg-white rounded-xl shadow-xl w-full max-w-xs p-5 text-center" onClick={e => e.stopPropagation()}>
<h3 className="text-lg font-bold text-gray-800 mb-2">{title}</h3>
<p className="text-sm text-gray-500 mb-5">{message}</p>
<div className="flex gap-3">
<button onClick={onClose} className="touch-btn flex-1 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-semibold text-sm">–û—Ç–º–µ–Ω–∞</button>
<button onClick={onConfirm} className="touch-btn flex-1 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold text-sm">–î–∞</button>
</div>
</div>
</div>
);
};

const Toast = ({ message, isVisible, onClose }) => {
useEffect(() => { if (isVisible) { const t = setTimeout(onClose, 2500); return () => clearTimeout(t); } }, [isVisible, onClose]);
if (!isVisible) return null;
return (
<div className="fixed bottom-6 left-1/2 -translate-x-1/2 px-4 py-3 bg-gray-800 text-white rounded-lg shadow-lg z-800 text-sm font-semibold">
{message}
</div>
);
};

const AutocompleteInput = ({ value, onChange, suggestions, placeholder, label, autoFocus }) => {
const [showDropdown, setShowDropdown] = useState(false);
const safeSuggestions = suggestions || [];
const filtered = useMemo(() => {
if (!value) return safeSuggestions.slice(0, 5);
return safeSuggestions.filter(s => s.toLowerCase().includes(value.toLowerCase())).slice(0, 5);
}, [value, safeSuggestions]);

return (
<div className="relative">
{label && <label className="block text-xs font-semibold text-gray-500 mb-1">{label}</label>}
<input type="text" value={value} onChange={e => onChange(e.target.value)}
onFocus={() => setShowDropdown(true)} onBlur={() => setTimeout(() => setShowDropdown(false), 150)}
placeholder={placeholder} autoFocus={autoFocus}
className="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none" />
{showDropdown && filtered.length > 0 && (
<div className="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-40 overflow-y-auto">
{filtered.map((item, idx) => (
<button key={idx} type="button" onMouseDown={() => { onChange(item); setShowDropdown(false); }}
className="w-full text-left px-3 py-2 hover:bg-gray-50 text-sm border-b border-gray-50 last:border-0">
{item}
</button>
))}
</div>
)}
</div>
);
};

const CheckWizardModal = ({ isOpen, onClose, item, onComplete, directories }) => {
const [step, setStep] = useState(1);
const [formData, setFormData] = useState({
building: '', floor: '', location: '', responsible: '', hasLabel: null, serialNumber: '', inventoryNote: ''
});

const totalSteps = 7;
const safeDirectories = directories || { rooms: [], people: [], roomsWithBuilding: [] };
const safeItem = item || {};

const filteredRooms = useMemo(() => {
const rooms = safeDirectories.rooms || [];
const roomsWithBuilding = safeDirectories.roomsWithBuilding || [];
if (!formData.building) return rooms;
const roomsForBuilding = roomsWithBuilding.filter(r => r && r.building === formData.building).map(r => r.name);
return roomsForBuilding.length > 0 ? roomsForBuilding : rooms;
}, [safeDirectories.rooms, safeDirectories.roomsWithBuilding, formData.building]);

const safePeople = useMemo(() => safeDirectories.people || [], [safeDirectories.people]);

useEffect(() => {
if (isOpen && item) {
setStep(1);
setFormData({
building: item.building || '', floor: item.floor || '', location: item.location || '',
responsible: item.responsible || '', hasLabel: item.hasLabel, serialNumber: item.serialNumber || '', inventoryNote: item.inventoryNote || ''
});
}
}, [isOpen, item]);

if (!isOpen || !item) return null;

const floors = formData.building ? (buildingsConfig[formData.building]?.floors || []) : [];

const canProceed = () => {
switch (step) {
case 1: return !!formData.building;
case 2: return !!formData.floor;
case 5: return formData.hasLabel !== null;
default: return true;
}
};

const nextStep = () => { if (step < totalSteps) setStep(step + 1); else onComplete(formData); };
const prevStep = () => { if (step > 1) setStep(step - 1); };

const renderStepContent = () => {
switch (step) {
case 1:
return (
<div className="space-y-3">
<p className="text-center text-gray-600 text-sm mb-4">–í –∫–∞–∫–æ–º –∑–¥–∞–Ω–∏–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ?</p>
<button type="button" onClick={() => setFormData(prev => ({ ...prev, building: '–ù–∞–Ω—Å–µ–Ω–∞', floor: '' }))}
className={`touch-btn w-full py-4 rounded-xl font-bold text-base ${formData.building === '–ù–∞–Ω—Å–µ–Ω–∞' ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}>
üè´ –ù–∞–Ω—Å–µ–Ω–∞ (3 —ç—Ç–∞–∂–∞)
</button>
<button type="button" onClick={() => setFormData(prev => ({ ...prev, building: '–ë–æ—Ç–∞–Ω–∏—á–∫–∞', floor: '' }))}
className={`touch-btn w-full py-4 rounded-xl font-bold text-base ${formData.building === '–ë–æ—Ç–∞–Ω–∏—á–∫–∞' ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}>
üè¢ –ë–æ—Ç–∞–Ω–∏—á–∫–∞ (2 —ç—Ç–∞–∂–∞)
</button>
</div>
);
case 2:
return (
<div className="space-y-3">
<p className="text-center text-gray-600 text-sm mb-4">–ù–∞ –∫–∞–∫–æ–º —ç—Ç–∞–∂–µ?</p>
<div className="grid grid-cols-3 gap-3">
{floors.map(f => (
<button key={f} type="button" onClick={() => setFormData(prev => ({ ...prev, floor: f }))}
className={`touch-btn py-4 rounded-xl font-bold text-xl ${formData.floor === f ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}>
{f}
</button>
))}
</div>
</div>
);
case 3:
return (
<div className="space-y-3">
<p className="text-center text-gray-600 text-sm mb-4">–ù–æ–º–µ—Ä –∫–∞–±–∏–Ω–µ—Ç–∞</p>
<AutocompleteInput value={formData.location} onChange={v => setFormData(prev => ({ ...prev, location: v }))} 
suggestions={filteredRooms} placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞–±–∏–Ω–µ—Ç–∞..." autoFocus />
</div>
);
case 4:
return (
<div className="space-y-3">
<p className="text-center text-gray-600 text-sm mb-4">–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</p>
<AutocompleteInput value={formData.responsible} onChange={v => setFormData(prev => ({ ...prev, responsible: v }))} 
suggestions={safePeople} placeholder="–§–ò–û –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ..." autoFocus />
</div>
);
case 5:
return (
<div className="space-y-3">
<p className="text-center text-gray-600 text-sm mb-4">–ë–∏—Ä–∫–∞ –µ—Å—Ç—å –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏?</p>
<button type="button" onClick={() => setFormData(prev => ({ ...prev, hasLabel: true }))}
className={`touch-btn w-full py-4 rounded-xl font-bold text-base ${formData.hasLabel === true ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}>
‚úì –î–∞, –µ—Å—Ç—å –±–∏—Ä–∫–∞
</button>
<button type="button" onClick={() => setFormData(prev => ({ ...prev, hasLabel: false }))}
className={`touch-btn w-full py-4 rounded-xl font-bold text-base ${formData.hasLabel === false ? 'bg-red-500 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}>
‚úó –ù–µ—Ç –±–∏—Ä–∫–∏
</button>
</div>
);
case 6:
return (
<div className="space-y-3">
<p className="text-center text-gray-600 text-sm mb-4">–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä (–µ—Å–ª–∏ –µ—Å—Ç—å)</p>
<input type="text" value={formData.serialNumber} onChange={e => setFormData(prev => ({ ...prev, serialNumber: e.target.value }))}
placeholder="S/N" className="w-full px-4 py-3 border border-gray-200 rounded-xl text-center font-mono text-lg" autoFocus />
</div>
);
case 7:
return (
<div className="space-y-3">
<p className="text-center text-gray-600 text-sm mb-4">–ó–∞–º–µ—Ç–∫–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</p>
<textarea value={formData.inventoryNote} onChange={e => setFormData(prev => ({ ...prev, inventoryNote: e.target.value }))}
placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏—è, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏..." rows={3}
className="w-full px-4 py-3 border border-gray-200 rounded-xl text-sm resize-none" autoFocus />
</div>
);
default: return null;
}
};

const stepTitles = ['–ó–¥–∞–Ω–∏–µ', '–≠—Ç–∞–∂', '–ö–∞–±–∏–Ω–µ—Ç', '–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π', '–ë–∏—Ä–∫–∞', '–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä', '–ó–∞–º–µ—Ç–∫–∞'];

return (
<div className="modal-base modal-z-600" onClick={onClose}>
<div className="modal-animate bg-white rounded-xl shadow-xl w-full max-w-sm" onClick={e => e.stopPropagation()}>
<div className="px-4 py-3 border-b border-gray-100">
<div className="flex items-center justify-between mb-2">
<h2 className="text-base font-bold text-gray-800">–ü—Ä–æ–≤–µ—Ä–∫–∞: {stepTitles[step-1]}</h2>
<button onClick={onClose} className="touch-btn w-8 h-8 rounded-lg hover:bg-gray-100 text-gray-400"><Icons.X /></button>
</div>
<div className="step-indicator">
{Array.from({ length: totalSteps }, (_, i) => (
<div key={i} className={`step-dot ${i + 1 === step ? 'active' : i + 1 < step ? 'completed' : ''}`} />
))}
</div>
<div className="p-2 bg-blue-50 rounded-lg text-center">
<span className="font-mono font-bold text-blue-700 text-sm">{item.invNumber}</span>
<p className="text-xs text-gray-600 truncate">{item.name}</p>
</div>
</div>
<div className="p-4">{renderStepContent()}</div>
<div className="px-4 pb-4 flex gap-2">
{step > 1 && <button onClick={prevStep} className="touch-btn flex-1 py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold">‚Üê –ù–∞–∑–∞–¥</button>}
<button onClick={nextStep} disabled={!canProceed()}
className={`touch-btn flex-1 py-3 rounded-xl font-semibold ${canProceed() ? 'bg-blue-600 text-white hover:bg-blue-700' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`}>
{step === totalSteps ? '‚úì –ó–∞–≤–µ—Ä—à–∏—Ç—å' : '–î–∞–ª–µ–µ ‚Üí'}
</button>
</div>
</div>
</div>
);
};

const StatsModal = ({ isOpen, onClose, stats, equipment }) => {
const byCategory = useMemo(() => {
const result = {};
equipment.forEach(item => {
if (!result[item.category]) result[item.category] = { total: 0, checked: 0 };
result[item.category].total++;
if (item.checked || item.writeOff) result[item.category].checked++;
});
return Object.entries(result).sort((a, b) => b[1].total - a[1].total);
}, [equipment]);

const byBuilding = useMemo(() => {
const result = { '–ù–∞–Ω—Å–µ–Ω–∞': { total: 0, checked: 0 }, '–ë–æ—Ç–∞–Ω–∏—á–∫–∞': { total: 0, checked: 0 }, '–ù–µ —É–∫–∞–∑–∞–Ω–æ': { total: 0, checked: 0 } };
equipment.forEach(item => {
const b = item.building || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
if (!result[b]) result[b] = { total: 0, checked: 0 };
result[b].total++;
if (item.checked || item.writeOff) result[b].checked++;
});
return result;
}, [equipment]);

if (!isOpen) return null;

return (
<Modal isOpen={isOpen} onClose={onClose} title="üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" size="lg">
<div className="space-y-6">
<div className="grid grid-cols-2 gap-3">
<div className="stat-card text-center">
<div className="text-3xl font-bold text-blue-600">{stats.total}</div>
<div className="text-xs text-gray-500 font-semibold">–í—Å–µ–≥–æ</div>
</div>
<div className="stat-card text-center">
<div className="text-3xl font-bold text-green-600">{stats.checked}</div>
<div className="text-xs text-gray-500 font-semibold">–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</div>
</div>
<div className="stat-card text-center">
<div className="text-3xl font-bold text-amber-600">{stats.pending}</div>
<div className="text-xs text-gray-500 font-semibold">–û–∂–∏–¥–∞–µ—Ç</div>
</div>
<div className="stat-card text-center">
<div className="text-3xl font-bold text-red-600">{stats.writeOff}</div>
<div className="text-xs text-gray-500 font-semibold">–°–ø–∏—Å–∞–Ω–∏–µ</div>
</div>
</div>

<div>
<h3 className="font-bold text-gray-700 mb-3">–ü–æ –∑–¥–∞–Ω–∏—è–º</h3>
{Object.entries(byBuilding).map(([building, data]) => (
<div key={building} className="flex items-center gap-3 mb-2">
<span className="text-lg">{building === '–ù–∞–Ω—Å–µ–Ω–∞' ? 'üè´' : building === '–ë–æ—Ç–∞–Ω–∏—á–∫–∞' ? 'üè¢' : '‚ùì'}</span>
<span className="flex-1 text-sm font-medium">{building}</span>
<div className="w-24 h-2 bg-gray-200 rounded-full overflow-hidden">
<div className="h-full bg-green-500 rounded-full" style={{ width: `${data.total > 0 ? (data.checked / data.total) * 100 : 0}%` }} />
</div>
<span className="text-xs text-gray-500 w-16 text-right">{data.checked}/{data.total}</span>
</div>
))}
</div>

<div>
<h3 className="font-bold text-gray-700 mb-3">–ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h3>
{byCategory.map(([category, data]) => {
const config = categoryConfig[category] || defaultCatConfig;
return (
<div key={category} className="flex items-center gap-3 mb-2">
<span className="text-lg">{config.icon}</span>
<span className="flex-1 text-sm font-medium truncate">{category}</span>
<div className="w-24 h-2 bg-gray-200 rounded-full overflow-hidden">
<div className="h-full rounded-full" style={{ width: `${data.total > 0 ? (data.checked / data.total) * 100 : 0}%`, background: config.color }} />
</div>
<span className="text-xs text-gray-500 w-16 text-right">{data.checked}/{data.total}</span>
</div>
);
})}
</div>
</div>
</Modal>
);
};

const HistoryModal = ({ isOpen, onClose, history, onViewItem }) => {
if (!isOpen) return null;
return (
<Modal isOpen={isOpen} onClose={onClose} title="üìú –ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π" size="md">
{history.length === 0 ? (
<div className="text-center py-8 text-gray-400">
<div className="text-4xl mb-2">üìú</div>
<p className="text-sm">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</p>
</div>
) : (
<div className="space-y-2 max-h-96 overflow-y-auto">
{history.map((entry, idx) => (
<div key={idx} onClick={() => entry.item && onViewItem(entry.item)} 
className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer">
<div className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm ${
                                       entry.action === 'check' ? 'bg-green-100 text-green-600' :
                                       entry.action === 'writeoff' ? 'bg-red-100 text-red-600' :
                                       entry.action === 'undo' ? 'bg-gray-200 text-gray-600' : 'bg-blue-100 text-blue-600'
                                   }`}>
{entry.action === 'check' ? '‚úì' : entry.action === 'writeoff' ? 'üìù' : entry.action === 'undo' ? '‚Ü©' : '‚ûï'}
</div>
<div className="flex-1 min-w-0">
<div className="font-mono text-xs font-bold text-gray-700">{entry.invNumber}</div>
<div className="text-xs text-gray-400">{entry.time}</div>
</div>
<span className="text-xs text-gray-500">{entry.actionText}</span>
</div>
))}
</div>
)}
</Modal>
);
};

const ExportModal = ({ isOpen, onClose, onExportExcel, onExportJSON, onImport, onClearAll }) => {
if (!isOpen) return null;
return (
<Modal isOpen={isOpen} onClose={onClose} title="üì§ –≠–∫—Å–ø–æ—Ä—Ç –∏ –∏–º–ø–æ—Ä—Ç" size="sm">
<div className="space-y-3">
<button onClick={onExportExcel} className="touch-btn w-full py-4 bg-green-100 hover:bg-green-200 text-green-700 rounded-xl font-semibold flex items-center justify-center gap-3">
<span className="text-2xl">üìä</span>
<div className="text-left">
<div>–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</div>
<div className="text-xs opacity-75">CSV —Ñ–∞–π–ª –¥–ª—è —Ç–∞–±–ª–∏—Ü</div>
</div>
</button>
<button onClick={onExportJSON} className="touch-btn w-full py-4 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-xl font-semibold flex items-center justify-center gap-3">
<span className="text-2xl">üíæ</span>
<div className="text-left">
<div>–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è</div>
<div className="text-xs opacity-75">JSON —Å–æ –≤—Å–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏</div>
</div>
</button>
<button onClick={onImport} className="touch-btn w-full py-4 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-xl font-semibold flex items-center justify-center gap-3">
<span className="text-2xl">üì•</span>
<div className="text-left">
<div>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</div>
<div className="text-xs opacity-75">–ó–∞–≥—Ä—É–∑–∏—Ç—å JSON —Ñ–∞–π–ª</div>
</div>
</button>
<hr className="my-4" />
<button onClick={onClearAll} className="touch-btn w-full py-3 bg-red-50 hover:bg-red-100 text-red-600 rounded-xl font-semibold text-sm">
üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
</button>
</div>
</Modal>
);
};

const SettingsModal = ({ isOpen, onClose, stats }) => {
if (!isOpen) return null;
return (
<Modal isOpen={isOpen} onClose={onClose} title="‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏" size="sm">
<div className="space-y-4">
<div className="p-4 bg-amber-50 rounded-xl">
<h3 className="font-bold text-amber-800 mb-2">‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è</h3>
<div className="space-y-2 text-sm">
<div className="flex justify-between">
<span>–ë–µ–∑ –∑–¥–∞–Ω–∏—è:</span>
<span className="font-bold text-amber-600">{stats.noBuilding}</span>
</div>
<div className="flex justify-between">
<span>–ë–µ–∑ –±–∏—Ä–∫–∏:</span>
<span className="font-bold text-red-600">{stats.noLabel}</span>
</div>
<div className="flex justify-between">
<span>–û–∂–∏–¥–∞—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:</span>
<span className="font-bold text-amber-600">{stats.pending}</span>
</div>
</div>
</div>

<div className="p-4 bg-gray-50 rounded-xl">
<h3 className="font-bold text-gray-700 mb-2">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
<div className="space-y-1 text-sm text-gray-600">
<div className="flex justify-between">
<span>–í–µ—Ä—Å–∏—è:</span>
<span>7.0</span>
</div>
<div className="flex justify-between">
<span>–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π:</span>
<span>{stats.total}</span>
</div>
<div className="flex justify-between">
<span>–° —Å–µ—Ä–∏–π–Ω—ã–º–∏ ‚Ññ:</span>
<span>{stats.withSerial}</span>
</div>
</div>
</div>
</div>
</Modal>
);
};

const App = () => {
const contentRef = useRef(null);

const [equipment, setEquipment] = useState(() => {
try {
const saved = localStorage.getItem('inv_102_data_v12');
if (saved) {
const parsed = JSON.parse(saved);
return initialEquipment.map(item => {
const savedItem = parsed.find(p => p.id === item.id);
return savedItem ? { ...item, ...savedItem } : item;
}).concat(parsed.filter(p => p.isUserAdded && !initialEquipment.find(i => i.id === p.id)));
}
} catch (e) { console.error(e); }
return initialEquipment;
});

const [directories, setDirectories] = useState(() => {
try {
const saved = localStorage.getItem('inv_102_dirs_v12');
if (saved) {
const parsed = JSON.parse(saved);
return { rooms: parsed.rooms || [], people: parsed.people || [], roomsWithBuilding: parsed.roomsWithBuilding || [] };
}
} catch (e) { console.error(e); }
return { rooms: [], people: [], roomsWithBuilding: [] };
});

const [history, setHistory] = useState(() => {
try {
const saved = localStorage.getItem('inv_102_history');
return saved ? JSON.parse(saved) : [];
} catch (e) { return []; }
});

const [sidebarOpen, setSidebarOpen] = useState(false);
const [activeCategory, setActiveCategory] = useState('–í—Å–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ');
const [activeFilter, setActiveFilter] = useState('all');
const [activeBuilding, setActiveBuilding] = useState('–í—Å–µ –∑–¥–∞–Ω–∏—è');
const [toast, setToast] = useState({ visible: false, message: '' });
const [confirmModal, setConfirmModal] = useState({ open: false, title: '', message: '', onConfirm: null });
const [detailsModal, setDetailsModal] = useState({ open: false, item: null });
const [editModal, setEditModal] = useState({ open: false, item: null, isNew: false });
const [checkWizardModal, setCheckWizardModal] = useState({ open: false, item: null });
const [quickSearchModal, setQuickSearchModal] = useState({ open: false, query: '' });
const [roomsModal, setRoomsModal] = useState({ open: false, newRoom: '', newRoomBuilding: '–ù–∞–Ω—Å–µ–Ω–∞' });
const [peopleModal, setPeopleModal] = useState({ open: false, newPerson: '' });
const [infoModal, setInfoModal] = useState({ open: false });
const [statsModal, setStatsModal] = useState({ open: false });
const [historyModal, setHistoryModal] = useState({ open: false });
const [exportModal, setExportModal] = useState({ open: false });
const [settingsModal, setSettingsModal] = useState({ open: false });
const [roomDevicesModal, setRoomDevicesModal] = useState({ open: false, building: '', floor: '', room: '' });

const [detailsForm, setDetailsForm] = useState({ serialNumber: '', location: '', responsible: '', inventoryNote: '', hasLabel: null, building: '', floor: '' });
const [editForm, setEditForm] = useState({ name: '', invNumber: '', date: '', category: '', newCategory: '', note: '', building: '', floor: '' });

useEffect(() => { localStorage.setItem('inv_102_data_v12', JSON.stringify(equipment)); }, [equipment]);
useEffect(() => { localStorage.setItem('inv_102_dirs_v12', JSON.stringify(directories)); }, [directories]);
useEffect(() => { localStorage.setItem('inv_102_history', JSON.stringify(history.slice(0, 50))); }, [history]);

const addToHistory = useCallback((action, item, actionText) => {
setHistory(prev => [{
action, invNumber: item.invNumber, actionText,
time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }),
item
}, ...prev].slice(0, 50));
}, []);

const stats = useMemo(() => ({
total: equipment.length,
checked: equipment.filter(i => i.checked || i.writeOff).length,
pending: equipment.filter(i => !i.checked && !i.writeOff).length,
writeOff: equipment.filter(i => i.writeOff).length,
noLabel: equipment.filter(i => i.hasLabel === false).length,
withSerial: equipment.filter(i => i.serialNumber?.trim()).length,
withNotes: equipment.filter(i => i.inventoryNote?.trim()).length,
new: equipment.filter(i => i.isUserAdded).length,
noBuilding: equipment.filter(i => !i.building).length,
byCategory: equipment.reduce((acc, i) => { acc[i.category] = (acc[i.category] || 0) + 1; return acc; }, {}),
byBuilding: equipment.reduce((acc, i) => { const b = i.building || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'; acc[b] = (acc[b] || 0) + 1; return acc; }, {}),
}), [equipment]);

const recentItems = useMemo(() => 
equipment.filter(i => i.checkedAt).sort((a, b) => new Date(b.checkedAt) - new Date(a.checkedAt)).slice(0, 5),
[equipment]);

const problemItems = useMemo(() => 
equipment.filter(i => i.hasLabel === false || (i.checked && !i.building)),
[equipment]);

const categories = useMemo(() => {
const others = [...new Set(equipment.map(i => i.category).filter(Boolean))].sort((a, b) => a.localeCompare(b, 'ru'));
return ['–í—Å–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ', ...others];
}, [equipment]);

const filteredRooms = useMemo(() => {
const rooms = directories.rooms || [];
const roomsWithBuilding = directories.roomsWithBuilding || [];
if (!detailsForm.building) return rooms;
const roomsForBuilding = roomsWithBuilding.filter(r => r && r.building === detailsForm.building).map(r => r.name);
return roomsForBuilding.length > 0 ? roomsForBuilding : rooms;
}, [directories.rooms, directories.roomsWithBuilding, detailsForm.building]);

const filteredEquipment = useMemo(() => equipment.filter(item => {
if (activeBuilding === '–ù–µ —É–∫–∞–∑–∞–Ω–æ' && item.building) return false;
if (activeBuilding !== '–í—Å–µ –∑–¥–∞–Ω–∏—è' && activeBuilding !== '–ù–µ —É–∫–∞–∑–∞–Ω–æ' && item.building !== activeBuilding) return false;
if (activeCategory !== '–í—Å–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ' && item.category !== activeCategory) return false;

switch (activeFilter) {
case 'checked': if (!item.checked && !item.writeOff) return false; break;
case 'unchecked': if (item.checked || item.writeOff) return false; break;
case 'writeoff': if (!item.writeOff) return false; break;
case 'nolabel': if (item.hasLabel !== false) return false; break;
case 'serial': if (!item.serialNumber?.trim()) return false; break;
case 'notes': if (!item.inventoryNote?.trim()) return false; break;
case 'new': if (!item.isUserAdded) return false; break;
}
return true;
}), [equipment, activeCategory, activeFilter, activeBuilding]);

const groupedEquipment = useMemo(() => filteredEquipment.reduce((acc, item) => {
const cat = item.category || '–ü—Ä–æ—á–µ–µ';
if (!acc[cat]) acc[cat] = [];
acc[cat].push(item);
return acc;
}, {}), [filteredEquipment]);

const buildingOptions = useMemo(() => [
{ value: '–í—Å–µ –∑–¥–∞–Ω–∏—è', label: '–í—Å–µ –∑–¥–∞–Ω–∏—è', icon: 'üèõÔ∏è', count: stats.total },
{ value: '–ù–∞–Ω—Å–µ–Ω–∞', label: '–ù–∞–Ω—Å–µ–Ω–∞', icon: 'üè´', count: stats.byBuilding['–ù–∞–Ω—Å–µ–Ω–∞'] || 0 },
{ value: '–ë–æ—Ç–∞–Ω–∏—á–∫–∞', label: '–ë–æ—Ç–∞–Ω–∏—á–∫–∞', icon: 'üè¢', count: stats.byBuilding['–ë–æ—Ç–∞–Ω–∏—á–∫–∞'] || 0 },
{ value: '–ù–µ —É–∫–∞–∑–∞–Ω–æ', label: '–ù–µ —É–∫–∞–∑–∞–Ω–æ', icon: '‚ùì', count: stats.noBuilding },
], [stats]);

const categoryOptions = useMemo(() => [
{ value: '–í—Å–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ', label: '–í—Å–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ', icon: 'üìã', count: stats.total },
...categories.filter(c => c !== '–í—Å–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ').map(cat => ({
value: cat, label: cat, icon: categoryConfig[cat]?.icon || 'üì¶', count: stats.byCategory[cat] || 0
}))
], [categories, stats]);

const showToast = useCallback((msg) => setToast({ visible: true, message: msg }), []);
const showConfirm = useCallback((title, message, onConfirm) => setConfirmModal({ open: true, title, message, onConfirm }), []);

const goHome = useCallback(() => {
setActiveCategory('–í—Å–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ');
setActiveFilter('all');
setActiveBuilding('–í—Å–µ –∑–¥–∞–Ω–∏—è');
setSidebarOpen(false);
contentRef.current?.scrollTo({ top: 0, behavior: 'smooth' });
}, []);

const handleCheckComplete = useCallback((formData) => {
const item = checkWizardModal.item;
setEquipment(prev => prev.map(i => i.id === item.id ? { ...i, ...formData, checked: true, writeOff: false, checkedAt: new Date().toISOString() } : i));

if (formData.location && formData.building) {
const roomsWithBuilding = directories.roomsWithBuilding || [];
const exists = roomsWithBuilding.find(r => r && r.name === formData.location && r.building === formData.building);
if (!exists) {
setDirectories(prev => ({
...prev,
roomsWithBuilding: [...(prev.roomsWithBuilding || []), { name: formData.location, building: formData.building }],
rooms: [...new Set([...(prev.rooms || []), formData.location])].sort((a, b) => a.localeCompare(b, 'ru'))
}));
}
}

if (formData.responsible) {
const people = directories.people || [];
if (!people.includes(formData.responsible)) {
setDirectories(prev => ({ ...prev, people: [...(prev.people || []), formData.responsible].sort((a, b) => a.localeCompare(b, 'ru')) }));
}
}

addToHistory('check', item, '–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ');
setCheckWizardModal({ open: false, item: null });
showToast('‚úì –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ');
}, [checkWizardModal.item, directories, showToast, addToHistory]);

const handleCheck = useCallback((item, undo = false) => {
if (undo) {
showConfirm('–û—Ç–º–µ–Ω–∏—Ç—å?', '–°–Ω—è—Ç—å –æ—Ç–º–µ—Ç–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏?', () => {
setEquipment(prev => prev.map(i => i.id === item.id ? { ...i, checked: false, writeOff: false, checkedAt: null } : i));
addToHistory('undo', item, '–û—Ç–º–µ–Ω–µ–Ω–æ');
setConfirmModal(prev => ({ ...prev, open: false }));
showToast('‚Ü© –û—Ç–º–µ–Ω–µ–Ω–æ');
});
} else {
setCheckWizardModal({ open: true, item });
}
}, [showConfirm, showToast, addToHistory]);

const handleWriteOff = useCallback((item) => {
showConfirm('–°–ø–∏—Å–∞—Ç—å?', item.name, () => {
setEquipment(prev => prev.map(i => i.id === item.id ? { ...i, writeOff: true, checked: false, checkedAt: new Date().toISOString(), hasLabel: i.hasLabel === null ? true : i.hasLabel } : i));
addToHistory('writeoff', item, '–°–ø–∏—Å–∞–Ω–æ');
setConfirmModal(prev => ({ ...prev, open: false }));
setDetailsModal({ open: false, item: null });
showToast('üìù –°–ø–∏—Å–∞–Ω–æ');
});
}, [showConfirm, showToast, addToHistory]);

const openDetails = useCallback((item) => {
setDetailsForm({
serialNumber: item.serialNumber || '', location: item.location || '', responsible: item.responsible || '',
inventoryNote: item.inventoryNote || '', hasLabel: item.hasLabel, building: item.building || '', floor: item.floor || ''
});
setDetailsModal({ open: true, item });
}, []);

const saveDetails = useCallback(() => {
const item = detailsModal.item;
setEquipment(prev => prev.map(i => i.id === item.id ? { ...i, ...detailsForm } : i));

const rooms = directories.rooms || [];
const roomsWithBuilding = directories.roomsWithBuilding || [];

if (detailsForm.location && detailsForm.building) {
const exists = roomsWithBuilding.find(r => r && r.name === detailsForm.location && r.building === detailsForm.building);
if (!exists) {
setDirectories(prev => ({
...prev,
roomsWithBuilding: [...(prev.roomsWithBuilding || []), { name: detailsForm.location, building: detailsForm.building }],
rooms: [...new Set([...(prev.rooms || []), detailsForm.location])].sort((a, b) => a.localeCompare(b, 'ru'))
}));
}
} else if (detailsForm.location && !rooms.includes(detailsForm.location)) {
setDirectories(prev => ({ ...prev, rooms: [...(prev.rooms || []), detailsForm.location].sort((a, b) => a.localeCompare(b, 'ru')) }));
}

const people = directories.people || [];
if (detailsForm.responsible && !people.includes(detailsForm.responsible)) {
setDirectories(prev => ({ ...prev, people: [...(prev.people || []), detailsForm.responsible].sort((a, b) => a.localeCompare(b, 'ru')) }));
}

setDetailsModal({ open: false, item: null });
showToast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
}, [detailsModal.item, detailsForm, directories, showToast]);

const openEditModal = useCallback((item = null) => {
if (item) {
setEditForm({ name: item.name, invNumber: item.invNumber, date: item.date || '', category: item.category, newCategory: '', note: item.note || '', building: item.building || '', floor: item.floor || '' });
setEditModal({ open: true, item, isNew: false });
} else {
setEditForm({ name: '', invNumber: '', date: new Date().toLocaleDateString('ru-RU'), category: '', newCategory: '', note: '', building: '', floor: '' });
setEditModal({ open: true, item: null, isNew: true });
}
}, []);

const saveEdit = useCallback(() => {
const { name, invNumber, date, category, newCategory, note, building, floor } = editForm;
if (!name.trim()) { showToast('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ'); return; }
if (!invNumber.trim()) { showToast('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä'); return; }
const finalCategory = newCategory.trim() || category;
if (!finalCategory) { showToast('–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é'); return; }

const duplicate = equipment.find(i => i.invNumber === invNumber && i.id !== editModal.item?.id);
if (duplicate) { showToast('–ù–æ–º–µ—Ä —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'); return; }

if (editModal.isNew) {
const newItem = {
id: 'item_' + Date.now(), name: name.trim(), invNumber: invNumber.trim(), date: date.trim(), category: finalCategory, note: note.trim(),
building: building, floor: floor, checked: false, writeOff: false, hasLabel: null, serialNumber: '', location: '', responsible: '', inventoryNote: '', isUserAdded: true
};
setEquipment(prev => [...prev, newItem]);
addToHistory('add', newItem, '–î–æ–±–∞–≤–ª–µ–Ω–æ');
showToast('–î–æ–±–∞–≤–ª–µ–Ω–æ');
} else {
setEquipment(prev => prev.map(i => i.id === editModal.item.id ? { ...i, name: name.trim(), invNumber: invNumber.trim(), date: date.trim(), category: finalCategory, note: note.trim(), building, floor } : i));
showToast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
}
setEditModal({ open: false, item: null, isNew: false });
}, [editForm, editModal, equipment, showToast, addToHistory]);

const addToDirectory = useCallback((type, value, building = null) => {
if (!value.trim()) return;

if (type === 'rooms') {
const rooms = directories.rooms || [];
const roomsWithBuilding = directories.roomsWithBuilding || [];

if (building) {
const exists = roomsWithBuilding.find(r => r && r.name === value.trim() && r.building === building);
if (exists) { showToast('–£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'); return; }
setDirectories(prev => ({
...prev,
roomsWithBuilding: [...(prev.roomsWithBuilding || []), { name: value.trim(), building }],
rooms: [...new Set([...(prev.rooms || []), value.trim()])].sort((a, b) => a.localeCompare(b, 'ru'))
}));
} else {
if (rooms.includes(value.trim())) { showToast('–£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'); return; }
setDirectories(prev => ({ ...prev, rooms: [...(prev.rooms || []), value.trim()].sort((a, b) => a.localeCompare(b, 'ru')) }));
}
setRoomsModal(prev => ({ ...prev, newRoom: '' }));
} else {
const people = directories.people || [];
if (people.includes(value.trim())) { showToast('–£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'); return; }
setDirectories(prev => ({ ...prev, people: [...(prev.people || []), value.trim()].sort((a, b) => a.localeCompare(b, 'ru')) }));
setPeopleModal(prev => ({ ...prev, newPerson: '' }));
}
showToast('–î–æ–±–∞–≤–ª–µ–Ω–æ');
}, [directories, showToast]);

const removeFromDirectory = useCallback((type, idx) => {
const key = type === 'rooms' ? 'rooms' : 'people';
const items = directories[key] || [];
const item = items[idx];
if (!item) return;

showConfirm('–£–¥–∞–ª–∏—Ç—å?', item, () => {
if (type === 'rooms') {
setDirectories(prev => ({
...prev, rooms: (prev.rooms || []).filter((_, i) => i !== idx),
roomsWithBuilding: (prev.roomsWithBuilding || []).filter(r => r && r.name !== item)
}));
} else {
setDirectories(prev => ({ ...prev, [key]: (prev[key] || []).filter((_, i) => i !== idx) }));
}
setConfirmModal(prev => ({ ...prev, open: false }));
showToast('–£–¥–∞–ª–µ–Ω–æ');
});
}, [directories, showConfirm, showToast]);

const handleSave = () => showConfirm('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å?', '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?', () => {
localStorage.setItem('inv_102_data_v12', JSON.stringify(equipment));
setConfirmModal(prev => ({ ...prev, open: false }));
showToast('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
});

const handleExportExcel = () => {
const BOM = '\uFEFF';
const headers = ['–ò–Ω–≤.‚Ññ', 'S/N', '–ù–∞–∑–≤–∞–Ω–∏–µ', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è', '–ó–¥–∞–Ω–∏–µ', '–≠—Ç–∞–∂', '–ö–∞–±–∏–Ω–µ—Ç', '–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π', '–°—Ç–∞—Ç—É—Å', '–ë–∏—Ä–∫–∞', '–ó–∞–º–µ—Ç–∫–∞'];
let csv = BOM + headers.join(';') + '\n';
equipment.forEach(item => {
const status = item.writeOff ? '–°–ø–∏—Å–∞–Ω–∏–µ' : item.checked ? '–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ' : '–û–∂–∏–¥–∞–µ—Ç';
const label = item.hasLabel === true ? '–ï—Å—Ç—å' : item.hasLabel === false ? '–ù–ï–¢' : '-';
const row = [item.invNumber, item.serialNumber || '', item.name, item.category, item.building || '', item.floor || '', item.location || '', item.responsible || '', status, label, item.inventoryNote || '']
.map(f => `"${String(f).replace(/"/g, '""')}"`).join(';');
csv += row + '\n';
});
const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
const link = document.createElement('a');
link.href = URL.createObjectURL(blob);
link.download = `inventory_${new Date().toISOString().slice(0, 10)}.csv`;
link.click();
setExportModal({ open: false });
showToast('üìä –°–∫–∞—á–∞–Ω–æ');
};

const handleExportJSON = () => {
const data = JSON.stringify({ equipment, directories, history }, null, 2);
const blob = new Blob([data], { type: 'application/json' });
const link = document.createElement('a');
link.href = URL.createObjectURL(blob);
link.download = `backup_${new Date().toISOString().slice(0, 10)}.json`;
link.click();
setExportModal({ open: false });
showToast('üì§ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ');
};

const handleImportClick = () => {
setExportModal({ open: false });
document.getElementById('fileInput').click();
};

const handleImportJSON = (e) => {
const file = e.target.files[0];
if (!file) return;
const reader = new FileReader();
reader.onload = (event) => {
try {
const json = JSON.parse(event.target.result);
const imp = json.equipment || (Array.isArray(json) ? json : null);
if (!imp) throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç');
let count = 0;
imp.forEach(impItem => {
const existing = equipment.find(e => e.id === impItem.id);
if (existing) {
setEquipment(prev => prev.map(i => i.id === impItem.id ? { ...i, ...impItem } : i));
count++;
} else if (impItem.isUserAdded) {
setEquipment(prev => [...prev, impItem]);
count++;
}
});
if (json.directories) {
setDirectories(prev => ({
rooms: [...new Set([...(prev.rooms || []), ...(json.directories.rooms || [])])].sort((a, b) => a.localeCompare(b, 'ru')),
people: [...new Set([...(prev.people || []), ...(json.directories.people || [])])].sort((a, b) => a.localeCompare(b, 'ru')),
roomsWithBuilding: [...(prev.roomsWithBuilding || []), ...(json.directories.roomsWithBuilding || [])]
}));
}
showToast(`üì• –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: ${count}`);
} catch (err) {
showToast('‚ùå –û—à–∏–±–∫–∞');
}
};
reader.readAsText(file);
e.target.value = '';
};

const handleClearAll = () => showConfirm('–°–±—Ä–æ—Å–∏—Ç—å?', '–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?', () => {
setEquipment(prev => prev.map(i => ({ ...i, checked: false, writeOff: false, hasLabel: null, serialNumber: '', location: '', responsible: '', inventoryNote: '', building: '', floor: '', checkedAt: null })));
setHistory([]);
setConfirmModal(prev => ({ ...prev, open: false }));
setExportModal({ open: false });
showToast('üóëÔ∏è –°–±—Ä–æ—à–µ–Ω–æ');
});

const quickSearchResults = useMemo(() => {
if (!quickSearchModal.query) return [];
const q = quickSearchModal.query.toLowerCase();
return equipment.filter(item => [item.invNumber, item.name, item.serialNumber, item.building, item.location].join(' ').toLowerCase().includes(q)).slice(0, 20);
}, [quickSearchModal.query, equipment]);

const currentFloors = useMemo(() => {
if (!detailsForm.building) return ['1', '2', '3'];
return buildingsConfig[detailsForm.building]?.floors || ['1', '2', '3'];
}, [detailsForm.building]);

const editFloors = useMemo(() => {
if (!editForm.building) return ['1', '2', '3'];
return buildingsConfig[editForm.building]?.floors || ['1', '2', '3'];
}, [editForm.building]);

return (
<div className="flex bg-gray-50" style={{ height: '100%', minHeight: 0, overflow: 'hidden' }}>
<NavRail 
onOpenRooms={() => setRoomsModal({ ...roomsModal, open: true })}
onOpenPeople={() => setPeopleModal({ ...peopleModal, open: true })}
onAddEquipment={() => openEditModal()}
onShowInfo={() => setInfoModal({ open: true })}
onGoHome={goHome}
onOpenStats={() => setStatsModal({ open: true })}
onOpenExport={() => setExportModal({ open: true })}
onOpenSettings={() => setSettingsModal({ open: true })}
onOpenHistory={() => setHistoryModal({ open: true })}
problemCount={problemItems.length}
/>

<FilterPanel
isOpen={sidebarOpen}
onClose={() => setSidebarOpen(false)}
stats={stats}
activeFilter={activeFilter}
setActiveFilter={setActiveFilter}
activeBuilding={activeBuilding}
setActiveBuilding={setActiveBuilding}
equipment={equipment}
onViewItem={openDetails}
recentItems={recentItems}
problemItems={problemItems}
onRoomClick={(building, floor, room) => setRoomDevicesModal({ open: true, building, floor, room })}
/>

<main className="main-area flex-1 flex flex-col min-w-0 overflow-hidden">
<header className="mobile-header bg-white border-b border-gray-200 px-3 py-2.5 flex-col gap-2 flex-shrink-0">
<div className="flex items-center gap-2">
<button onClick={() => setSidebarOpen(true)} className="touch-btn w-10 h-10 rounded-lg bg-gray-100 flex-shrink-0">
<Icons.Menu />
</button>
<Dropdown value={activeBuilding} options={buildingOptions} onChange={setActiveBuilding} />
<Dropdown value={activeCategory} options={categoryOptions} onChange={setActiveCategory} />
<button onClick={handleSave} className="touch-btn w-10 h-10 bg-blue-600 text-white rounded-lg flex-shrink-0">
<Icons.Save />
</button>
</div>
</header>

<header className="desktop-header bg-white border-b border-gray-200 px-5 py-3 flex-shrink-0">
<div className="flex items-center gap-3">
<Dropdown value={activeBuilding} options={buildingOptions} onChange={setActiveBuilding} />
<Dropdown value={activeCategory} options={categoryOptions} onChange={setActiveCategory} />
<div className="flex items-center gap-2 ml-auto">
<button onClick={handleSave} className="touch-btn px-3 py-2 bg-blue-600 text-white rounded-lg text-xs font-semibold flex items-center gap-1.5">
<Icons.Save /> <span className="hidden sm:inline">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span>
</button>
</div>
</div>
</header>

<div ref={contentRef} className="content-scroll p-5 custom-scroll">
{Object.keys(groupedEquipment).length === 0 ? (
<div className="flex flex-col items-center justify-center h-full text-gray-400">
<div className="text-4xl mb-3">üì≠</div>
<p className="text-base font-semibold">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
</div>
) : (
Object.entries(groupedEquipment).sort((a, b) => a[0].localeCompare(b[0], 'ru')).map(([category, items]) => {
const config = categoryConfig[category] || defaultCatConfig;
const checkedCount = items.filter(i => i.checked || i.writeOff).length;
return (
<div key={category}>
<div className="category-divider" style={{ background: config.color }}>
<span className="flex items-center gap-2">
<span>{config.icon}</span>
<span>{category}</span>
</span>
<span className="bg-white/20 px-2.5 py-0.5 rounded text-xs">{checkedCount}/{items.length}</span>
</div>
<div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
{items.map(item => (
<EquipmentCard key={item.id} item={item} onView={openDetails} onCheck={handleCheck} />
))}
</div>
</div>
);
})
)}
<div className="h-16"></div>
</div>
</main>

<button onClick={() => setQuickSearchModal({ open: true, query: '' })}
className="fixed bottom-5 right-5 w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg flex items-center justify-center z-100 hover:bg-blue-700">
üîç
</button>

<Modal isOpen={infoModal.open} onClose={() => setInfoModal({ open: false })} title="–û –ø—Ä–æ–≥—Ä–∞–º–º–µ" size="sm">
<div className="text-center">
<div className="w-16 h-16 bg-blue-100 rounded-xl flex items-center justify-center mx-auto mb-3">
<span className="text-2xl">üìã</span>
</div>
<h3 className="text-lg font-bold text-gray-800 mb-1">–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è</h3>
<p className="text-sm text-gray-500 mb-2">–ì–ö–û–£ –°–ö–û–®–ò ‚Ññ102</p>
<div className="flex justify-center gap-4 text-xs text-gray-400 mb-4">
<span>üè´ –ù–∞–Ω—Å–µ–Ω–∞ (3 —ç—Ç.)</span>
<span>üè¢ –ë–æ—Ç–∞–Ω–∏—á–∫–∞ (2 —ç—Ç.)</span>
</div>
<p className="text-xs text-gray-400">–í–µ—Ä—Å–∏—è 7.0</p>
</div>
</Modal>

<StatsModal isOpen={statsModal.open} onClose={() => setStatsModal({ open: false })} stats={stats} equipment={equipment} />
<HistoryModal isOpen={historyModal.open} onClose={() => setHistoryModal({ open: false })} history={history} onViewItem={(item) => { setHistoryModal({ open: false }); openDetails(item); }} />
<ExportModal isOpen={exportModal.open} onClose={() => setExportModal({ open: false })} onExportExcel={handleExportExcel} onExportJSON={handleExportJSON} onImport={handleImportClick} onClearAll={handleClearAll} />
<SettingsModal isOpen={settingsModal.open} onClose={() => setSettingsModal({ open: false })} stats={stats} />
<CheckWizardModal isOpen={checkWizardModal.open} onClose={() => setCheckWizardModal({ open: false, item: null })} item={checkWizardModal.item} onComplete={handleCheckComplete} directories={directories} />

<Modal isOpen={detailsModal.open} onClose={() => setDetailsModal({ open: false, item: null })} title="–ö–∞—Ä—Ç–æ—á–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è" size="lg">
{detailsModal.item && (
<div className="space-y-4">
<div className="p-3 bg-blue-50 rounded-lg">
<div className="flex items-center gap-2 mb-1 flex-wrap">
<span className="px-2 py-0.5 bg-blue-600 text-white rounded text-xs font-mono">{detailsModal.item.invNumber}</span>
{detailsModal.item.isUserAdded && <span className="text-xs text-blue-600 font-semibold">–ù–æ–≤–æ–µ</span>}
</div>
<h3 className="font-semibold text-gray-800 text-sm">{detailsModal.item.name}</h3>
<p className="text-xs text-gray-500">{detailsModal.item.category}</p>
</div>

<div>
<label className="block text-xs font-semibold text-gray-500 mb-2">–ë–∏—Ä–∫–∞</label>
<div className="grid grid-cols-2 gap-2">
<button type="button" onClick={() => setDetailsForm(prev => ({ ...prev, hasLabel: true }))} 
className={`touch-btn py-2.5 rounded-lg font-semibold text-sm ${detailsForm.hasLabel === true ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-600'}`}>
‚úì –ï—Å—Ç—å
</button>
<button type="button" onClick={() => setDetailsForm(prev => ({ ...prev, hasLabel: false }))} 
className={`touch-btn py-2.5 rounded-lg font-semibold text-sm ${detailsForm.hasLabel === false ? 'bg-red-500 text-white' : 'bg-gray-100 text-gray-600'}`}>
‚úó –ù–µ—Ç
</button>
</div>
</div>

<div>
<label className="block text-xs font-semibold text-gray-500 mb-2">–ó–¥–∞–Ω–∏–µ</label>
<div className="grid grid-cols-2 gap-2">
<button type="button" onClick={() => setDetailsForm(prev => ({ ...prev, building: '–ù–∞–Ω—Å–µ–Ω–∞', floor: '' }))} 
className={`touch-btn py-2.5 rounded-lg font-semibold text-sm ${detailsForm.building === '–ù–∞–Ω—Å–µ–Ω–∞' ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-600'}`}>
üè´ –ù–∞–Ω—Å–µ–Ω–∞
</button>
<button type="button" onClick={() => setDetailsForm(prev => ({ ...prev, building: '–ë–æ—Ç–∞–Ω–∏—á–∫–∞', floor: '' }))} 
className={`touch-btn py-2.5 rounded-lg font-semibold text-sm ${detailsForm.building === '–ë–æ—Ç–∞–Ω–∏—á–∫–∞' ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-600'}`}>
üè¢ –ë–æ—Ç–∞–Ω–∏—á–∫–∞
</button>
</div>
</div>

<div>
<label className="block text-xs font-semibold text-gray-500 mb-1">–≠—Ç–∞–∂</label>
<div className="flex gap-2">
{currentFloors.map(f => (
<button key={f} type="button" onClick={() => setDetailsForm(prev => ({ ...prev, floor: f }))}
className={`touch-btn flex-1 py-2 rounded-lg font-semibold text-sm ${detailsForm.floor === f ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-600'}`}>
{f}
</button>
))}
</div>
</div>

<AutocompleteInput label="–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä" value={detailsForm.serialNumber} onChange={v => setDetailsForm(prev => ({ ...prev, serialNumber: v }))} suggestions={[]} placeholder="S/N" />
<AutocompleteInput label="–ö–∞–±–∏–Ω–µ—Ç" value={detailsForm.location} onChange={v => setDetailsForm(prev => ({ ...prev, location: v }))} suggestions={filteredRooms} placeholder="–ù–æ–º–µ—Ä –∫–∞–±–∏–Ω–µ—Ç–∞" />
<AutocompleteInput label="–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π" value={detailsForm.responsible} onChange={v => setDetailsForm(prev => ({ ...prev, responsible: v }))} suggestions={directories.people || []} placeholder="–§–ò–û" />

<div>
<label className="block text-xs font-semibold text-gray-500 mb-1">–ó–∞–º–µ—Ç–∫–∏</label>
<textarea value={detailsForm.inventoryNote} onChange={e => setDetailsForm(prev => ({ ...prev, inventoryNote: e.target.value }))}
placeholder="..." rows={2} className="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm resize-none" />
</div>

<div className="grid grid-cols-2 gap-2 pt-3 border-t border-gray-100">
<button onClick={() => { setDetailsModal({ open: false, item: null }); openEditModal(detailsModal.item); }} className="touch-btn py-2.5 bg-gray-100 text-gray-700 rounded-lg font-semibold text-sm">
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
</button>
<button onClick={() => handleWriteOff(detailsModal.item)} className="touch-btn py-2.5 bg-red-100 text-red-600 rounded-lg font-semibold text-sm">
–°–ø–∏—Å–∞—Ç—å
</button>
</div>

<button onClick={saveDetails} className="touch-btn w-full py-3 bg-blue-600 text-white rounded-lg font-semibold">
–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
</button>
</div>
)}
</Modal>

<Modal isOpen={editModal.open} onClose={() => setEditModal({ open: false, item: null, isNew: false })} title={editModal.isNew ? '–î–æ–±–∞–≤–∏—Ç—å' : '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å'} size="md">
<div className="space-y-3">
<div>
<label className="block text-xs font-semibold text-gray-500 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
<input type="text" value={editForm.name} onChange={e => setEditForm(prev => ({ ...prev, name: e.target.value }))}
placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" className="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm" />
</div>
<div className="grid grid-cols-2 gap-3">
<div>
<label className="block text-xs font-semibold text-gray-500 mb-1">–ò–Ω–≤. –Ω–æ–º–µ—Ä *</label>
<input type="text" value={editForm.invNumber} onChange={e => setEditForm(prev => ({ ...prev, invNumber: e.target.value }))}
placeholder="‚Ññ" className="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm" />
</div>
<div>
<label className="block text-xs font-semibold text-gray-500 mb-1">–î–∞—Ç–∞</label>
<input type="text" value={editForm.date} onChange={e => setEditForm(prev => ({ ...prev, date: e.target.value }))}
placeholder="–î–î.–ú–ú.–ì–ì–ì–ì" className="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm" />
</div>
</div>

<div>
<label className="block text-xs font-semibold text-gray-500 mb-2">–ó–¥–∞–Ω–∏–µ</label>
<div className="grid grid-cols-2 gap-2">
<button type="button" onClick={() => setEditForm(prev => ({ ...prev, building: '–ù–∞–Ω—Å–µ–Ω–∞', floor: '' }))} 
className={`touch-btn py-2.5 rounded-lg font-semibold text-sm ${editForm.building === '–ù–∞–Ω—Å–µ–Ω–∞' ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-600'}`}>
üè´ –ù–∞–Ω—Å–µ–Ω–∞
</button>
<button type="button" onClick={() => setEditForm(prev => ({ ...prev, building: '–ë–æ—Ç–∞–Ω–∏—á–∫–∞', floor: '' }))} 
className={`touch-btn py-2.5 rounded-lg font-semibold text-sm ${editForm.building === '–ë–æ—Ç–∞–Ω–∏—á–∫–∞' ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-600'}`}>
üè¢ –ë–æ—Ç–∞–Ω–∏—á–∫–∞
</button>
</div>
</div>

{editForm.building && (
<div>
<label className="block text-xs font-semibold text-gray-500 mb-1">–≠—Ç–∞–∂</label>
<div className="flex gap-2">
{editFloors.map(f => (
<button key={f} type="button" onClick={() => setEditForm(prev => ({ ...prev, floor: f }))}
className={`touch-btn flex-1 py-2 rounded-lg font-semibold text-sm ${editForm.floor === f ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-600'}`}>
{f}
</button>
))}
</div>
</div>
)}

<div>
<label className="block text-xs font-semibold text-gray-500 mb-1">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
<select value={editForm.category} onChange={e => setEditForm(prev => ({ ...prev, category: e.target.value }))}
className="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm">
<option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
{categories.filter(c => c !== '–í—Å–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ').map(cat => <option key={cat} value={cat}>{cat}</option>)}
</select>
</div>
<div>
<label className="block text-xs font-semibold text-gray-500 mb-1">–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
<input type="text" value={editForm.newCategory} onChange={e => setEditForm(prev => ({ ...prev, newCategory: e.target.value }))}
placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é" className="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm" />
</div>
<div className="flex gap-2 pt-3">
<button onClick={() => setEditModal({ open: false, item: null, isNew: false })} className="touch-btn flex-1 py-3 bg-gray-100 text-gray-600 rounded-lg font-semibold">–û—Ç–º–µ–Ω–∞</button>
<button onClick={saveEdit} className="touch-btn flex-1 py-3 bg-blue-600 text-white rounded-lg font-semibold">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>
</div>
</Modal>

<Modal isOpen={quickSearchModal.open} onClose={() => setQuickSearchModal({ open: false, query: '' })} title="–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫" size="md">
<input type="text" value={quickSearchModal.query} onChange={e => setQuickSearchModal(prev => ({ ...prev, query: e.target.value }))}
placeholder="–ù–æ–º–µ—Ä, –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ –∑–¥–∞–Ω–∏–µ..." className="w-full px-4 py-3 border border-gray-200 rounded-lg font-mono mb-4" autoFocus />
<div className="max-h-64 overflow-y-auto border border-gray-200 rounded-lg">
{quickSearchResults.length === 0 ? (
<div className="p-8 text-center text-gray-400 text-sm">–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å...</div>
) : (
quickSearchResults.map(item => (
<button key={item.id} onClick={() => { setQuickSearchModal({ open: false, query: '' }); openDetails(item); }}
className={`w-full text-left p-3 border-b border-gray-50 hover:bg-gray-50 flex items-center gap-3 ${item.checked ? 'bg-green-50' : item.writeOff ? 'bg-red-50' : ''}`}>
<div className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm ${item.writeOff ? 'bg-red-500 text-white' : item.checked ? 'bg-green-500 text-white' : 'bg-amber-100 text-amber-600'}`}>
{item.writeOff ? 'üìù' : item.checked ? '‚úì' : '‚è≥'}
</div>
<div className="flex-1 min-w-0">
<div className="flex items-center gap-2">
<span className="font-mono font-semibold text-blue-600 text-sm">{item.invNumber}</span>
{item.building && (
<span className={`text-xs px-1.5 py-0.5 rounded ${item.building === '–ù–∞–Ω—Å–µ–Ω–∞' ? 'bg-blue-100 text-blue-600' : 'bg-green-100 text-green-600'}`}>
{item.building === '–ù–∞–Ω—Å–µ–Ω–∞' ? 'üè´' : 'üè¢'}
</span>
)}
</div>
<div className="text-xs text-gray-500 truncate">{item.name}</div>
</div>
</button>
))
)}
</div>
</Modal>

<Modal isOpen={roomsModal.open} onClose={() => setRoomsModal({ open: false, newRoom: '', newRoomBuilding: '–ù–∞–Ω—Å–µ–Ω–∞' })} title="üö™ –ö–∞–±–∏–Ω–µ—Ç—ã" size="md">
<div className="space-y-3 mb-4">
<div className="grid grid-cols-2 gap-2">
<button type="button" onClick={() => setRoomsModal(prev => ({ ...prev, newRoomBuilding: '–ù–∞–Ω—Å–µ–Ω–∞' }))}
className={`touch-btn py-2 rounded-lg font-semibold text-sm ${roomsModal.newRoomBuilding === '–ù–∞–Ω—Å–µ–Ω–∞' ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-600'}`}>
üè´ –ù–∞–Ω—Å–µ–Ω–∞
</button>
<button type="button" onClick={() => setRoomsModal(prev => ({ ...prev, newRoomBuilding: '–ë–æ—Ç–∞–Ω–∏—á–∫–∞' }))}
className={`touch-btn py-2 rounded-lg font-semibold text-sm ${roomsModal.newRoomBuilding === '–ë–æ—Ç–∞–Ω–∏—á–∫–∞' ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-600'}`}>
üè¢ –ë–æ—Ç–∞–Ω–∏—á–∫–∞
</button>
</div>
<div className="flex gap-2">
<input type="text" value={roomsModal.newRoom} onChange={e => setRoomsModal(prev => ({ ...prev, newRoom: e.target.value }))}
onKeyDown={e => e.key === 'Enter' && addToDirectory('rooms', roomsModal.newRoom, roomsModal.newRoomBuilding)}
placeholder="–ù–æ–≤—ã–π –∫–∞–±–∏–Ω–µ—Ç..." className="flex-1 px-3 py-2.5 border border-gray-200 rounded-lg text-sm" />
<button onClick={() => addToDirectory('rooms', roomsModal.newRoom, roomsModal.newRoomBuilding)} className="touch-btn px-4 py-2.5 bg-green-600 text-white rounded-lg font-bold">+</button>
</div>
</div>
<div className="max-h-48 overflow-y-auto border border-gray-200 rounded-lg">
{(directories.rooms || []).length === 0 ? (
<div className="p-6 text-center text-gray-400 text-sm">–ü—É—Å—Ç–æ</div>
) : (
(directories.rooms || []).map((room, idx) => {
const roomsWithBuilding = directories.roomsWithBuilding || [];
const roomBuilding = roomsWithBuilding.find(r => r && r.name === room)?.building;
return (
<div key={idx} className="flex items-center gap-2 p-3 border-b border-gray-50">
{roomBuilding && (
<span className={`text-sm ${roomBuilding === '–ù–∞–Ω—Å–µ–Ω–∞' ? 'text-blue-500' : 'text-green-500'}`}>
{roomBuilding === '–ù–∞–Ω—Å–µ–Ω–∞' ? 'üè´' : 'üè¢'}
</span>
)}
<span className="flex-1 text-sm">{room}</span>
<button onClick={() => removeFromDirectory('rooms', idx)} className="touch-btn p-2 bg-red-100 text-red-600 rounded-lg text-xs">üóëÔ∏è</button>
</div>
);
})
)}
</div>
</Modal>

<Modal isOpen={peopleModal.open} onClose={() => setPeopleModal({ open: false, newPerson: '' })} title="üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏" size="sm">
<div className="flex gap-2 mb-4">
<input type="text" value={peopleModal.newPerson} onChange={e => setPeopleModal(prev => ({ ...prev, newPerson: e.target.value }))}
onKeyDown={e => e.key === 'Enter' && addToDirectory('people', peopleModal.newPerson)}
placeholder="–ù–æ–≤–æ–µ –§–ò–û..." className="flex-1 px-3 py-2.5 border border-gray-200 rounded-lg text-sm" />
<button onClick={() => addToDirectory('people', peopleModal.newPerson)} className="touch-btn px-4 py-2.5 bg-green-600 text-white rounded-lg font-bold">+</button>
</div>
<div className="max-h-48 overflow-y-auto border border-gray-200 rounded-lg">
{(directories.people || []).length === 0 ? (
<div className="p-6 text-center text-gray-400 text-sm">–ü—É—Å—Ç–æ</div>
) : (
(directories.people || []).map((person, idx) => (
<div key={idx} className="flex items-center gap-2 p-3 border-b border-gray-50">
<span className="flex-1 text-sm">{person}</span>
<button onClick={() => removeFromDirectory('people', idx)} className="touch-btn p-2 bg-red-100 text-red-600 rounded-lg text-xs">üóëÔ∏è</button>
</div>
))
)}
</div>
</Modal>

{/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∫–∞–±–∏–Ω–µ—Ç–∞ */}
<Modal isOpen={roomDevicesModal.open} 
       onClose={() => setRoomDevicesModal({ open: false, building: '', floor: '', room: '' })}
       title={`üìç –ö–∞–±–∏–Ω–µ—Ç ${roomDevicesModal.room}`} 
       size="lg">
{(() => {
    const devices = equipment.filter(item =>
        item.building === roomDevicesModal.building &&
        item.location === roomDevicesModal.room
    );
    const checkedCount = devices.filter(d => d.checked || d.writeOff).length;

    return (
        <div>
            {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π */}
            <div className="flex items-center gap-3 mb-4 p-3 bg-gray-50 rounded-lg">
                <span className={`text-lg ${roomDevicesModal.building === '–ù–∞–Ω—Å–µ–Ω–∞' ? 'text-blue-500' : 'text-green-500'}`}>
                    {roomDevicesModal.building === '–ù–∞–Ω—Å–µ–Ω–∞' ? 'üè´' : 'üè¢'}
                </span>
                <div className="flex-1">
                    <div className="font-semibold text-gray-800">{roomDevicesModal.building}</div>
                    <div className="text-xs text-gray-500">{roomDevicesModal.floor} —ç—Ç–∞–∂</div>
                </div>
                <div className="text-right">
                    <div className="text-sm font-bold text-gray-700">{devices.length} —É—Å—Ç—Ä.</div>
                    <div className="text-xs text-green-600">{checkedCount} –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ</div>
                </div>
            </div>

            {/* –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ */}
            {devices.length === 0 ? (
                <div className="text-center py-8 text-gray-400">
                    <div className="text-4xl mb-2">üì¶</div>
                    <div>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
                </div>
            ) : (
                <div className="space-y-2 max-h-96 overflow-y-auto custom-scroll">
                    {devices.map(device => (
                        <div key={device.id}
                            onClick={() => { setRoomDevicesModal({ open: false, building: '', floor: '', room: '' }); openDetails(device); }}
                            className={`p-3 rounded-lg border cursor-pointer transition-all hover:shadow-md ${
                                device.writeOff ? 'bg-red-50 border-red-200' :
                                device.checked ? 'bg-green-50 border-green-200' :
                                'bg-white border-gray-200 hover:border-blue-300'
                            }`}>
                            <div className="flex items-start gap-3">
                                <div className={`w-8 h-8 rounded flex items-center justify-center text-sm flex-shrink-0 ${
                                    device.writeOff ? 'bg-red-100 text-red-600' :
                                    device.checked ? 'bg-green-100 text-green-600' :
                                    'bg-gray-100 text-gray-600'
                                }`}>
                                    {device.writeOff ? 'üìù' : device.checked ? '‚úì' : (categoryConfig[device.category]?.icon || 'üì¶')}
                                </div>
                                <div className="flex-1 min-w-0">
                                    <div className="flex items-center gap-2 mb-1">
                                        <span className="px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs font-mono font-bold">{device.invNumber}</span>
                                        <span className={`text-xs font-semibold ${
                                            device.writeOff ? 'text-red-600' :
                                            device.checked ? 'text-green-600' :
                                            'text-amber-600'
                                        }`}>
                                            {device.writeOff ? '–°–ø–∏—Å–∞–Ω–∏–µ' : device.checked ? '–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ' : '–û–∂–∏–¥–∞–µ—Ç'}
                                        </span>
                                    </div>
                                    <div className="text-sm text-gray-800 line-clamp-2">{device.name}</div>
                                    {device.responsible && (
                                        <div className="text-xs text-gray-500 mt-1">üë§ {device.responsible}</div>
                                    )}
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            )}
        </div>
    );
})()}
</Modal>

<ConfirmModal isOpen={confirmModal.open} onClose={() => setConfirmModal(prev => ({ ...prev, open: false }))}
onConfirm={confirmModal.onConfirm} title={confirmModal.title} message={confirmModal.message} />

<Toast message={toast.message} isVisible={toast.visible} onClose={() => setToast(prev => ({ ...prev, visible: false }))} />
</div>
);
};

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);

document.getElementById('fileInput').addEventListener('change', (e) => {
const event = new CustomEvent('fileSelected', { detail: e });
document.dispatchEvent(event);
});
</script>
</body>
</html>
