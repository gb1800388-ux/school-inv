<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è - –ì–ö–û–£ –°–ö–û–®–ò ‚Ññ102</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
        }
        
        html { 
            font-size: 15px; 
            -webkit-font-smoothing: antialiased;
        }
        
        body { 
            font-family: 'Inter', system-ui, sans-serif; 
            background: #f8fafc; 
            color: #1e293b;
            line-height: 1.5;
            overflow: hidden;
            height: 100dvh;
        }
        
        .app-container {
            padding-top: env(safe-area-inset-top, 0px);
            height: 100dvh;
        }
        
        .custom-scroll::-webkit-scrollbar { width: 3px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        
        .content-scroll {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }
        
        .touch-btn {
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.15s ease;
            font-weight: 500;
        }
        .touch-btn:active { transform: scale(0.98); opacity: 0.9; }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 500;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }
        .status-checked { background: #dcfce7; color: #166534; }
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-writeoff { background: #fee2e2; color: #dc2626; }
        
        .category-header {
            background: #1e293b;
            color: white;
            padding: 10px 14px;
            border-radius: 6px;
            margin: 16px 0 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 0.8rem;
        }
        .category-header:first-child { margin-top: 0; }
        
        .card {
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            transition: all 0.15s ease;
        }
        .card:hover {
            border-color: #cbd5e1;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        
        .equipment-card {
            position: relative;
        }
        
        .note-dot {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 6px;
            height: 6px;
            background: #3b82f6;
            border-radius: 50%;
        }
        
        .modal-base {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 5vh 16px 16px;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(2px);
        }
        .modal-z-600 { z-index: 600; }
        .modal-z-700 { z-index: 700; }
        .modal-z-800 { z-index: 800; }
        
        .modal-content {
            animation: modalSlide 0.2s ease-out;
        }
        @keyframes modalSlide {
            from { opacity: 0; transform: translateY(-8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .nav-rail { display: none !important; }
            .sidebar { 
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                width: 280px;
                z-index: 500;
                transform: translateX(-100%);
                transition: transform 0.25s ease;
                box-shadow: 2px 0 16px rgba(0,0,0,0.1);
            }
            .sidebar.open { transform: translateX(0); }
            .mobile-header { display: flex !important; }
            .desktop-header { display: none !important; }
        }
        
        @media (min-width: 769px) {
            .mobile-header { display: none !important; }
            .mobile-overlay { display: none !important; }
            .desktop-header { display: flex !important; }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            .nav-rail { width: 56px; }
            .sidebar { width: 220px; }
        }
        
        .stat-pill {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.15s ease;
        }
        .stat-pill:hover { background: #f1f5f9; }
        .stat-pill.active { 
            border-color: #3b82f6; 
            background: #eff6ff;
        }
        
        .sidebar {
            will-change: transform;
        }
        
        .input-field {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.875rem;
            transition: all 0.15s ease;
        }
        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .btn-primary {
            background: #2563eb;
            color: white;
        }
        .btn-primary:hover { background: #1d4ed8; }
        
        .btn-success {
            background: #16a34a;
            color: white;
        }
        .btn-success:hover { background: #15803d; }
        
        .btn-danger {
            background: #dc2626;
            color: white;
        }
        
        .btn-ghost {
            background: #f1f5f9;
            color: #475569;
        }
        .btn-ghost:hover { background: #e2e8f0; }
    </style>
</head>
<body>
    <div class="app-container" id="appContainer">
        <div id="root" style="height: 100%; display: flex; flex-direction: column;"></div>
    </div>
    <input type="file" id="fileInput" accept=".json" style="display:none">

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback, useMemo } = React;

        const Icons = {
            Home: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth={1.5} viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>,
            Building: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth={1.5} viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>,
            Users: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth={1.5} viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>,
            Plus: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth={1.5} viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M12 4v16m8-8H4" /></svg>,
            Search: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth={1.5} viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>,
            Save: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth={1.5} viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" /></svg>,
            Download: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth={1.5} viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>,
            Upload: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth={1.5} viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>,
            Trash: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth={1.5} viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>,
            X: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth={1.5} viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>,
            Menu: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth={1.5} viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M4 6h16M4 12h16M4 18h16" /></svg>,
            Check: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth={2} viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7" /></svg>,
            ChevronRight: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth={1.5} viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M9 5l7 7-7 7" /></svg>,
        };

        const initialEquipment = [
            {id:"item_0",name:"–ú–§–£ –≥—Ä—É–ø–ø–æ–≤–æ–µ, —Ü–≤–µ—Ç–Ω–æ–µ OKI MC563dn",invNumber:"1101340057",date:"29.12.2017",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–ü—Ä–∏–Ω—Ç–µ—Ä—ã –∏ –ú–§–£",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_1",name:"–ü—Ä–∏–Ω—Ç–µ—Ä –≥—Ä—É–ø–ø–æ–≤–æ–π Epson WorkForce Pro WF-M5190DW",invNumber:"1101340077",date:"22.03.2018",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–ü—Ä–∏–Ω—Ç–µ—Ä—ã –∏ –ú–§–£",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_2",name:"–ê–∫—É—Å—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞—É–¥–∏—Ç–æ—Ä–∏–∏",invNumber:"1101340084",date:"30.03.2018",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–ê—É–¥–∏–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_3",name:"–ê–∫—É—Å—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞—É–¥–∏—Ç–æ—Ä–∏–∏",invNumber:"1101340095",date:"30.03.2018",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–ê—É–¥–∏–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_4",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ IRBIS",invNumber:"0101340042",date:"23.12.2020",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_5",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ IRBIS",invNumber:"0101340043",date:"23.12.2020",note:"–æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞",category:"–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_415",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-50",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_416",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-51",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_417",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-52",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_418",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-53",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_419",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-54",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_420",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-55",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_421",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å 86 –¥—é–π–º–æ–≤",invNumber:"–ë–î-56",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
            {id:"item_422",name:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å ICL InfoRay",invNumber:"–ë–î-57",date:"03.10.2022",note:"",category:"–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ",checked:false,writeOff:false,hasLabel:null,serialNumber:"",location:"",responsible:"",inventoryNote:"",isUserAdded:false},
        ];

        const categoryConfig = {
            "–ê—É–¥–∏–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ": { icon: "üîä", color: "#7c3aed" },
            "–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ": { icon: "üì±", color: "#2563eb" },
            "–ü—Ä–∏–Ω—Ç–µ—Ä—ã –∏ –ú–§–£": { icon: "üñ®", color: "#0891b2" },
            "–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã": { icon: "üì∫", color: "#059669" },
        };
        const defaultCatConfig = { icon: "üì¶", color: "#64748b" };

        // Progress Bar
        const ProgressBar = ({ percent }) => (
            <div className="flex items-center gap-3">
                <div className="flex-1 h-2 bg-slate-200 rounded-full overflow-hidden">
                    <div className="h-full bg-blue-600 rounded-full transition-all duration-500" style={{ width: `${percent}%` }} />
                </div>
                <span className="text-sm font-semibold text-slate-700 w-10 text-right">{percent}%</span>
            </div>
        );

        // Navigation Rail
        const NavRail = ({ onOpenRooms, onOpenPeople, onAddEquipment, onShowInfo, onGoHome, onOpenNotes }) => (
            <div className="nav-rail w-14 bg-slate-900 flex flex-col items-center py-3 flex-shrink-0">
                <button onClick={onShowInfo} className="w-9 h-9 bg-blue-600 rounded-lg flex items-center justify-center mb-4" title="–û –ø—Ä–æ–≥—Ä–∞–º–º–µ">
                    <span className="text-white font-semibold text-xs">102</span>
                </button>
                <div className="flex-1 flex flex-col items-center gap-1">
                    <button onClick={onGoHome} className="touch-btn w-10 h-10 rounded-lg bg-slate-800 text-white" title="–ì–ª–∞–≤–Ω–∞—è">
                        <Icons.Home />
                    </button>
                    <button onClick={onOpenRooms} className="touch-btn w-10 h-10 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white" title="–ö–∞–±–∏–Ω–µ—Ç—ã">
                        <Icons.Building />
                    </button>
                    <button onClick={onOpenPeople} className="touch-btn w-10 h-10 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white" title="–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏">
                        <Icons.Users />
                    </button>
                    <button onClick={onOpenNotes} className="touch-btn w-10 h-10 rounded-lg text-slate-400 hover:bg-slate-800 hover:text-white text-base" title="–ó–∞–º–µ—Ç–∫–∏">
                        üìù
                    </button>
                </div>
                <button onClick={onAddEquipment} className="touch-btn w-10 h-10 rounded-lg bg-emerald-600 text-white" title="–î–æ–±–∞–≤–∏—Ç—å">
                    <Icons.Plus />
                </button>
            </div>
        );

        // Sidebar
        const Sidebar = ({ isOpen, onClose, stats, categories, activeCategory, setActiveCategory, activeFilter, setActiveFilter }) => {
            const percent = stats.total > 0 ? Math.round((stats.checked / stats.total) * 100) : 0;

            return (
                <>
                    <div className={`mobile-overlay fixed inset-0 bg-black/40 z-400 ${isOpen ? 'block' : 'hidden'}`} onClick={onClose} />
                    <div className={`sidebar w-56 bg-white border-r border-slate-200 flex flex-col flex-shrink-0 ${isOpen ? 'open' : ''}`}>
                        <button onClick={onClose} className="absolute top-3 right-3 w-8 h-8 bg-slate-100 rounded-lg flex items-center justify-center lg:hidden">
                            <Icons.X />
                        </button>
                        
                        <div className="p-4 border-b border-slate-100">
                            <h1 className="text-sm font-semibold text-slate-900">–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è</h1>
                            <p className="text-xs text-slate-500">–ì–ö–û–£ –°–ö–û–®–ò ‚Ññ102</p>
                        </div>

                        <div className="p-4 border-b border-slate-100">
                            <div className="flex items-baseline justify-between mb-2">
                                <span className="text-xs text-slate-500">–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
                                <span className="text-xs text-slate-600"><b className="text-emerald-600">{stats.checked}</b> / {stats.total}</span>
                            </div>
                            <ProgressBar percent={percent} />
                        </div>

                        <div className="p-3 border-b border-slate-100">
                            <div className="flex flex-wrap gap-1.5">
                                <div onClick={() => setActiveFilter(activeFilter === 'writeoff' ? 'all' : 'writeoff')}
                                    className={`stat-pill ${activeFilter === 'writeoff' ? 'active' : ''}`}>
                                    <span className="text-red-600 font-semibold">{stats.writeOff}</span>
                                    <span className="text-slate-500">—Å–ø–∏—Å–∞–Ω–∏–µ</span>
                                </div>
                                <div onClick={() => setActiveFilter(activeFilter === 'nolabel' ? 'all' : 'nolabel')}
                                    className={`stat-pill ${activeFilter === 'nolabel' ? 'active' : ''}`}>
                                    <span className="text-amber-600 font-semibold">{stats.noLabel}</span>
                                    <span className="text-slate-500">–±–µ–∑ –±–∏—Ä–∫–∏</span>
                                </div>
                                <div onClick={() => setActiveFilter(activeFilter === 'serial' ? 'all' : 'serial')}
                                    className={`stat-pill ${activeFilter === 'serial' ? 'active' : ''}`}>
                                    <span className="text-emerald-600 font-semibold">{stats.withSerial}</span>
                                    <span className="text-slate-500">—Å S/N</span>
                                </div>
                                <div onClick={() => setActiveFilter(activeFilter === 'notes' ? 'all' : 'notes')}
                                    className={`stat-pill ${activeFilter === 'notes' ? 'active' : ''}`}>
                                    <span className="text-blue-600 font-semibold">{stats.withNotes}</span>
                                    <span className="text-slate-500">–∑–∞–º–µ—Ç–∫–∏</span>
                                </div>
                            </div>
                        </div>

                        <div className="p-3 border-b border-slate-100">
                            <div className="text-xs font-medium text-slate-400 uppercase tracking-wide mb-2">–°—Ç–∞—Ç—É—Å</div>
                            <div className="space-y-0.5">
                                {[
                                    { id: 'all', label: '–í—Å–µ', count: stats.total },
                                    { id: 'unchecked', label: '–û–∂–∏–¥–∞—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏', count: stats.pending },
                                    { id: 'checked', label: '–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ', count: stats.checked },
                                ].map(f => (
                                    <button key={f.id} onClick={() => { setActiveFilter(f.id); onClose(); }}
                                        className={`touch-btn w-full flex items-center gap-2 px-3 rounded-md text-sm min-h-[36px]
                                            ${activeFilter === f.id ? 'bg-blue-600 text-white' : 'text-slate-600 hover:bg-slate-50'}`}>
                                        <span className="flex-1 text-left">{f.label}</span>
                                        <span className={`text-xs font-medium px-1.5 py-0.5 rounded ${activeFilter === f.id ? 'bg-white/20' : 'bg-slate-100'}`}>{f.count}</span>
                                    </button>
                                ))}
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto p-3 custom-scroll">
                            <div className="text-xs font-medium text-slate-400 uppercase tracking-wide mb-2">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</div>
                            <div className="space-y-0.5">
                                {categories.map(cat => {
                                    const config = categoryConfig[cat] || defaultCatConfig;
                                    return (
                                        <button key={cat} onClick={() => { setActiveCategory(cat); onClose(); }}
                                            className={`touch-btn w-full flex items-center gap-2 px-3 rounded-md text-sm min-h-[36px]
                                                ${activeCategory === cat ? 'bg-blue-600 text-white' : 'text-slate-600 hover:bg-slate-50'}`}>
                                            <span className="text-sm">{cat === '–í—Å–µ' ? 'üìã' : config.icon}</span>
                                            <span className="flex-1 text-left truncate">{cat}</span>
                                            <span className={`text-xs font-medium px-1.5 py-0.5 rounded ${activeCategory === cat ? 'bg-white/20' : 'bg-slate-100'}`}>
                                                {cat === '–í—Å–µ' ? stats.total : stats.byCategory[cat] || 0}
                                            </span>
                                        </button>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </>
            );
        };

        // Equipment Card
        const EquipmentCard = React.memo(({ item, onView, onCheck }) => {
            const isProcessed = item.checked || item.writeOff;
            const hasNote = !!item.inventoryNote?.trim();
            const config = categoryConfig[item.category] || defaultCatConfig;

            return (
                <div className={`equipment-card card p-3 border-l-2 ${item.writeOff ? 'border-l-red-500' : item.checked ? 'border-l-emerald-500' : 'border-l-slate-300'}`}>
                    {hasNote && <div className="note-dot" />}
                    
                    <div className="flex items-start gap-3 mb-2">
                        <div className={`w-9 h-9 rounded-md flex items-center justify-center flex-shrink-0 text-base
                            ${item.writeOff ? 'bg-red-50' : item.checked ? 'bg-emerald-50' : 'bg-slate-50'}`}>
                            {item.writeOff ? 'üìù' : item.checked ? <Icons.Check /> : config.icon}
                        </div>
                        <div className="flex-1 min-w-0">
                            <div className="flex items-center gap-2 mb-0.5">
                                <span className="px-1.5 py-0.5 bg-slate-100 text-slate-700 rounded text-xs font-mono font-medium">{item.invNumber}</span>
                                {item.isUserAdded && <span className="w-1.5 h-1.5 bg-blue-500 rounded-full" title="–ù–æ–≤–æ–µ" />}
                                {item.hasLabel === false && <span className="w-1.5 h-1.5 bg-amber-500 rounded-full" title="–ë–µ–∑ –±–∏—Ä–∫–∏" />}
                            </div>
                            <h3 className="text-sm text-slate-800 leading-snug line-clamp-2">{item.name}</h3>
                        </div>
                    </div>

                    <div className="flex items-center gap-2 text-xs text-slate-500 mb-3">
                        <span className={`status-badge ${item.writeOff ? 'status-writeoff' : item.checked ? 'status-checked' : 'status-pending'}`}>
                            {item.writeOff ? '–°–ø–∏—Å–∞–Ω–∏–µ' : item.checked ? '–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ' : '–û–∂–∏–¥–∞–µ—Ç'}
                        </span>
                        {item.location && <span>üìç {item.location}</span>}
                    </div>

                    <div className="flex gap-2">
                        <button onClick={() => onView(item)} className="touch-btn flex-1 py-2 btn-ghost rounded-md text-xs font-medium">
                            –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                        </button>
                        {!isProcessed ? (
                            <button onClick={() => onCheck(item)} className="touch-btn flex-1 py-2 btn-success rounded-md text-xs font-medium">
                                ‚úì –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                            </button>
                        ) : (
                            <button onClick={() => onCheck(item, true)} className="touch-btn flex-1 py-2 btn-ghost rounded-md text-xs font-medium">
                                ‚Ü© –û—Ç–º–µ–Ω–∏—Ç—å
                            </button>
                        )}
                    </div>
                </div>
            );
        });

        // Modal
        const Modal = ({ isOpen, onClose, title, children, size = 'md' }) => {
            if (!isOpen) return null;
            const sizeClass = { sm: 'max-w-sm', md: 'max-w-md', lg: 'max-w-lg' }[size];
            
            return (
                <div className="modal-base modal-z-600" onClick={onClose}>
                    <div className={`modal-content bg-white rounded-lg shadow-xl w-full ${sizeClass}`} onClick={e => e.stopPropagation()}>
                        <div className="flex items-center justify-between px-4 py-3 border-b border-slate-100">
                            <h2 className="text-sm font-semibold text-slate-800">{title}</h2>
                            <button onClick={onClose} className="touch-btn w-8 h-8 rounded-md hover:bg-slate-100 text-slate-400 min-h-0">
                                <Icons.X />
                            </button>
                        </div>
                        <div className="p-4 max-h-[65vh] overflow-y-auto custom-scroll">{children}</div>
                    </div>
                </div>
            );
        };

        // Confirm Modal
        const ConfirmModal = ({ isOpen, onClose, onConfirm, title, message }) => {
            if (!isOpen) return null;
            return (
                <div className="modal-base modal-z-700" onClick={onClose}>
                    <div className="modal-content bg-white rounded-lg shadow-xl w-full max-w-xs p-5 text-center" onClick={e => e.stopPropagation()}>
                        <h3 className="text-base font-semibold text-slate-800 mb-1">{title}</h3>
                        <p className="text-sm text-slate-500 mb-5">{message}</p>
                        <div className="flex gap-3">
                            <button onClick={onClose} className="touch-btn flex-1 py-2.5 btn-ghost rounded-md font-medium text-sm">–û—Ç–º–µ–Ω–∞</button>
                            <button onClick={onConfirm} className="touch-btn flex-1 py-2.5 btn-primary rounded-md font-medium text-sm">–î–∞</button>
                        </div>
                    </div>
                </div>
            );
        };

        // Toast
        const Toast = ({ message, isVisible, onClose }) => {
            useEffect(() => { if (isVisible) { const t = setTimeout(onClose, 2500); return () => clearTimeout(t); } }, [isVisible, onClose]);
            if (!isVisible) return null;
            return (
                <div className="fixed bottom-6 left-1/2 -translate-x-1/2 px-4 py-2.5 bg-slate-900 text-white rounded-lg shadow-lg z-800 text-sm font-medium">
                    {message}
                </div>
            );
        };

        // Autocomplete Input
        const AutocompleteInput = ({ value, onChange, suggestions, placeholder, label }) => {
            const [showDropdown, setShowDropdown] = useState(false);
            const filtered = useMemo(() => {
                if (!value) return suggestions.slice(0, 5);
                return suggestions.filter(s => s.toLowerCase().includes(value.toLowerCase())).slice(0, 5);
            }, [value, suggestions]);

            return (
                <div className="relative">
                    {label && <label className="block text-xs font-medium text-slate-500 mb-1">{label}</label>}
                    <input type="text" value={value} onChange={e => onChange(e.target.value)}
                        onFocus={() => setShowDropdown(true)} onBlur={() => setTimeout(() => setShowDropdown(false), 150)}
                        placeholder={placeholder} className="input-field" />
                    {showDropdown && filtered.length > 0 && (
                        <div className="absolute top-full left-0 right-0 mt-1 bg-white border border-slate-200 rounded-md shadow-lg z-50">
                            {filtered.map((item, idx) => (
                                <button key={idx} type="button" onMouseDown={() => { onChange(item); setShowDropdown(false); }}
                                    className="w-full text-left px-3 py-2 hover:bg-slate-50 text-sm border-b border-slate-50 last:border-0">
                                    {item}
                                </button>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // Main App
        const App = () => {
            const contentRef = useRef(null);
            
            const [equipment, setEquipment] = useState(() => {
                try {
                    const saved = localStorage.getItem('inv_102_data_v12');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        return initialEquipment.map(item => {
                            const savedItem = parsed.find(p => p.id === item.id);
                            return savedItem ? { ...item, ...savedItem } : item;
                        }).concat(parsed.filter(p => p.isUserAdded && !initialEquipment.find(i => i.id === p.id)));
                    }
                } catch (e) { console.error(e); }
                return initialEquipment;
            });

            const [directories, setDirectories] = useState(() => {
                try {
                    const saved = localStorage.getItem('inv_102_dirs_v12');
                    return saved ? JSON.parse(saved) : { rooms: [], people: [] };
                } catch (e) { return { rooms: [], people: [] }; }
            });

            const [sidebarOpen, setSidebarOpen] = useState(false);
            const [activeCategory, setActiveCategory] = useState('–í—Å–µ');
            const [activeFilter, setActiveFilter] = useState('all');
            const [searchQuery, setSearchQuery] = useState('');
            const [toast, setToast] = useState({ visible: false, message: '' });
            const [confirmModal, setConfirmModal] = useState({ open: false, title: '', message: '', onConfirm: null });
            const [detailsModal, setDetailsModal] = useState({ open: false, item: null });
            const [editModal, setEditModal] = useState({ open: false, item: null, isNew: false });
            const [labelModal, setLabelModal] = useState({ open: false, item: null });
            const [serialModal, setSerialModal] = useState({ open: false, item: null, serial: '' });
            const [quickSearchModal, setQuickSearchModal] = useState({ open: false, query: '' });
            const [roomsModal, setRoomsModal] = useState({ open: false, newRoom: '' });
            const [peopleModal, setPeopleModal] = useState({ open: false, newPerson: '' });
            const [infoModal, setInfoModal] = useState({ open: false });
            const [notesModal, setNotesModal] = useState({ open: false });

            const [detailsForm, setDetailsForm] = useState({ serialNumber: '', location: '', responsible: '', inventoryNote: '', hasLabel: null });
            const [editForm, setEditForm] = useState({ name: '', invNumber: '', date: '', category: '', newCategory: '', note: '' });

            useEffect(() => { localStorage.setItem('inv_102_data_v12', JSON.stringify(equipment)); }, [equipment]);
            useEffect(() => { localStorage.setItem('inv_102_dirs_v12', JSON.stringify(directories)); }, [directories]);

            const stats = useMemo(() => ({
                total: equipment.length,
                checked: equipment.filter(i => i.checked || i.writeOff).length,
                pending: equipment.filter(i => !i.checked && !i.writeOff).length,
                writeOff: equipment.filter(i => i.writeOff).length,
                noLabel: equipment.filter(i => i.hasLabel === false).length,
                withSerial: equipment.filter(i => i.serialNumber?.trim()).length,
                withNotes: equipment.filter(i => i.inventoryNote?.trim()).length,
                new: equipment.filter(i => i.isUserAdded).length,
                byCategory: equipment.reduce((acc, i) => { acc[i.category] = (acc[i.category] || 0) + 1; return acc; }, {}),
            }), [equipment]);

            const categories = useMemo(() => {
                const others = [...new Set(equipment.map(i => i.category).filter(Boolean))].sort((a, b) => a.localeCompare(b, 'ru'));
                return ['–í—Å–µ', ...others];
            }, [equipment]);

            const filteredEquipment = useMemo(() => equipment.filter(item => {
                if (activeCategory !== '–í—Å–µ' && item.category !== activeCategory) return false;
                
                switch (activeFilter) {
                    case 'checked': if (!item.checked && !item.writeOff) return false; break;
                    case 'unchecked': if (item.checked || item.writeOff) return false; break;
                    case 'writeoff': if (!item.writeOff) return false; break;
                    case 'nolabel': if (item.hasLabel !== false) return false; break;
                    case 'serial': if (!item.serialNumber?.trim()) return false; break;
                    case 'notes': if (!item.inventoryNote?.trim()) return false; break;
                    case 'new': if (!item.isUserAdded) return false; break;
                }
                
                if (searchQuery) {
                    const q = searchQuery.toLowerCase();
                    const s = [item.invNumber, item.name, item.serialNumber, item.location, item.responsible].join(' ').toLowerCase();
                    if (!s.includes(q)) return false;
                }
                
                return true;
            }), [equipment, activeCategory, activeFilter, searchQuery]);

            const groupedEquipment = useMemo(() => filteredEquipment.reduce((acc, item) => {
                const cat = item.category || '–ü—Ä–æ—á–µ–µ';
                if (!acc[cat]) acc[cat] = [];
                acc[cat].push(item);
                return acc;
            }, {}), [filteredEquipment]);

            const showToast = useCallback((msg) => setToast({ visible: true, message: msg }), []);
            const showConfirm = useCallback((title, message, onConfirm) => setConfirmModal({ open: true, title, message, onConfirm }), []);

            const goHome = useCallback(() => {
                setActiveCategory('–í—Å–µ');
                setActiveFilter('all');
                setSearchQuery('');
                setSidebarOpen(false);
                contentRef.current?.scrollTo({ top: 0, behavior: 'smooth' });
            }, []);

            const startCheckProcess = useCallback((item) => {
                if (item.hasLabel === null) {
                    setLabelModal({ open: true, item });
                } else if (!item.serialNumber?.trim()) {
                    setSerialModal({ open: true, item, serial: '' });
                } else {
                    setEquipment(prev => prev.map(i => i.id === item.id ? { ...i, checked: true, writeOff: false, checkedAt: new Date().toISOString() } : i));
                    showToast('‚úì –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ');
                }
            }, [showToast]);

            const handleLabelAnswer = useCallback((hasLabel) => {
                const item = labelModal.item;
                setEquipment(prev => prev.map(i => i.id === item.id ? { ...i, hasLabel } : i));
                setLabelModal({ open: false, item: null });
                if (!item.serialNumber?.trim()) {
                    setSerialModal({ open: true, item: { ...item, hasLabel }, serial: '' });
                } else {
                    setEquipment(prev => prev.map(i => i.id === item.id ? { ...i, checked: true, writeOff: false, checkedAt: new Date().toISOString() } : i));
                    showToast('‚úì –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ');
                }
            }, [labelModal.item, showToast]);

            const handleSerialSave = useCallback(() => {
                const item = serialModal.item;
                const serial = serialModal.serial.trim();
                setEquipment(prev => prev.map(i => i.id === item.id ? { ...i, serialNumber: serial, checked: true, writeOff: false, checkedAt: new Date().toISOString() } : i));
                setSerialModal({ open: false, item: null, serial: '' });
                showToast('‚úì –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ');
            }, [serialModal, showToast]);

            const handleSerialSkip = useCallback(() => {
                const item = serialModal.item;
                setEquipment(prev => prev.map(i => i.id === item.id ? { ...i, checked: true, writeOff: false, checkedAt: new Date().toISOString() } : i));
                setSerialModal({ open: false, item: null, serial: '' });
                showToast('‚úì –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ');
            }, [serialModal.item, showToast]);

            const handleCheck = useCallback((item, undo = false) => {
                if (undo) {
                    showConfirm('–û—Ç–º–µ–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É?', '–°–Ω—è—Ç—å –æ—Ç–º–µ—Ç–∫—É –æ –ø—Ä–æ–≤–µ—Ä–∫–µ?', () => {
                        setEquipment(prev => prev.map(i => i.id === item.id ? { ...i, checked: false, writeOff: false, checkedAt: null } : i));
                        setConfirmModal(prev => ({ ...prev, open: false }));
                        showToast('–û—Ç–º–µ–Ω–µ–Ω–æ');
                    });
                } else {
                    startCheckProcess(item);
                }
            }, [showConfirm, startCheckProcess, showToast]);

            const handleWriteOff = useCallback((item) => {
                showConfirm('–°–ø–∏—Å–∞—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ?', item.name, () => {
                    setEquipment(prev => prev.map(i => i.id === item.id ? { ...i, writeOff: true, checked: false, checkedAt: new Date().toISOString(), hasLabel: i.hasLabel === null ? true : i.hasLabel } : i));
                    setConfirmModal(prev => ({ ...prev, open: false }));
                    setDetailsModal({ open: false, item: null });
                    showToast('–û—Ç–º–µ—á–µ–Ω–æ –Ω–∞ —Å–ø–∏—Å–∞–Ω–∏–µ');
                });
            }, [showConfirm, showToast]);

            const openDetails = useCallback((item) => {
                setDetailsForm({
                    serialNumber: item.serialNumber || '',
                    location: item.location || '',
                    responsible: item.responsible || '',
                    inventoryNote: item.inventoryNote || '',
                    hasLabel: item.hasLabel
                });
                setDetailsModal({ open: true, item });
            }, []);

            const saveDetails = useCallback(() => {
                const item = detailsModal.item;
                setEquipment(prev => prev.map(i => i.id === item.id ? { ...i, ...detailsForm } : i));
                
                if (detailsForm.location && !directories.rooms.includes(detailsForm.location)) {
                    setDirectories(prev => ({ ...prev, rooms: [...prev.rooms, detailsForm.location].sort((a, b) => a.localeCompare(b, 'ru')) }));
                }
                if (detailsForm.responsible && !directories.people.includes(detailsForm.responsible)) {
                    setDirectories(prev => ({ ...prev, people: [...prev.people, detailsForm.responsible].sort((a, b) => a.localeCompare(b, 'ru')) }));
                }
                
                setDetailsModal({ open: false, item: null });
                showToast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
            }, [detailsModal.item, detailsForm, directories, showToast]);

            const openEditModal = useCallback((item = null) => {
                if (item) {
                    setEditForm({ name: item.name, invNumber: item.invNumber, date: item.date || '', category: item.category, newCategory: '', note: item.note || '' });
                    setEditModal({ open: true, item, isNew: false });
                } else {
                    setEditForm({ name: '', invNumber: '', date: new Date().toLocaleDateString('ru-RU'), category: '', newCategory: '', note: '' });
                    setEditModal({ open: true, item: null, isNew: true });
                }
            }, []);

            const saveEdit = useCallback(() => {
                const { name, invNumber, date, category, newCategory, note } = editForm;
                if (!name.trim()) { showToast('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ'); return; }
                if (!invNumber.trim()) { showToast('–í–≤–µ–¥–∏—Ç–µ –∏–Ω–≤. –Ω–æ–º–µ—Ä'); return; }
                const finalCategory = newCategory.trim() || category;
                if (!finalCategory) { showToast('–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é'); return; }
                
                const duplicate = equipment.find(i => i.invNumber === invNumber && i.id !== editModal.item?.id);
                if (duplicate) { showToast('–ù–æ–º–µ—Ä —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'); return; }

                if (editModal.isNew) {
                    const newItem = {
                        id: 'item_' + Date.now(), name: name.trim(), invNumber: invNumber.trim(), date: date.trim(), category: finalCategory, note: note.trim(),
                        checked: false, writeOff: false, hasLabel: null, serialNumber: '', location: '', responsible: '', inventoryNote: '', isUserAdded: true
                    };
                    setEquipment(prev => [...prev, newItem]);
                    showToast('–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ');
                } else {
                    setEquipment(prev => prev.map(i => i.id === editModal.item.id ? { ...i, name: name.trim(), invNumber: invNumber.trim(), date: date.trim(), category: finalCategory, note: note.trim() } : i));
                    showToast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
                }
                setEditModal({ open: false, item: null, isNew: false });
            }, [editForm, editModal, equipment, showToast]);

            const addToDirectory = useCallback((type, value) => {
                if (!value.trim()) return;
                const key = type === 'rooms' ? 'rooms' : 'people';
                if (directories[key].includes(value.trim())) { showToast('–£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'); return; }
                setDirectories(prev => ({ ...prev, [key]: [...prev[key], value.trim()].sort((a, b) => a.localeCompare(b, 'ru')) }));
                if (type === 'rooms') setRoomsModal(prev => ({ ...prev, newRoom: '' }));
                else setPeopleModal(prev => ({ ...prev, newPerson: '' }));
                showToast('–î–æ–±–∞–≤–ª–µ–Ω–æ');
            }, [directories, showToast]);

            const removeFromDirectory = useCallback((type, idx) => {
                const key = type === 'rooms' ? 'rooms' : 'people';
                const item = directories[key][idx];
                showConfirm('–£–¥–∞–ª–∏—Ç—å?', item, () => {
                    setDirectories(prev => ({ ...prev, [key]: prev[key].filter((_, i) => i !== idx) }));
                    setConfirmModal(prev => ({ ...prev, open: false }));
                    showToast('–£–¥–∞–ª–µ–Ω–æ');
                });
            }, [directories, showConfirm, showToast]);

            const handleSave = () => {
                localStorage.setItem('inv_102_data_v12', JSON.stringify(equipment));
                showToast('üíæ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
            };

            const handleExportExcel = () => {
                const BOM = '\uFEFF';
                const headers = ['–ò–Ω–≤.‚Ññ', 'S/N', '–ù–∞–∑–≤–∞–Ω–∏–µ', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è', '–ö–∞–±–∏–Ω–µ—Ç', '–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π', '–°—Ç–∞—Ç—É—Å', '–ë–∏—Ä–∫–∞', '–ó–∞–º–µ—Ç–∫–∞'];
                let csv = BOM + headers.join(';') + '\n';
                equipment.forEach(item => {
                    const status = item.writeOff ? '–°–ø–∏—Å–∞–Ω–∏–µ' : item.checked ? '–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ' : '–û–∂–∏–¥–∞–µ—Ç';
                    const label = item.hasLabel === true ? '–ï—Å—Ç—å' : item.hasLabel === false ? '–ù–µ—Ç' : '-';
                    const row = [item.invNumber, item.serialNumber || '', item.name, item.category, item.location || '', item.responsible || '', status, label, item.inventoryNote || '']
                        .map(f => `"${String(f).replace(/"/g, '""')}"`).join(';');
                    csv += row + '\n';
                });
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `inventory_${new Date().toISOString().slice(0, 10)}.csv`;
                link.click();
                showToast('üìä –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω');
            };

            const handleExportJSON = () => {
                const data = JSON.stringify({ equipment, directories }, null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `backup_${new Date().toISOString().slice(0, 10)}.json`;
                link.click();
                showToast('üì§ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞');
            };

            const handleImportClick = () => document.getElementById('fileInput').click();

            const handleImportJSON = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const json = JSON.parse(event.target.result);
                        const imp = json.equipment || (Array.isArray(json) ? json : null);
                        if (!imp) throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç');
                        let count = 0;
                        imp.forEach(impItem => {
                            const existing = equipment.find(e => e.id === impItem.id);
                            if (existing) {
                                setEquipment(prev => prev.map(i => i.id === impItem.id ? { ...i, ...impItem } : i));
                                count++;
                            } else if (impItem.isUserAdded) {
                                setEquipment(prev => [...prev, impItem]);
                                count++;
                            }
                        });
                        if (json.directories) {
                            setDirectories(prev => ({
                                rooms: [...new Set([...prev.rooms, ...(json.directories.rooms || [])])].sort((a, b) => a.localeCompare(b, 'ru')),
                                people: [...new Set([...prev.people, ...(json.directories.people || [])])].sort((a, b) => a.localeCompare(b, 'ru'))
                            }));
                        }
                        showToast(`üì• –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: ${count}`);
                    } catch (err) {
                        showToast('‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞');
                    }
                };
                reader.readAsText(file);
                e.target.value = '';
            };

            const handleClearAll = () => showConfirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?', '–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å', () => {
                setEquipment(prev => prev.map(i => ({ ...i, checked: false, writeOff: false, hasLabel: null, serialNumber: '', location: '', responsible: '', inventoryNote: '', checkedAt: null })));
                setConfirmModal(prev => ({ ...prev, open: false }));
                showToast('–î–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã');
            });

            const quickSearchResults = useMemo(() => {
                if (!quickSearchModal.query) return [];
                const q = quickSearchModal.query.toLowerCase();
                return equipment.filter(item => [item.invNumber, item.name, item.serialNumber].join(' ').toLowerCase().includes(q)).slice(0, 15);
            }, [quickSearchModal.query, equipment]);

            return (
                <div className="flex bg-slate-50" style={{ height: '100%', minHeight: 0, overflow: 'hidden' }}>
                    <NavRail 
                        onOpenRooms={() => setRoomsModal({ ...roomsModal, open: true })}
                        onOpenPeople={() => setPeopleModal({ ...peopleModal, open: true })}
                        onAddEquipment={() => openEditModal()}
                        onShowInfo={() => setInfoModal({ open: true })}
                        onGoHome={goHome}
                        onOpenNotes={() => setNotesModal({ open: true })}
                    />

                    <Sidebar
                        isOpen={sidebarOpen}
                        onClose={() => setSidebarOpen(false)}
                        stats={stats}
                        categories={categories}
                        activeCategory={activeCategory}
                        setActiveCategory={setActiveCategory}
                        activeFilter={activeFilter}
                        setActiveFilter={setActiveFilter}
                    />

                    <main className="flex-1 flex flex-col min-w-0 overflow-hidden">
                        <header className="mobile-header bg-white border-b border-slate-200 px-4 py-3 items-center gap-3 flex-shrink-0">
                            <button onClick={() => setSidebarOpen(true)} className="touch-btn w-10 h-10 rounded-md btn-ghost min-h-0">
                                <Icons.Menu />
                            </button>
                            <div className="flex-1 relative">
                                <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"><Icons.Search /></span>
                                <input type="text" value={searchQuery} onChange={e => setSearchQuery(e.target.value)} placeholder="–ü–æ–∏—Å–∫..."
                                    className="w-full pl-9 pr-3 input-field" />
                            </div>
                            <button onClick={handleSave} className="touch-btn w-10 h-10 rounded-md btn-primary min-h-0">
                                <Icons.Save />
                            </button>
                        </header>

                        <header className="desktop-header bg-white border-b border-slate-200 px-5 py-3 flex-shrink-0">
                            <div className="flex items-center gap-3">
                                <div className="flex-1 relative max-w-sm">
                                    <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"><Icons.Search /></span>
                                    <input type="text" value={searchQuery} onChange={e => setSearchQuery(e.target.value)} placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É, –Ω–∞–∑–≤–∞–Ω–∏—é..."
                                        className="w-full pl-9 pr-3 input-field" />
                                </div>
                                <div className="flex items-center gap-2">
                                    <button onClick={handleSave} className="touch-btn px-3 py-2 btn-primary rounded-md text-sm font-medium flex items-center gap-1.5 min-h-0">
                                        <Icons.Save /> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                    </button>
                                    <button onClick={handleExportExcel} className="touch-btn w-9 h-9 btn-success rounded-md min-h-0 text-sm" title="Excel">üìä</button>
                                    <button onClick={handleExportJSON} className="touch-btn w-9 h-9 btn-ghost rounded-md min-h-0" title="–≠–∫—Å–ø–æ—Ä—Ç"><Icons.Download /></button>
                                    <button onClick={handleImportClick} className="touch-btn w-9 h-9 btn-ghost rounded-md min-h-0" title="–ò–º–ø–æ—Ä—Ç"><Icons.Upload /></button>
                                    <button onClick={handleClearAll} className="touch-btn w-9 h-9 btn-ghost text-red-600 rounded-md min-h-0" title="–°–±—Ä–æ—Å"><Icons.Trash /></button>
                                </div>
                            </div>
                        </header>

                        <div ref={contentRef} className="content-scroll p-4 custom-scroll">
                            {Object.keys(groupedEquipment).length === 0 ? (
                                <div className="flex flex-col items-center justify-center h-full text-slate-400">
                                    <div className="text-4xl mb-3">üì≠</div>
                                    <p className="text-sm">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
                                </div>
                            ) : (
                                Object.entries(groupedEquipment).sort((a, b) => a[0].localeCompare(b[0], 'ru')).map(([category, items]) => {
                                    const config = categoryConfig[category] || defaultCatConfig;
                                    const checkedCount = items.filter(i => i.checked || i.writeOff).length;
                                    return (
                                        <div key={category}>
                                            <div className="category-header" style={{ background: config.color }}>
                                                <span className="flex items-center gap-2">
                                                    <span>{config.icon}</span>
                                                    <span>{category}</span>
                                                </span>
                                                <span className="bg-white/20 px-2 py-0.5 rounded text-xs">{checkedCount}/{items.length}</span>
                                            </div>
                                            <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3">
                                                {items.map(item => (
                                                    <EquipmentCard key={item.id} item={item} onView={openDetails} onCheck={handleCheck} />
                                                ))}
                                            </div>
                                        </div>
                                    );
                                })
                            )}
                            <div className="h-20"></div>
                        </div>
                    </main>

                    <button onClick={() => setQuickSearchModal({ open: true, query: '' })}
                        className="fixed bottom-5 right-5 w-12 h-12 bg-blue-600 text-white rounded-full shadow-lg flex items-center justify-center z-100 hover:bg-blue-700 text-lg">
                        üîç
                    </button>

                    {/* Modals */}
                    <Modal isOpen={infoModal.open} onClose={() => setInfoModal({ open: false })} title="–û –ø—Ä–æ–≥—Ä–∞–º–º–µ" size="sm">
                        <div className="text-center py-4">
                            <div className="w-14 h-14 bg-blue-100 rounded-xl flex items-center justify-center mx-auto mb-3">
                                <span className="text-2xl">üìã</span>
                            </div>
                            <h3 className="text-base font-semibold text-slate-800 mb-1">–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è</h3>
                            <p className="text-sm text-slate-500 mb-3">–ì–ö–û–£ –°–ö–û–®–ò ‚Ññ102</p>
                            <p className="text-xs text-slate-400">–í–µ—Ä—Å–∏—è 5.0</p>
                        </div>
                    </Modal>

                    <Modal isOpen={labelModal.open} onClose={() => setLabelModal({ open: false, item: null })} title="–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏—Ä–∫–∏" size="sm">
                        <p className="text-center text-slate-600 text-sm mb-4">–ò–Ω–≤–µ–Ω—Ç–∞—Ä–Ω–∞—è –±–∏—Ä–∫–∞ –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏?</p>
                        <div className="space-y-2">
                            <button onClick={() => handleLabelAnswer(true)} className="touch-btn w-full py-3 btn-success rounded-md font-medium">‚úì –ï—Å—Ç—å –±–∏—Ä–∫–∞</button>
                            <button onClick={() => handleLabelAnswer(false)} className="touch-btn w-full py-3 btn-danger rounded-md font-medium">‚úó –ù–µ—Ç –±–∏—Ä–∫–∏</button>
                            <button onClick={() => setLabelModal({ open: false, item: null })} className="touch-btn w-full py-3 btn-ghost rounded-md font-medium">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </Modal>

                    <Modal isOpen={serialModal.open} onClose={() => setSerialModal({ open: false, item: null, serial: '' })} title="–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä" size="sm">
                        <p className="text-center text-slate-600 text-sm mb-3">–í–≤–µ–¥–∏—Ç–µ —Å–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä (–µ—Å–ª–∏ –µ—Å—Ç—å)</p>
                        <input type="text" value={serialModal.serial} onChange={e => setSerialModal(prev => ({ ...prev, serial: e.target.value }))}
                            placeholder="S/N" className="input-field text-center font-mono mb-4" autoFocus />
                        <div className="space-y-2">
                            <button onClick={handleSerialSave} className="touch-btn w-full py-3 btn-success rounded-md font-medium">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button onClick={handleSerialSkip} className="touch-btn w-full py-3 btn-primary rounded-md font-medium">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
                            <button onClick={() => setSerialModal({ open: false, item: null, serial: '' })} className="touch-btn w-full py-3 btn-ghost rounded-md font-medium">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </Modal>

                    <Modal isOpen={detailsModal.open} onClose={() => setDetailsModal({ open: false, item: null })} title="–ö–∞—Ä—Ç–æ—á–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è" size="lg">
                        {detailsModal.item && (
                            <div className="space-y-4">
                                <div className="p-3 bg-slate-50 rounded-md border border-slate-100">
                                    <div className="flex items-center gap-2 mb-1">
                                        <span className="px-2 py-0.5 bg-slate-800 text-white rounded text-xs font-mono">{detailsModal.item.invNumber}</span>
                                        {detailsModal.item.isUserAdded && <span className="text-xs text-blue-600">–ù–æ–≤–æ–µ</span>}
                                    </div>
                                    <h3 className="text-sm text-slate-800">{detailsModal.item.name}</h3>
                                    <p className="text-xs text-slate-500">{detailsModal.item.category}</p>
                                </div>

                                <div>
                                    <label className="block text-xs font-medium text-slate-500 mb-2">–ë–∏—Ä–∫–∞</label>
                                    <div className="grid grid-cols-2 gap-2">
                                        <button onClick={() => setDetailsForm(prev => ({ ...prev, hasLabel: true }))} 
                                            className={`touch-btn py-2.5 rounded-md font-medium text-sm ${detailsForm.hasLabel === true ? 'btn-success' : 'btn-ghost'}`}>
                                            ‚úì –ï—Å—Ç—å
                                        </button>
                                        <button onClick={() => setDetailsForm(prev => ({ ...prev, hasLabel: false }))} 
                                            className={`touch-btn py-2.5 rounded-md font-medium text-sm ${detailsForm.hasLabel === false ? 'btn-danger' : 'btn-ghost'}`}>
                                            ‚úó –ù–µ—Ç
                                        </button>
                                    </div>
                                </div>

                                <AutocompleteInput label="–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä" value={detailsForm.serialNumber} onChange={v => setDetailsForm(prev => ({ ...prev, serialNumber: v }))} suggestions={[]} placeholder="S/N" />
                                <AutocompleteInput label="–ö–∞–±–∏–Ω–µ—Ç" value={detailsForm.location} onChange={v => setDetailsForm(prev => ({ ...prev, location: v }))} suggestions={directories.rooms} placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ" />
                                <AutocompleteInput label="–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π" value={detailsForm.responsible} onChange={v => setDetailsForm(prev => ({ ...prev, responsible: v }))} suggestions={directories.people} placeholder="–§–ò–û" />

                                <div>
                                    <label className="block text-xs font-medium text-slate-500 mb-1">–ó–∞–º–µ—Ç–∫–∞</label>
                                    <textarea value={detailsForm.inventoryNote} onChange={e => setDetailsForm(prev => ({ ...prev, inventoryNote: e.target.value }))}
                                        placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." rows={2} className="input-field resize-none" />
                                </div>

                                <div className="grid grid-cols-2 gap-2 pt-3 border-t border-slate-100">
                                    <button onClick={() => { setDetailsModal({ open: false, item: null }); openEditModal(detailsModal.item); }} className="touch-btn py-2.5 btn-ghost rounded-md font-medium text-sm">
                                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                    </button>
                                    <button onClick={() => handleWriteOff(detailsModal.item)} className="touch-btn py-2.5 bg-red-50 text-red-600 rounded-md font-medium text-sm">
                                        –°–ø–∏—Å–∞—Ç—å
                                    </button>
                                </div>

                                <button onClick={saveDetails} className="touch-btn w-full py-3 btn-primary rounded-md font-medium">
                                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                </button>
                            </div>
                        )}
                    </Modal>

                    <Modal isOpen={editModal.open} onClose={() => setEditModal({ open: false, item: null, isNew: false })} title={editModal.isNew ? '–ù–æ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ' : '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ'} size="md">
                        <div className="space-y-3">
                            <div>
                                <label className="block text-xs font-medium text-slate-500 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                                <input type="text" value={editForm.name} onChange={e => setEditForm(prev => ({ ...prev, name: e.target.value }))}
                                    placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è" className="input-field" />
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                                <div>
                                    <label className="block text-xs font-medium text-slate-500 mb-1">–ò–Ω–≤. –Ω–æ–º–µ—Ä *</label>
                                    <input type="text" value={editForm.invNumber} onChange={e => setEditForm(prev => ({ ...prev, invNumber: e.target.value }))}
                                        placeholder="‚Ññ" className="input-field font-mono" />
                                </div>
                                <div>
                                    <label className="block text-xs font-medium text-slate-500 mb-1">–î–∞—Ç–∞</label>
                                    <input type="text" value={editForm.date} onChange={e => setEditForm(prev => ({ ...prev, date: e.target.value }))}
                                        placeholder="–î–î.–ú–ú.–ì–ì–ì–ì" className="input-field" />
                                </div>
                            </div>
                            <div>
                                <label className="block text-xs font-medium text-slate-500 mb-1">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                                <select value={editForm.category} onChange={e => setEditForm(prev => ({ ...prev, category: e.target.value }))}
                                    className="input-field">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
                                    {categories.filter(c => c !== '–í—Å–µ').map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                </select>
                            </div>
                            <div>
                                <label className="block text-xs font-medium text-slate-500 mb-1">–ò–ª–∏ –Ω–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                                <input type="text" value={editForm.newCategory} onChange={e => setEditForm(prev => ({ ...prev, newCategory: e.target.value }))}
                                    placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é" className="input-field" />
                            </div>
                            <div className="flex gap-2 pt-3">
                                <button onClick={() => setEditModal({ open: false, item: null, isNew: false })} className="touch-btn flex-1 py-3 btn-ghost rounded-md font-medium">–û—Ç–º–µ–Ω–∞</button>
                                <button onClick={saveEdit} className="touch-btn flex-1 py-3 btn-primary rounded-md font-medium">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            </div>
                        </div>
                    </Modal>

                    <Modal isOpen={quickSearchModal.open} onClose={() => setQuickSearchModal({ open: false, query: '' })} title="–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫" size="md">
                        <input type="text" value={quickSearchModal.query} onChange={e => setQuickSearchModal(prev => ({ ...prev, query: e.target.value }))}
                            placeholder="–ù–æ–º–µ—Ä –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ..." className="input-field font-mono mb-4" autoFocus />
                        <div className="max-h-64 overflow-y-auto border border-slate-200 rounded-md">
                            {quickSearchResults.length === 0 ? (
                                <div className="p-8 text-center text-slate-400 text-sm">–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –¥–ª—è –ø–æ–∏—Å–∫–∞</div>
                            ) : (
                                quickSearchResults.map(item => (
                                    <button key={item.id} onClick={() => { setQuickSearchModal({ open: false, query: '' }); openDetails(item); }}
                                        className={`w-full text-left p-3 border-b border-slate-50 hover:bg-slate-50 flex items-center gap-3 ${item.checked ? 'bg-emerald-50' : item.writeOff ? 'bg-red-50' : ''}`}>
                                        <div className={`w-8 h-8 rounded-md flex items-center justify-center text-xs ${item.writeOff ? 'bg-red-500 text-white' : item.checked ? 'bg-emerald-500 text-white' : 'bg-amber-100 text-amber-600'}`}>
                                            {item.writeOff ? 'üìù' : item.checked ? '‚úì' : '‚è≥'}
                                        </div>
                                        <div className="flex-1 min-w-0">
                                            <div className="font-mono font-medium text-slate-700 text-sm">{item.invNumber}</div>
                                            <div className="text-xs text-slate-500 truncate">{item.name}</div>
                                        </div>
                                        <Icons.ChevronRight />
                                    </button>
                                ))
                            )}
                        </div>
                    </Modal>

                    <Modal isOpen={roomsModal.open} onClose={() => setRoomsModal({ open: false, newRoom: '' })} title="–ö–∞–±–∏–Ω–µ—Ç—ã" size="sm">
                        <div className="flex gap-2 mb-4">
                            <input type="text" value={roomsModal.newRoom} onChange={e => setRoomsModal(prev => ({ ...prev, newRoom: e.target.value }))}
                                onKeyDown={e => e.key === 'Enter' && addToDirectory('rooms', roomsModal.newRoom)}
                                placeholder="–ù–æ–≤—ã–π –∫–∞–±–∏–Ω–µ—Ç..." className="flex-1 input-field" />
                            <button onClick={() => addToDirectory('rooms', roomsModal.newRoom)} className="touch-btn px-4 btn-success rounded-md font-bold min-h-0">+</button>
                        </div>
                        <div className="max-h-48 overflow-y-auto border border-slate-200 rounded-md">
                            {directories.rooms.length === 0 ? (
                                <div className="p-6 text-center text-slate-400 text-sm">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</div>
                            ) : (
                                directories.rooms.map((room, idx) => (
                                    <div key={idx} className="flex items-center gap-2 p-3 border-b border-slate-50">
                                        <span className="flex-1 text-sm">{room}</span>
                                        <button onClick={() => removeFromDirectory('rooms', idx)} className="touch-btn p-2 bg-red-50 text-red-600 rounded-md text-xs min-h-0">üóë</button>
                                    </div>
                                ))
                            )}
                        </div>
                    </Modal>

                    <Modal isOpen={peopleModal.open} onClose={() => setPeopleModal({ open: false, newPerson: '' })} title="–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏" size="sm">
                        <div className="flex gap-2 mb-4">
                            <input type="text" value={peopleModal.newPerson} onChange={e => setPeopleModal(prev => ({ ...prev, newPerson: e.target.value }))}
                                onKeyDown={e => e.key === 'Enter' && addToDirectory('people', peopleModal.newPerson)}
                                placeholder="–§–ò–û..." className="flex-1 input-field" />
                            <button onClick={() => addToDirectory('people', peopleModal.newPerson)} className="touch-btn px-4 btn-success rounded-md font-bold min-h-0">+</button>
                        </div>
                        <div className="max-h-48 overflow-y-auto border border-slate-200 rounded-md">
                            {directories.people.length === 0 ? (
                                <div className="p-6 text-center text-slate-400 text-sm">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</div>
                            ) : (
                                directories.people.map((person, idx) => (
                                    <div key={idx} className="flex items-center gap-2 p-3 border-b border-slate-50">
                                        <span className="flex-1 text-sm">{person}</span>
                                        <button onClick={() => removeFromDirectory('people', idx)} className="touch-btn p-2 bg-red-50 text-red-600 rounded-md text-xs min-h-0">üóë</button>
                                    </div>
                                ))
                            )}
                        </div>
                    </Modal>

                    <Modal isOpen={notesModal.open} onClose={() => setNotesModal({ open: false })} title="–í—Å–µ –∑–∞–º–µ—Ç–∫–∏" size="lg">
                        <div className="max-h-96 overflow-y-auto">
                            {equipment.filter(i => i.inventoryNote?.trim()).length === 0 ? (
                                <div className="p-8 text-center text-slate-400">
                                    <div className="text-3xl mb-2">üìù</div>
                                    <p className="text-sm">–ó–∞–º–µ—Ç–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</p>
                                </div>
                            ) : (
                                <div className="space-y-2">
                                    {equipment.filter(i => i.inventoryNote?.trim()).map(item => (
                                        <button key={item.id} onClick={() => { setNotesModal({ open: false }); openDetails(item); }}
                                            className="w-full text-left p-3 bg-slate-50 hover:bg-slate-100 rounded-md transition-colors">
                                            <div className="flex items-center gap-2 mb-1">
                                                <span className="px-1.5 py-0.5 bg-slate-800 text-white rounded text-xs font-mono">{item.invNumber}</span>
                                                <span className={`status-badge ${item.writeOff ? 'status-writeoff' : item.checked ? 'status-checked' : 'status-pending'}`}>
                                                    {item.writeOff ? '–°–ø–∏—Å–∞–Ω–∏–µ' : item.checked ? '–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ' : '–û–∂–∏–¥–∞–µ—Ç'}
                                                </span>
                                            </div>
                                            <p className="text-sm text-slate-800 mb-1 line-clamp-1">{item.name}</p>
                                            <p className="text-xs text-slate-600 bg-white p-2 rounded border border-slate-200">{item.inventoryNote}</p>
                                            {item.location && <p className="text-xs text-slate-400 mt-1">üìç {item.location}</p>}
                                        </button>
                                    ))}
                                </div>
                            )}
                        </div>
                    </Modal>

                    <ConfirmModal isOpen={confirmModal.open} onClose={() => setConfirmModal(prev => ({ ...prev, open: false }))}
                        onConfirm={confirmModal.onConfirm} title={confirmModal.title} message={confirmModal.message} />

                    <Toast message={toast.message} isVisible={toast.visible} onClose={() => setToast(prev => ({ ...prev, visible: false }))} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
